function JSmolWrapper(){function t(t,e,n){a=t,o=jQuery.extend(!0,{},h,e);var i=o.width,m=4*o.height;r='<iframe id="jsmol_frame" src="'+n+'" seamless="seamless" width="'+i+'" height="'+m+'" frameBorder="0" scrolling="no"></iframe>';var f=function(t){if(cbio.util.getWindowOrigin()==t.origin)if("ready"==t.data.type)l&&(u=cbio.util.getTargetDocument("jsmol_frame"));else if("menu"==t.data.type)s&&("visible"==t.data.content?s.css("overflow","visible"):"hidden"==t.data.content&&s.css("overflow","hidden"));else if("done"==t.data.type){var e=p[t.data.scriptId];if(null!=e){delete p[t.data.scriptId];var n=e.callback;n&&_.isFunction(n)&&n()}_.isEmpty(d)||(e=d.shift(),p[e.data.scriptId]=e,l.postMessage(e.data,c))}};window.addEventListener("message",f,!1)}function e(t){t&&r&&(t.empty(),t.append(r),s=t),l=cbio.util.getTargetWindow("jsmol_frame"),l||console.log("warning: JSmol frame cannot be initialized properly")}function n(t,e){if(l){m=(m+1)%1e6;var n={type:"script",content:t,scriptId:"script_"+m};i(n,e)}}function i(t,e){var n={data:t,callback:e};_.isEmpty(d)?(p[n.data.scriptId]=n,l.postMessage(t,c)):d.push(n)}var a=null,o=null,r=null,l=null,u=null,s=null,c=cbio.util.getWindowOrigin(),d=[],p={},m=0,h={use:"HTML5",j2sPath:"js/lib/jsmol/j2s",disableJ2SLoadMonitor:!0,disableInitialConsole:!0};return{init:t,updateContainer:e,script:n}}function JmolScriptGenerator(){function t(t){return"load="+t+";"}function e(){return"select all;"}function n(){return"select none;"}function i(t){return S[t]}function a(t){return"color ["+w(t)+"];"}function o(t){return"select :"+t+";"}function r(t){return"select :"+t+" and helix;"}function l(t){return"select :"+t+" and sheet;"}function u(t){var e="@{{:"+t+"}.atomNo.min}",n="@{{:"+t+"}.atomNo.max}";return'color atoms property atomNo "roygb" range '+e+" "+n+";"}function s(t){return"color atoms CPK;"}function c(){return"restrict protein;"}function d(t){return"color translucent;"}function p(){return"color opaque;"}function m(t){var e=function(t){var e="";return null!=t&&t.length>0&&(e+="^"+t),e},n=t.start.pdbPos+e(t.start.insertion);return t.end.pdbPos>t.start.pdbPos&&(n+="-"+t.end.pdbPos+e(t.end.insertion)),n}function h(t,e){return"select ("+t.join(", ")+") and :"+e+";"}function f(t,e){return"select (("+t.join(", ")+") and :"+e+" and sidechain) or (("+t.join(", ")+") and :"+e+" and *.CA);"}function g(){return"wireframe 0.15; spacefill 25%;"}function v(){return"wireframe OFF; spacefill OFF;"}function b(t,e){var n=this,i=n.scriptPosition(t);return"center "+i+":"+e+";"}function y(){return"center;"}function _(){return"zoom in;"}function T(){return"zoom out;"}function C(t){return"spin "+t+";"}function P(t,e,n,i){var a=this,o=[];o.push(a.selectPositions(t,i.chainId)),o.push(a.setColor(e));var r="none"!=n.displaySideChain;return o=o.concat(a.generateSideChainScript(t,r,n,i))}function w(t){return t.replace("#","x")}var S={ballAndStick:"wireframe ONLY; wireframe 0.15; spacefill 20%;",spaceFilling:"spacefill ONLY; spacefill 100%;",ribbon:"ribbon ONLY;",cartoon:"cartoon ONLY;",trace:"trace ONLY;"};this.loadPdb=t,this.selectAll=e,this.selectNone=n,this.setScheme=i,this.setColor=a,this.selectChain=o,this.selectAlphaHelix=r,this.selectBetaSheet=l,this.rainbowColor=u,this.cpkColor=s,this.hideBoundMolecules=c,this.setTransparency=d,this.makeOpaque=p,this.scriptPosition=m,this.selectPositions=h,this.selectSideChains=f,this.enableBallAndStick=g,this.disableBallAndStick=v,this.highlightScript=P,this.center=b,this.defaultZoomIn=_,this.defaultZoomOut=T,this.defaultCenter=y,this.spin=C}function JmolWrapper(t){function e(t,e){u=jQuery.extend(!0,{},l,e),delete Jmol._tracker,o=Jmol.getApplet(t,u),r=$("#"+t+"_appletinfotablediv"),r.hide()}function n(t){null!=r&&(t.append(r),r.show())}function i(t,e){Jmol.script(o,t),_.isFunction(e)&&e()}function a(t){return t?{jarPath:"js/lib/jmol/",jarFile:"JmolAppletSigned.jar",disableJ2SLoadMonitor:!0,disableInitialConsole:!0}:{use:"HTML5",j2sPath:"js/lib/jsmol/j2s",disableJ2SLoadMonitor:!0,disableInitialConsole:!0}}var o=null,r=null,l=a(t),u=null;return{init:e,updateContainer:n,script:i}}function MergedAlignmentSegmentor(t){function e(){return o<a.mergedString.length}function n(){var t=a.mergedString,e={};e.start=o+a.uniprotFrom;var n=t[o],r=o;if(i(n))for(e.type=n;t[r]==n&&r<=t.length;)r++;else for(e.type="regular";!i(t[r])&&r<=t.length;)r++;return e.end=r+a.uniprotFrom,e.str=t.substring(o,r),o=r,e}function i(t){return t==PdbDataUtil.ALIGNMENT_GAP}var a=t,o=0;return{hasNextSegment:e,getNextSegment:n}}function MolScriptGenerator(){this.loadPdb=function(t){return""},this.selectAll=function(){return""},this.selectNone=function(){return""},this.setScheme=function(t){return""},this.setColor=function(t){return""},this.selectChain=function(t){return""},this.selectAlphaHelix=function(t){return""},this.selectBetaSheet=function(t){return""},this.rainbowColor=function(t){return""},this.cpkColor=function(t){return""},this.hideBoundMolecules=function(){return""},this.setTransparency=function(t){return""},this.makeOpaque=function(){return""},this.scriptPosition=function(t){return""},this.selectPositions=function(t,e){return""},this.selectSideChains=function(t,e){return""},this.enableBallAndStick=function(){return""},this.disableBallAndStick=function(){return""},this.center=function(t,e){return""},this.zoom=function(t){return""},this.defaultZoomIn=function(){return""},this.defaultZoomOut=function(){return""},this.defaultCenter=function(){return""},this.spin=function(t){return""},this.highlightScript=function(t,e,n,i){return[]},this.generateVisualStyleScript=function(t,e,n){var i=this,a=[];a.push(i.selectAll()),a.push(i.setScheme(n.proteinScheme)),a.push(i.setColor(n.defaultColor)),a.push(i.selectChain(e.chainId)),a.push(i.setColor(n.chainColor)),a.push(i.selectChain(e.chainId)),"byAtomType"==n.colorProteins?a.push(i.cpkColor(e.chainId)):"bySecondaryStructure"==n.colorProteins?(a.push(i.selectAlphaHelix(e.chainId)),a.push(i.setColor(n.structureColors.alphaHelix)),a.push(i.selectBetaSheet(e.chainId)),a.push(i.setColor(n.structureColors.betaSheet))):"byChain"==n.colorProteins&&(a.push(i.selectChain(e.chainId)),a.push(i.rainbowColor(e.chainId)));for(var o in t)a.push(i.selectPositions(t[o],e.chainId)),"byMutationType"==n.colorMutations?a.push(i.setColor(o)):"uniform"==n.colorMutations&&a.push(i.setColor(n.mutationColor)),a=a.concat(i.generateSideChainScript(t[o],"all"==n.displaySideChain,n,e));return a.push(i.selectAll()),a.push(i.setTransparency(n.defaultTranslucency)),a.push(i.selectChain(e.chainId)),a.push(i.makeOpaque()),n.restrictProtein&&a.push(i.hideBoundMolecules()),a},this.generateSideChainScript=function(t,e,n,i){var a=this,o=[];return"spaceFilling"!=n.proteinScheme&&(o.push(a.selectSideChains(t,i.chainId)),e?o.push(a.enableBallAndStick()):o.push(a.disableBallAndStick())),o},this.generateHighlightScript=function(t,e,n,i){var a=this,o=[];if(!_.isEmpty(t)){var r=a.highlightScriptPositions(t);o=o.concat(a.highlightScript(r,e,n,i))}return o},this.highlightScriptPositions=function(t){var e=this,n=[];return _.each(t,function(t){n.push(e.scriptPosition(t))}),n}}function MutationInputParser(){function t(){return{proteinPosEnd:"",uniprotId:"",cancerType:"",tumorType:"",cancerStudyLink:"",codonChange:"",proteinPosStart:"",linkToPatientView:"",geneticProfileId:"",mutationCount:"",mutationType:"",referenceAllele:"",uniprotAcc:"",fisValue:"",functionalImpactScore:"",cancerStudy:"",normalRefCount:"",ncbiBuildNo:"",normalFreq:"",cancerStudyShort:"",msaLink:"",mutationStatus:"",cna:"",proteinChange:"",aminoAcidChange:"",endPos:"",refseqMrnaId:"",geneSymbol:"",tumorFreq:"",startPos:"",keyword:"",cosmic:"",validationStatus:"",mutationSid:"",normalAltCount:"",variantAllele:"",mutationId:"",caseId:"",xVarLink:"",pdbLink:"",tumorAltCount:"",tumorRefCount:"",sequencingCenter:"",chr:""}}function e(t){var e=[],i=t.split("\n");if(i.length>0)for(var o=a(i[0]),r=1;r<i.length;r++)i[r].length>0&&e.push(n(i[r],o));return u=e,e}function n(e,n){var a=t(),o=e.split("	");return _.each(_.keys(a),function(t){a[t]=i(t,o,n)}),a.mutationId=a.mutationId||l(),a.mutationSid=a.mutationSid||a.mutationId,a}function i(t,e,n){var i=p[t],a=n[i],o="";return null!=a&&(o=e[a]||""),o}function a(t){var e=t.split("	"),n={};return _.each(e,function(t,e){n[t.toLowerCase()]=e}),n}function o(){if(null==u)return[];if(null==c){var t={};_.each(u,function(e,n){null!=e.caseId&&e.caseId.length>0&&(t[e.caseId]=e.caseId)}),c=_.values(t)}return c}function r(){if(null==u)return[];if(null==s){var t={};_.each(u,function(e,n){null!=e.geneSymbol&&e.geneSymbol.length>0&&(t[e.geneSymbol.toUpperCase()]=e.geneSymbol.toUpperCase())}),s=_.values(t)}return s}function l(){return d++,"stalone_mut_"+d}var u=null,s=null,c=null,d=0,p={proteinPosEnd:"protein_position_end",uniprotId:"uniprot_id",cancerType:"cancer_type",tumorType:"tumor_type",cancerStudyLink:"cancer_study_link",codonChange:"codon_change",proteinPosStart:"protein_position_start",linkToPatientView:"patient_view_link",geneticProfileId:"genetic_profile_id",mutationCount:"mutation_count",mutationType:"mutation_type",referenceAllele:"reference_allele",uniprotAcc:"uniprot_accession",fisValue:"fis_value",functionalImpactScore:"fis",cancerStudy:"cancer_study",normalRefCount:"normal_ref_count",ncbiBuildNo:"ncbi_build",normalFreq:"normal_frequency",cancerStudyShort:"cancer_study_short",msaLink:"msa_link",mutationStatus:"mutation_status",cna:"copy_number",proteinChange:"protein_change",aminoAcidChange:"amino_acid_change",endPos:"end_position",geneSymbol:"hugo_symbol",tumorFreq:"tumor_frequency",startPos:"start_position",keyword:"keyword",cosmic:"cosmic",validationStatus:"validation_status",mutationSid:"mutation_sid",normalAltCount:"normal_alt_count",variantAllele:"variant_allele",mutationId:"mutation_id",caseId:"sample_id",xVarLink:"xvar_link",pdbLink:"pdb_link",tumorAltCount:"tumor_alt_count",tumorRefCount:"tumor_ref_count",sequencingCenter:"center",chr:"chromosome"};return{parseInput:e,getSampleArray:o,getGeneList:r}}function PymolScriptGenerator(){function t(){return"reinitialize;"}function e(t){return"bg_color "+v(t)+";"}function n(t){return"fetch "+t+", async=0;"}function i(t){return b[t]}function a(t){return"color "+v(t)+", sele;"}function o(t){return"select chain "+t+";"}function r(t){return"select (chain "+t+") and (ss h);"}function l(t){return"select (chain "+t+") and (ss s);"}function u(t,e){return"select (resi "+t.join(",")+") and (chain "+e+");"}function s(t,e){return"select ((resi "+t.join(",")+") and (chain "+e+") and (not name c+n+o));"}function c(t){return"set transparency, "+t/10+", sele;\nset cartoon_transparency, "+t/10+", sele;\nset sphere_transparency, "+t/10+", sele;\nset stick_transparency, "+t/10+", sele;"}function d(){return c(0)}function p(){return"show spheres, sele; show sticks, sele; alter sele, vdw=0.50;"}function m(){return"hide spheres, sele; hide sticks, sele;"}function h(t){return"spectrum count, rainbow_rev, sele"}function f(t){return"util.cbaw sele;"}function g(){return"hide everything,not resn asp+glu+arg+lys+his+asn+thr+cys+gln+tyr+ser+gly+ala+leu+val+ile+met+trp+phe+pro"}function v(t){return t.replace("#","0x")}var b={ballAndStick:"hide everything; show spheres; show sticks; alter all, vdw=0.50",spaceFilling:"hide everything; show spheres;",ribbon:"hide everything; show ribbon;",cartoon:"hide everything; show cartoon;",trace:"hide everything; show ribbon;"};this.loadPdb=n,this.setScheme=i,this.setColor=a,this.selectChain=o,this.selectAlphaHelix=r,this.selectBetaSheet=l,this.rainbowColor=h,this.cpkColor=f,this.hideBoundMolecules=g,this.setTransparency=c,this.makeOpaque=d,this.selectPositions=u,this.selectSideChains=s,this.enableBallAndStick=p,this.disableBallAndStick=m,this.reinitialize=t,this.bgColor=e}function AbstractDataProxy(t){var e=this;e._defaultOpts={initMode:"lazy",servletName:"",data:{}},e._options=jQuery.extend(!0,{},e._defaultOpts,t),e.init=function(){e.isFullInit()?e.fullInit(e._options):e.lazyInit(e._options)},e.lazyInit=function(t){},e.fullInit=function(t){},e.isFullInit=function(){return!("lazy"===e._options.initMode.toLowerCase())}}function MutationAlignerDataProxy(t){function e(t){r=t.data}function n(t,e){var n=t.pfamAccession;if(null==n)return void e(null);if(void 0==r[n]){if(i.isFullInit())return void e(null);var a=function(t){r[n]=t,e(t)};$.getJSON(o.servletName,t,a)}else e(r[n])}var i=this,a={servletName:"getMutationAligner.json"},o=jQuery.extend(!0,{},a,t);AbstractDataProxy.call(this,o),o=i._options;var r={};i.fullInit=e,i.getMutationAlignerData=n}function MutationDataProxy(t){function e(t){var e=t.data,n=new MutationCollection(e);d.processMutationData(n)}function n(){return m}function i(){return p}function a(){return c.geneList}function o(){return d}function r(t,e){var n=t.trim().split(/\s+/),i=[],a=[],o=d.getMutationGeneMap();if(_.each(n,function(t,e){t=t.toUpperCase();var n=o[t];void 0==n||0==n.length?i.push(t):a=a.concat(n)}),u.isFullInit())e(a);else{var r=function(t){var n=new MutationCollection(t);d.processMutationData(n),a=a.concat(t),e(a)};if(i.length>0){var l=c.params;l.geneList=i.join(" "),$.ajax({type:"POST",url:c.servletName,data:l,success:r,error:function(){console.log("[MutationDataProxy.getMutationData] error retrieving mutation data for genetic profiles: "+l.geneticProfiles),r([])},dataType:"json"})}else e(a)}}function l(){return!0}var u=this,s={servletName:"getMutationData.json",geneList:"",params:{}},c=jQuery.extend(!0,{},s,t);AbstractDataProxy.call(this,c),c=u._options;var d=new MutationDetailsUtil,p=c.geneList.trim().split(/\s+/),m=c.geneList.trim().split(/\s+/).sort();u.fullInit=e,u.getMutationData=r,u.getGeneList=n,u.getRawGeneList=a,u.getUnsortedGeneList=i,u.getMutationUtil=o,u.hasData=l}function PancanMutationDataProxy(t){function e(t){var e=t.data;c=e.byKeyword,d=e.byProteinChange,m=e.byGeneSymbol,p=e.byProteinPosition}function n(t,e,n){var a=t.cmd,o=t.q;if(null==a)n(null);else if("byKeywords"==a){var r=null==o?e.getAllKeywords():o.split(",");i(a,r,c,["keyword"],n)}else if("byHugos"==a){var l=null==o?e.getAllGenes():o.split(",");i(a,l,m,["hugo"],n)}else if("byProteinChanges"==a){var u=null==o?e.getAllProteinChanges():o.split(",");i(a,u,d,["protein_change"],n)}else if("byProteinPos"==a){var s=null==o?e.getAllProteinPosStarts():o.split(",");i(a,s,p,["hugo","protein_pos_start"],n)}else n(null)}function i(t,e,n,i,u){var c=o(e,n),d=r(c);d.length>0&&!l.isFullInit()?$.getJSON(s.servletName,{cmd:t,q:d.join(",")},function(t){a(t,c,n,i,u)}):a([],c,n,i,u)}function a(t,e,n,i,a){_.each(t,function(t,a){var o=[];_.each(i,function(e,n){o.push(t[e])});var r=o.join("_");null==n[r]&&(n[r]=[]),null==e[r]&&(e[r]=[]),n[r].push(t),e[r].push(t)});var o=[];_.each(e,function(t){o=o.concat(t)}),a(o)}function o(t,e){var n={};return _.each(t,function(t){n[t]=e[t]}),n}function r(t){var e=[];return _.each(_.keys(t),function(n){null==t[n]&&e.push(n)}),e}var l=this,u={servletName:"pancancerMutations.json"},s=jQuery.extend(!0,{},u,t);AbstractDataProxy.call(this,s),s=l._options;var c={},d={},p={},m={};l.fullInit=e,l.getPancanData=n}function PdbDataProxy(t){function e(t){var e=t.data;_.each(_.keys(e.pdbData),function(t){var n=PdbDataUtil.processPdbData(e.pdbData[t]);m[t]=n,h[t]=PdbDataUtil.allocateChainRows(n)}),f=e.infoData,g=e.summaryData,v=e.positionData}function n(t,e,n){var a=e.alignments,o=i(t,e);if(s.isFullInit()||null!=v[o])return void n(v[o]||{});var r=p.getProteinPositions(t),l={};_.each(r,function(t,n){t.start>-1&&t.start>=e.mergedAlignment.uniprotFrom&&t.start<=e.mergedAlignment.uniprotTo&&(l[t.start]=t.start),t.end>t.start&&t.end>=e.mergedAlignment.uniprotFrom&&t.end<=e.mergedAlignment.uniprotTo&&(l[t.end]=t.end)});var u=[];for(var c in l)u.push(l[c]);var m=[];a.each(function(t,e){m.push(t.alignmentId)});var h=function(e){var i={},a=p.getMutationGeneMap()[t];if(null!=e.positionMap)for(var r=0;r<a.length;r++){var l=e.positionMap[a[r].getProteinStartPos()],u=l,s=a[r].mutationType;null!=s&&"in_frame_del"===s.toLowerCase()&&(u=e.positionMap[a[r].proteinPosEnd]||u),null!=l&&null!=u&&(i[a[r].mutationId]={start:l,end:u})}o&&(v[o]=i),n(i)};u.length>0?$.getJSON(d.servletName,{positions:u.join(" "),alignments:m.join(" ")},h):n({})}function i(t,e){var n=null;return e.alignments.length>0&&(n=t+"_"+e.alignments.at(0).pdbId+"_"+e.chainId),n}function a(t,e){if(s.isFullInit())return void e(m[t]);if(void 0==m[t]){var n=function(n){var i=PdbDataUtil.processPdbData(n);m[t]=i,e(i)};$.getJSON(d.servletName,{uniprotId:t},n)}else e(m[t])}function o(t,e){s.isFullInit()||void 0!=h[t]?e(h[t]):a(t,function(n){var i=PdbDataUtil.allocateChainRows(n);h[t]=i,e(i)})}function r(t,e){if(s.isFullInit()||void 0!=g[t])e(g[t]);else{var n=function(n){g[t]=n,e(n)};$.getJSON(d.servletName,{uniprotId:t,type:"summary"},n)}}function l(t,e){var n=function(t){var n=t&&t.alignmentCount>0;e(n)};r(t,n)}function u(t,e){var n=t.trim().split(/\s+/),i=[],a={};if(_.each(n,function(t,e){var n=f[t];void 0==n||0==n.length?i.push(t):a[t]=n}),s.isFullInit())return void e(a);var o={};if(i.length>0){var r=function(t){_.each(n,function(e,n){null!=t[e]&&(f[e]=t[e],a[e]=t[e])}),e(a)};o.pdbIds=i.join(" "),$.post(d.servletName,o,r,"json")}else e(a)}var s=this,c={servletName:"get3dPdb.json",mutationUtil:{}},d=jQuery.extend(!0,{},c,t);AbstractDataProxy.call(this,d),d=s._options;var p=d.mutationUtil,m={},h={},f={},g={},v={};s.fullInit=e,s.hasPdbData=l,s.getPdbData=a,s.getPdbRowData=o,s.getPdbInfo=u,s.getPositionMap=n}function PfamDataProxy(t){function e(t){r=t.data}function n(t,e){var n=t.geneSymbol;if(null==n)return void e(null);if(void 0==r[n]){if(i.isFullInit())return void e(null);var a=function(t){r[n]=t,e(t)};$.getJSON(o.servletName,t,a)}else e(r[n])}var i=this,a={servletName:"getPfamSequence.json"},o=jQuery.extend(!0,{},a,t);AbstractDataProxy.call(this,o),o=i._options;var r={};i.fullInit=e,i.getPfamData=n}function PortalDataProxy(t){function e(t){r=t.data}function n(t,e){var n={},i={};_.each(_.keys(t),function(e,a){null==r[e]?i[e]=t[e]:n[e]=r[e]});var a=function(t){_.each(_.keys(t),function(e,n){r[e]=t[e]}),_.isFunction(e)&&e(jQuery.extend(!0,{},n,t))};_.isEmpty(i)?a(n):$.getJSON(o.servletName,i,a)}var i=this,a={servletName:"portalMetadata.json"},o=jQuery.extend(!0,{},a,t);AbstractDataProxy.call(this,o),o=i._options;var r={};i.fullInit=e,i.getPortalData=n}function AdvancedDataTable(t){var e=this,n=null;e._defaultOpts={el:"",columns:{},columnOrder:[],columnVisibility:{},columnSearch:{},columnRender:{},columnSort:{},columnFilter:{},columnData:{},additionalData:{},columnTooltips:{},eventListeners:{},customSort:{},filteringDelay:0,dataTableOpts:{}},e._options=jQuery.extend(!0,{},e._defaultOpts,t),e._dispatcher={},_.extend(e._dispatcher,Backbone.Events),e._dataTable=null,e._visibilityValue=function(t){return"hidden"},e._searchValue=function(t){return!1},e.renderTable=function(t){var i=e._options.columnOrder,a=n=DataTableUtil.buildColumnIndexMap(i),o=DataTableUtil.buildColumnNameMap(e._options.columns),r=DataTableUtil.buildColumnVisMap(i,e._visibilityValue);e._visiblityMap=r;var l=DataTableUtil.buildColumnSearchMap(i,e._searchValue),u=DataTableUtil.getHiddenColumns(i,a,r),s=DataTableUtil.getExcludedColumns(i,a,r),c=DataTableUtil.getNonSearchableColumns(i,a,l);e._addSortFunctions(),e._dataTable=e._initDataTable($(e._options.el),t,e._options.columns,o,a,u,s,c),e._addEventListeners(a),e._options.filteringDelay>0&&e._dataTable.fnSetFilteringDelay(e._options.filteringDelay)},e._initDataTableOpts=function(t,e,n,i,a,o,r,l){return null},e._initDataTable=function(t,n,i,a,o,r,l,u){var s=e._initDataTableOpts(t,n,i,a,o,r,l,u),c=DataTableUtil.getColumnData(o,e._options.columnRender,e._options.columnSort,e._options.columnFilter,e._options.columnData);return s.aoColumnDefs=s.aoColumnDefs.concat(c),s=jQuery.extend(!0,{},e._options.dataTableOpts,s),t.dataTable(s)},e._addSortFunctions=function(){_.each(_.pairs(e._options.customSort),function(t){var e=t[0],n=t[1];jQuery.fn.dataTableExt.oSort[e]=n})},e._addEventListeners=function(t){null!=e.getDataTable()&&_.each(e._options.eventListeners,function(n){n(e.getDataTable(),e._dispatcher,t)})},e._addColumnTooltips=function(t){t=t||{};var n=$(e._options.el);_.each(_.keys(e._options.columnTooltips),function(i){if("excluded"!=e._visiblityMap[i]){var a=e._options.columnTooltips[i];_.isFunction(a)&&a(n,t)}})},e._loadAdditionalData=function(t){t=t||{};$(e._options.el);_.each(_.keys(e._options.additionalData),function(n){if("excluded"!=e._visiblityMap[n]){var i=e._options.additionalData[n];_.isFunction(i)&&i(t)}})},e.getColumnOptions=function(){return e._options.columns},e.getDataTable=function(){return e._dataTable},e.getIndexMap=function(){return n}}function Mutation3dVis(t,e){function n(){E=cbio.util.browser.msie?new JmolWrapper(!0):new JSmolWrapper,E.init(t,H.appOptions,H.frame)}function i(t){k=$(t);var e=k.find(".mutation-3d-vis-container");e.css("width",H.appOptions.width),e.css("height",H.appOptions.height+H.containerPadding),E.updateContainer(e)}function a(){R="ON"==R?"OFF":"ON";var t=j.spin(R);E.script(t)}function o(){var t=j.generateVisualStyleScript(B,q,H);t=t.concat(w(O)),t=t.join(" "),E.script(t)}function r(){if(null!=k){k.show();var t=parseInt(k.css("top"));0>t&&(null!=U&&U>0?k.css("top",U):k.css("top",0))}}function l(){if(null!=k){var t=parseInt(k.css("top"));t>0&&(U=t),k.css("top",-9999)}}function u(){null!=k&&(k.css({overflow:"hidden",height:H.minimizedHeight}),V=!0)}function s(){null!=k&&(k.css({overflow:"",height:""}),V=!1)}function c(){null!=k&&(V?s():u())}function d(){var t=parseInt(k.css("top")),e=-9999==t||k.is(":hidden");return!e}function p(t,e,n){var i=[];if(O={},!t||!e)return i;q=e,N=t,i=h(t,e);var a=[];return a.push(j.loadPdb(t)),a=a.concat(j.generateVisualStyleScript(B,q,H)),a=a.join(" "),E.script(a,n),i}function m(){var t=[];if(O={},null==N||null==q)return t;t=h(N,q);var e=[];return e=e.concat(j.generateVisualStyleScript(B,q,H)),e=e.join(" "),E.script(e),t}function h(t,e){var n=f(t,e,H,j);return B=n.colorMap,n.mappedMutations}function f(t,e,n,i){var a=[],o={},r=n.mutationColor;for(var l in e.positionMap){var u=e.positionMap[l];if(_.isFunction(n.mutationColorMapper)&&(r=n.mutationColorMapper(l,t,e)),null!=r){null==o[r]&&(o[r]={});var s=i.scriptPosition(u);o[r][s]=s,a.push(l)}}return _.each(o,function(t,e,n){n[e]=_.values(t)}),{colorMap:o,mappedMutations:a}}function g(){if(1!=_.size(O))return!1;var t=[];return _.each(O,function(e){t=t.concat(S(e))}),t=t.join(" "),E.script(t),!0}function v(){var t=[];t.push(j.defaultCenter()),t=t.join(" "),E.script(t)}function b(t){if(null==q)return!1;var e=t.mutations[0].mutationId,n=D(e);return n.length>0?(n=n.join(" "),E.script(n),!0):(y(),!1)}function y(){var t=[];t.push(j.zoom(H.defaultZoom)),t.push(j.defaultCenter()),t=t.join(" "),E.script(t)}function T(t,e){if(null==q)return 0;e&&(O={});var n=j.generateVisualStyleScript(B,q,H),i=0;return _.each(t,function(t,e){var n=t.mutations[0].mutationId,a=q.positionMap[n];null!=a&&(O[n]=a,i++)}),n=n.concat(w(O)),n=n.join(" "),E.script(n),i}function C(){var t=w(O);t=t.join(" "),E.script(t)}function P(){O={};var t=j.generateVisualStyleScript(B,q,H);t=t.join(" "),E.script(t)}function w(t){return j.generateHighlightScript(t,H.highlightColor,H,q)}function S(t){var e=[];return e.push(j.center(t,q.chainId)),e}function D(t){var e=[],n=q.positionMap[t];return null!=n&&(e.push(j.zoom(H.focusZoom)),e.push(j.center(n,q.chainId))),e}function x(){E.script(j.defaultZoomIn())}function M(){E.script(j.defaultZoomOut())}function A(){E.script(j.zoom(H.defaultZoom))}function I(t){E.script(j.zoom(t))}function F(t){H=jQuery.extend(!0,{},H,t)}function L(){var t=new PymolScriptGenerator,e=[];return e.push(t.reinitialize()),e.push(t.bgColor(H.appOptions.color)),e.push(t.loadPdb(N)),e=e.concat(t.generateVisualStyleScript(B,q,H)),e=e.concat(t.generateHighlightScript(O,H.highlightColor,H,q)),e.push(t.selectNone()),e=e.join("\n")}var k=null,E=null,V=!1,B=null,O={},q=null,N=null,R="OFF",U=null,z={appOptions:{width:400,height:300,debug:!1,color:"white"},frame:"jsmol_frame.html",proteinScheme:"cartoon",restrictProtein:!1,defaultColor:"#DDDDDD",structureColors:{alphaHelix:"#FFA500",betaSheet:"#0000FF",loop:"#DDDDDD"},defaultTranslucency:5,chainColor:"#888888",chainTranslucency:0,colorProteins:"uniform",colorMutations:"byMutationType",mutationColor:"#8A2BE2",highlightColor:"#FFDD00",highlightGradient:["#FFDD00","#000000"],addGlowEffect:!1,displaySideChain:"highlighted",defaultZoom:100,focusZoom:250,containerPadding:10,minimizedHeight:10,mutationColorMapper:function(t,e,n){return"#FF0000"}},H=jQuery.extend(!0,{},z,e),j=new JmolScriptGenerator;return{init:n,show:r,hide:l,minimize:u,maximize:s,toggleSize:c,isVisible:d,reload:p,refresh:m,focusOn:b,center:g,resetCenter:v,highlight:T,resetHighlight:P,refreshHighlight:C,zoomIn:x,zoomOut:M,zoomActual:A,zoomTo:I,resetFocus:y,updateContainer:i,toggleSpin:a,reapplyStyle:o,updateOptions:F,generatePymolScript:L}}function MutationDetailsTable(t,e,n,i){function a(t,a,r,l,u,s,c,d){var p=DataTableUtil.getColumnOptions(r,u),h={aaData:a,aoColumns:p,aoColumnDefs:[{bVisible:!1,aTargets:s},{bSearchable:!1,aTargets:d}],oColVis:{aiExclude:c},oTableTools:{aButtons:[{sExtends:"text",sButtonText:"Download",mColumns:o(r,c),fnCellRender:function(t,e,n,i){var a=t;return-1!=t.indexOf("<")&&-1!=t.indexOf(">")&&(a=$(t).text()),e===u.proteinChange&&(a=a.replace(/(\s)3D/,"")),a.trim()},fnClick:function(t,n){var i=this.fnGetTableData(n),a={filename:"mutation_table_"+e+".tsv",contentType:"text/plain;charset=utf-8",preProcess:!1};cbio.download.initDownload(i,a)}}]},fnDrawCallback:function(a){m._addColumnTooltips({gene:e,mutationUtil:n,dataProxies:i,additionalData:T}),m._addEventListeners(u);var o=a.oPreviousSearch.sSearch;v&&b!=o&&(g.trigger(MutationDetailsEvents.MUTATION_TABLE_FILTERED,t),y=o),b=o},fnRowCallback:function(t,e,n,i){var a=e[u.datum].mutation;$(t).attr("id",a.mutationId),$(t).addClass(a.mutationSid),$(t).addClass("mutation-table-data-row")},fnCreatedRow:function(t,e,n){$(t).find('a[href=""]').remove(),$(t).find('span.mutation-table-additional-protein-change[alt=""]').remove()},fnInitComplete:function(t,e){m._loadAdditionalData({dataProxies:i,indexMap:m.getIndexMap(),additionalData:T,dataTable:this})},fnHeaderCallback:function(t,e,n,i,a){$(t).find("th").addClass("mutation-details-table-header"),m._addHeaderTooltips(t,l)}};return h}function o(t,e){for(var n=[],i=0;i<=_.keys(t).length;i++)n.push(i);return _.difference(n,e)}function r(t){var i=f.columnVisibility[t],a=i;return i?_.isFunction(i)&&(a=i(n,e)):a="hidden",a}function l(t){var e=f.columnSearch[t],n=e;return null==e?n=!1:_.isFunction(e)&&(n=e()),n}function u(t){null!=m.getDataTable()&&_.each(f.eventListeners,function(t){t(m.getDataTable(),g,n,e)})}function s(t){v=t}function c(){b="",y=""}function d(){return y}function p(t,e){var n=MutationViewsUtil.defaultTableTooltipOpts(),i={};jQuery.extend(!0,i,n),i.position={my:"bottom center",at:"top center",viewport:$(window)},$(t).find("th").each(function(){var t=$(this).text(),n=e[t];if(null!=n){var a=f.columns[n].tip,o={};_.isObject(a)?jQuery.extend(!0,o,i,a):(i.content=a,o=i),$(this).qtip(o)}})}var m=this,h={el:"#mutation_details_table_d3",columns:{datum:{sTitle:"datum",tip:""},mutationId:{sTitle:"Mutation ID",tip:"Mutation ID",sType:"string"},mutationSid:{sTitle:"Mutation SID",tip:"",sType:"string"},caseId:{sTitle:"Sample ID",tip:"Sample ID",sType:"string"},cancerStudy:{sTitle:"Cancer Study",tip:"Cancer Study",sType:"string"},tumorType:{sTitle:"Cancer Type",tip:"Cancer Type",sType:"string"},proteinChange:{sTitle:"AA change",tip:"Protein Change",sType:"numeric"},mutationType:{sTitle:"Type",tip:"Mutation Type",sType:"string",sClass:"center-align-td"},cna:{sTitle:"Copy #",tip:"Copy-number status of the mutated gene",sType:"numeric",sClass:"center-align-td"},cosmic:{sTitle:"COSMIC",tip:"Overlapping mutations in COSMIC",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]},mutationStatus:{sTitle:"MS",tip:"Mutation Status",sType:"string",sClass:"center-align-td"},validationStatus:{sTitle:"VS",tip:"Validation Status",sType:"string",sClass:"center-align-td"},mutationAssessor:{sTitle:"Mutation Assessor",tip:"Predicted Functional Impact Score (via Mutation Assessor) for missense mutations",sType:"numeric",sClass:"center-align-td",asSorting:["desc","asc"],sWidth:"2%"},sequencingCenter:{sTitle:"Center",tip:"Sequencing Center",sType:"string",sClass:"center-align-td"},chr:{sTitle:"Chr",tip:"Chromosome",sType:"string"},startPos:{sTitle:"Start Pos",tip:"Start Position",sType:"numeric",sClass:"right-align-td"},endPos:{sTitle:"End Pos",tip:"End Position",sType:"numeric",sClass:"right-align-td"},referenceAllele:{sTitle:"Ref",tip:"Reference Allele",sType:"string"},variantAllele:{sTitle:"Var",tip:"Variant Allele",sType:"string"},tumorFreq:{sTitle:"Allele Freq (T)",tip:"Variant allele frequency<br> in the tumor sample",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]},normalFreq:{sTitle:"Allele Freq (N)",tip:"Variant allele frequency<br> in the normal sample",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]},tumorRefCount:{sTitle:"Var Ref",tip:"Variant Ref Count",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]},tumorAltCount:{sTitle:"Var Alt",tip:"Variant Alt Count",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]},normalRefCount:{sTitle:"Norm Ref",tip:"Normal Ref Count",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]},normalAltCount:{sTitle:"Norm Alt",tip:"Normal Alt Count",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]},igvLink:{sTitle:"BAM",tip:"Link to BAM file",sType:"string",sClass:"center-align-td"},mutationCount:{sTitle:"#Mut in Sample",tip:"Total number of<br> nonsynonymous mutations<br> in the sample",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"],sWidth:"2%"},cBioPortal:{sTitle:"cBioPortal",tip:"Mutation frequency in cBioPortal",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]}},columnOrder:["datum","mutationId","mutationSid","caseId","cancerStudy","tumorType","proteinChange","mutationType","cna","cBioPortal","cosmic","mutationStatus","validationStatus","mutationAssessor","sequencingCenter","chr","startPos","endPos","referenceAllele","variantAllele","tumorFreq","normalFreq","tumorRefCount","tumorAltCount","normalRefCount","normalAltCount","igvLink","mutationCount"],columnVisibility:{datum:"excluded",proteinChange:"visible",caseId:function(t,e){return t.containsCaseId(e)?"visible":"hidden"},mutationType:function(t,e){return t.containsMutationType(e)?"visible":"hidden"},mutationAssessor:function(t,e){return t.containsFis(e)?"visible":"hidden"},cosmic:"visible",mutationCount:function(t,e){return t.containsMutationCount(e)?"visible":"hidden"},mutationId:"excluded",mutationSid:"excluded",cancerStudy:"excluded",cna:function(t,e){return t.containsCnaData(e)?"visible":"hidden"},tumorFreq:function(t,e){return t.containsAlleleFreqT(e)?"visible":"hidden"},igvLink:function(t,e){return t.containsIgvLink(e)?"visible":"excluded"},mutationStatus:function(t,e){return t.containsGermline(e)?"visible":"hidden"},validationStatus:function(t,e){return t.containsValidStatus(e)?"visible":"hidden"},tumorType:function(t,e){var n=t.distinctTumorTypeCount(e);return n>1?"visible":n>0?"hidden":"excluded"},cBioPortal:"excluded"},columnSearch:{caseId:!0,mutationId:!0,mutationSid:!0,cancerStudy:!0,proteinChange:!0,tumorType:!0,mutationType:!0},columnRender:{mutationId:function(t){var e=t.mutation;return e.mutationId},mutationSid:function(t){var e=t.mutation;return e.mutationSid},caseId:function(t){var e=t.mutation,n=MutationDetailsTableFormatter.getCaseId(e.caseId),i={};i.linkToPatientView=e.linkToPatientView,i.caseId=n.text,i.caseIdClass=n.style,i.caseIdTip=n.tip;var a=BackboneTemplateCache.getTemplateFn("mutation_table_case_id_template");return a(i)},proteinChange:function(t){var e=t.mutation,n=MutationDetailsTableFormatter.getProteinChange(e),i={};i.proteinChange=n.text,i.proteinChangeClass=n.style,
i.proteinChangeTip=n.tip,i.additionalProteinChangeTip=n.additionalTip,i.pdbMatchLink=MutationDetailsTableFormatter.getPdbMatchLink(e);var a=BackboneTemplateCache.getTemplateFn("mutation_table_protein_change_template");return a(i)},cancerStudy:function(t){var e=t.mutation,n={};n.cancerStudy=e.cancerStudy,n.cancerStudyShort=e.cancerStudyShort,n.cancerStudyLink=e.cancerStudyLink;var i=BackboneTemplateCache.getTemplateFn("mutation_table_cancer_study_template");return i(n)},tumorType:function(t){var e=t.mutation,n=MutationDetailsTableFormatter.getTumorType(e),i={};i.tumorType=n.text,i.tumorTypeClass=n.style,i.tumorTypeTip=n.tip;var a=BackboneTemplateCache.getTemplateFn("mutation_table_tumor_type_template");return a(i)},mutationType:function(t){var e=t.mutation,n=MutationDetailsTableFormatter.getMutationType(e.mutationType),i={};i.mutationTypeClass=n.style,i.mutationTypeText=n.text;var a=BackboneTemplateCache.getTemplateFn("mutation_table_mutation_type_template");return a(i)},cosmic:function(t){var e=t.mutation,n=MutationDetailsTableFormatter.getCosmic(e.cosmicCount),i={};i.cosmicClass=n.style,i.cosmicCount=n.count;var a=BackboneTemplateCache.getTemplateFn("mutation_table_cosmic_template");return a(i)},cna:function(t){var e=t.mutation,n=MutationDetailsTableFormatter.getCNA(e.cna),i={};i.cna=n.text,i.cnaClass=n.style,i.cnaTip=n.tip;var a=BackboneTemplateCache.getTemplateFn("mutation_table_cna_template");return a(i)},mutationCount:function(t){var e=t.mutation,n=MutationDetailsTableFormatter.getIntValue(e.mutationCount),i={};i.mutationCount=n.text,i.mutationCountClass=n.style;var a=BackboneTemplateCache.getTemplateFn("mutation_table_mutation_count_template");return a(i)},normalFreq:function(t){var e=t.mutation,n=MutationDetailsTableFormatter.getAlleleCount(e.normalAltCount),i=MutationDetailsTableFormatter.getAlleleFreq(e.normalFreq,e.normalAltCount,e.normalRefCount,"simple-tip"),a={};a.normalFreq=i.text,a.normalFreqClass=i.style,a.normalFreqTipClass=i.tipClass,a.normalTotalCount=i.total,a.normalAltCount=n.text;var o=BackboneTemplateCache.getTemplateFn("mutation_table_normal_freq_template");return o(a)},tumorFreq:function(t){var e=t.mutation,n=MutationDetailsTableFormatter.getAlleleCount(e.tumorAltCount),i=MutationDetailsTableFormatter.getAlleleFreq(e.tumorFreq,e.tumorAltCount,e.tumorRefCount,"simple-tip"),a={};a.tumorFreq=i.text,a.tumorFreqClass=i.style,a.tumorFreqTipClass=i.tipClass,a.tumorTotalCount=i.total,a.tumorAltCount=n.text;var o=BackboneTemplateCache.getTemplateFn("mutation_table_tumor_freq_template");return o(a)},mutationAssessor:function(t){var e=t.mutation,n=MutationDetailsTableFormatter.getFis(e.functionalImpactScore,e.fisValue),i={};i.fisClass=n.fisClass,i.omaClass=n.omaClass,i.fisText=n.text;var a=BackboneTemplateCache.getTemplateFn("mutation_table_mutation_assessor_template");return a(i)},mutationStatus:function(t){var e=t.mutation,n=MutationDetailsTableFormatter.getMutationStatus(e.mutationStatus),i={};i.mutationStatusTip=n.tip,i.mutationStatusClass=n.style,i.mutationStatusText=n.text;var a=BackboneTemplateCache.getTemplateFn("mutation_table_mutation_status_template");return a(i)},validationStatus:function(t){var e=t.mutation,n=MutationDetailsTableFormatter.getValidationStatus(e.validationStatus),i={};i.validationStatusTip=n.tip,i.validationStatusClass=n.style,i.validationStatusText=n.text;var a=BackboneTemplateCache.getTemplateFn("mutation_table_validation_status_template");return a(i)},normalRefCount:function(t){var e=t.mutation,n=MutationDetailsTableFormatter.getAlleleCount(e.normalRefCount),i={};i.normalRefCount=n.text,i.normalRefCountClass=n.style;var a=BackboneTemplateCache.getTemplateFn("mutation_table_normal_ref_count_template");return a(i)},normalAltCount:function(t){var e=t.mutation,n=MutationDetailsTableFormatter.getAlleleCount(e.normalAltCount),i={};i.normalAltCount=n.text,i.normalAltCountClass=n.style;var a=BackboneTemplateCache.getTemplateFn("mutation_table_normal_alt_count_template");return a(i)},tumorRefCount:function(t){var e=t.mutation,n=MutationDetailsTableFormatter.getAlleleCount(e.tumorRefCount),i={};i.tumorRefCount=n.text,i.tumorRefCountClass=n.style;var a=BackboneTemplateCache.getTemplateFn("mutation_table_tumor_ref_count_template");return a(i)},tumorAltCount:function(t){var e=t.mutation,n=MutationDetailsTableFormatter.getAlleleCount(e.tumorAltCount),i={};i.tumorAltCount=n.text,i.tumorAltCountClass=n.style;var a=BackboneTemplateCache.getTemplateFn("mutation_table_tumor_alt_count_template");return a(i)},startPos:function(t){var e=t.mutation,n=MutationDetailsTableFormatter.getIntValue(e.startPos),i={};i.startPos=n.text,i.startPosClass=n.style;var a=BackboneTemplateCache.getTemplateFn("mutation_table_start_pos_template");return a(i)},endPos:function(t){var e=t.mutation,n=MutationDetailsTableFormatter.getIntValue(e.endPos),i={};i.endPos=n.text,i.endPosClass=n.style;var a=BackboneTemplateCache.getTemplateFn("mutation_table_end_pos_template");return a(i)},sequencingCenter:function(t){var e=t.mutation;return e.sequencingCenter},chr:function(t){var e=t.mutation;return e.chr},referenceAllele:function(t){var e=t.mutation;return e.referenceAllele},variantAllele:function(t){var e=t.mutation;return e.variantAllele},igvLink:function(t){var e=t.mutation,n={};n.igvLink=MutationDetailsTableFormatter.getIgvLink(e);var i=BackboneTemplateCache.getTemplateFn("mutation_table_igv_link_template");return i(n)},cBioPortal:function(t){t.mutation;if(null==t.cBioPortal){var e={loaderImage:"images/ajax-loader.gif",width:15,height:15},n=BackboneTemplateCache.getTemplateFn("mutation_table_placeholder_template");return n(e)}var i=MutationDetailsTableFormatter.getCbioPortal(t.cBioPortal),e={};e.portalFrequency=i.frequency,e.portalClass=i.style;var n=BackboneTemplateCache.getTemplateFn("mutation_table_cbio_portal_template");return n(e)}},columnTooltips:{simple:function(t,e){var n=MutationViewsUtil.defaultTableTooltipOpts();$(t).find(".simple-tip").qtip(n)},cosmic:function(t,e){var n=e.gene,i=e.mutationUtil,a=MutationViewsUtil.defaultTableTooltipOpts();$(t).find(".mutation_table_cosmic").each(function(){var t=this,e=$(t).closest("tr.mutation-table-data-row").attr("id"),o=i.getMutationIdMap()[e],r={};jQuery.extend(!0,r,a),r.content={text:"NA"},r.events={render:function(e,i){var a={cosmic:o.cosmic,keyword:o.keyword,geneSymbol:n,total:$(t).text()},r=$(this).find(".qtip-content"),l=new CosmicTipView({el:r,model:a});l.render()}},$(t).qtip(r)})},mutationAssessor:function(t,e){var n=(e.gene,e.mutationUtil),i=MutationViewsUtil.defaultTableTooltipOpts();$(t).find(".oma_link").each(function(){var t=$(this).closest("tr.mutation-table-data-row").attr("id"),e=n.getMutationIdMap()[t],a=MutationDetailsTableFormatter.getFis(e.functionalImpactScore,e.fisValue),o={};jQuery.extend(!0,o,i),o.content={text:"NA"},o.events={render:function(t,n){var i={impact:a.value,xvia:e.xVarLink.replace("getma.org","mutationassessor.org"),msaLink:e.msaLink.replace("getma.org","mutationassessor.org"),pdbLink:e.pdbLink.replace("getma.org","mutationassessor.org")},o=$(this).find(".qtip-content"),r=new PredictedImpactTipView({el:o,model:i});r.render()}},$(this).qtip(o)})},cBioPortal:function(t,e){var n=e.gene,i=e.mutationUtil,a=e.dataProxies.portalProxy,o=e.additionalData,r=function(e,a,o){$(t).find(".mutation_table_cbio_portal").each(function(t,r){var l=$(this).closest("tr.mutation-table-data-row").attr("id"),u=i.getMutationIdMap()[l],s=o||u.cancerStudy;$(r).qtip({content:{text:"pancancer mutation bar chart is broken"},events:{render:function(t,i){var o={pancanMutationFreq:e,cancerStudyMetaData:a,cancerStudyName:s,geneSymbol:n,keyword:u.keyword,proteinPosStart:u.proteinPosStart,mutationType:u.mutationType,qtipApi:i},r=$(this),l=new PancanMutationHistTipView({el:r,model:o});l.render()}},hide:{fixed:!0,delay:100},style:{classes:"qtip-light qtip-rounded qtip-shadow",tip:!0},position:{my:"center right",at:"center left",viewport:$(window)}})})};null!=o.pancanFrequencies&&a.getPortalData({cancerStudyMetaData:!0,cancerStudyName:!0},function(t){r(o.pancanFrequencies,t.cancerStudyMetaData,t.cancerStudyName)})}},eventListeners:{windowResize:function(t,e,n,i){$(window).one("resize",function(){t.is(":visible")&&t.fnAdjustColumnSizing()})},igvLink:function(t,e,n,i){$(t).find(".igv-link").off("click").on("click",function(t){t.preventDefault();var e=$(this).closest("tr.mutation-table-data-row").attr("id"),i=n.getMutationIdMap()[e],a=i.igvLink;$.getJSON(a,function(t){prepIGVLaunch(t.bamFileUrl,t.encodedLocus,t.referenceGenome,t.trackName)})})},proteinChange3d:function(t,e,n,i){$(t).find(".mutation-table-3d-link").off("click").on("click",function(t){t.preventDefault();var n=$(this).closest("tr.mutation-table-data-row").attr("id");e.trigger(MutationDetailsEvents.PDB_LINK_CLICKED,n)})},proteinChange:function(t,e,n,i){$(t).find(".mutation-table-protein-change a").off("click").on("click",function(t){t.preventDefault();var n=$(this).closest("tr.mutation-table-data-row").attr("id");e.trigger(MutationDetailsEvents.PROTEIN_CHANGE_LINK_CLICKED,n)})}},columnSort:{mutationId:function(t){var e=t.mutation;return e.mutationId},mutationSid:function(t){var e=t.mutation;return e.mutationSid},caseId:function(t){var e=t.mutation;return e.caseId},proteinChange:function(t){var e=t.mutation.proteinChange,n=e.match(/.*[A-Z]([0-9]+)[^0-9]+/);return n&&n.length>1?parseInt(n[1]):-(1/0)},cancerStudy:function(t){var e=t.mutation;return e.cancerStudy},tumorType:function(t){var e=t.mutation;return e.tumorType},mutationType:function(t){var e=t.mutation;return e.mutationType},cosmic:function(t){var e=t.mutation;return MutationDetailsTableFormatter.assignIntValue(e.cosmicCount)},cna:function(t){var e=t.mutation;return MutationDetailsTableFormatter.assignIntValue(e.cna)},mutationCount:function(t){var e=t.mutation;return MutationDetailsTableFormatter.assignIntValue(e.mutationCount)},normalFreq:function(t){var e=t.mutation;return MutationDetailsTableFormatter.assignFloatValue(e.normalFreq)},tumorFreq:function(t){var e=t.mutation;return MutationDetailsTableFormatter.assignFloatValue(e.tumorFreq)},mutationAssessor:function(t){var e=t.mutation;return MutationDetailsTableFormatter.assignValueToPredictedImpact(e.functionalImpactScore,e.fisValue)},mutationStatus:function(t){var e=t.mutation;return e.mutationStatus},validationStatus:function(t){var e=t.mutation;return e.validationStatus},normalRefCount:function(t){var e=t.mutation;return MutationDetailsTableFormatter.assignIntValue(e.normalRefCount)},normalAltCount:function(t){var e=t.mutation;return MutationDetailsTableFormatter.assignIntValue(e.normalAltCount)},tumorRefCount:function(t){var e=t.mutation;return MutationDetailsTableFormatter.assignIntValue(e.tumorRefCount)},tumorAltCount:function(t){var e=t.mutation;return MutationDetailsTableFormatter.assignIntValue(e.tumorAltCount)},startPos:function(t){var e=t.mutation;return MutationDetailsTableFormatter.assignIntValue(e.startPos)},endPos:function(t){var e=t.mutation;return MutationDetailsTableFormatter.assignIntValue(e.endPos)},sequencingCenter:function(t){var e=t.mutation;return e.sequencingCenter},chr:function(t){var e=t.mutation;return e.chr},referenceAllele:function(t){var e=t.mutation;return e.referenceAllele},variantAllele:function(t){var e=t.mutation;return e.variantAllele},igvLink:function(t){var e=t.mutation;return e.igvLink},cBioPortal:function(t){var e=t.cBioPortal;return e||0}},columnFilter:{proteinChange:function(t){return t.mutation.proteinChange},cosmic:function(t){return t.mutation.cosmicCount},cna:function(t){return t.mutation.cna},mutationCount:function(t){return t.mutation.mutationCount},normalFreq:function(t){return t.mutation.normalFreq},tumorFreq:function(t){return t.mutation.tumorFreq},mutationAssessor:function(t){return t.mutation.functionalImpactScore},normalRefCount:function(t){return t.mutation.normalRefCount},normalAltCount:function(t){return t.mutation.normalAltCount},tumorRefCount:function(t){return t.mutation.tumorRefCount},tumorAltCount:function(t){return t.mutation.tumorAltCount},startPos:function(t){return t.mutation.startPos},endPos:function(t){return t.mutation.endPos}},columnData:{},additionalData:{cBioPortal:function(t){var e=t.dataProxies.pancanProxy,i=t.indexMap,a=t.dataTable,o=t.additionalData;e.getPancanData({cmd:"byProteinPos"},n,function(t){e.getPancanData({cmd:"byHugos"},n,function(e){var n=PancanMutationDataUtil.getMutationFrequencies({protein_pos_start:t,hugo:e});o.pancanFrequencies=n;var r=a.fnGetData();_.each(r,function(t,e){var o=t[i.datum].mutation.proteinPosStart;o>0?t[i.datum].cBioPortal=PancanMutationDataUtil.countByKey(n,o):t[i.datum].cBioPortal=0,a.fnUpdate(null,e,i.cBioPortal,!1,!1)}),r.length>0&&a.fnUpdate(null,0,i.cBioPortal)})})}},filteringDelay:600,dataTableOpts:{sDom:'<"H"<"mutation_datatables_filter"f>C<"mutation_datatables_info"i>>t<"F"<"mutation_datatables_download"T>>',bJQueryUI:!0,bPaginate:!1,bFilter:!0,sScrollY:"600px",bScrollCollapse:!0,oLanguage:{sInfo:"Showing _TOTAL_ mutation(s)",sInfoFiltered:"(out of _MAX_ total mutations)",sInfoEmpty:"No mutations to show"}}},f=jQuery.extend(!0,{},h,t);AdvancedDataTable.call(this,f),f=m._options;var g=m._dispatcher,v=!0,b="",y="",T={};this._initDataTableOpts=a,this._visibilityValue=r,this._searchValue=l,this._addEventListeners=u,this._addHeaderTooltips=p,this.setEventActive=s,this.getManualSearch=d,this.cleanFilters=c,this.dispatcher=this._dispatcher}function MutationDiagram(t,e,n,i){var a=this;a.listeners={},a.dispatcher={},_.extend(a.dispatcher,Backbone.Events),a.options=jQuery.extend(!0,{},a.defaultOpts,e),a.dataProxies=i,a.geneSymbol=t,a.data=n,a.pileups=null==n?null:n.pileups,a.highlighted={},a.multiSelect=!1,a.svg=null,a.bounds=null,a.gData=null,a.gLine=null,a.gLabel=null,a.xScale=null,a.yScale=null,a.topLabel=null,a.xAxisLabel=null,a.yAxisLabel=null,a.xMax=null,a.yMax=null,a.maxCount=null,a.mutationColorMap={},a.mutationPileupMap={}}function MutationHistogram(t,e,n){MutationDiagram.call(this,t,e,n)}function MutationPdbPanel(t,e,n,i){function a(t,e,n,i,a){var l=tt;_.each(n,function(n,o){_.each(n,function(n,u){var s=n.chain;if(s.alignments.length>0){var c=e.colors[u%e.colors.length],d=e.marginTop+(a+o)*(e.chainHeight+e.chainPadding),p=r(t,s,c,e,i,d);p.datum(n),nt[PdbDataUtil.chainKey(n.pdbId,n.chain.chainId)]=p,null==Q&&(Q=p),l++}})}),tt=l,o(n,e)}function o(t,e){var i=[],a=[];_.each(t,function(t,e){_.each(t,function(t,e){i.push(t.pdbId),a.push(nt[PdbDataUtil.chainKey(t.pdbId,t.chain.chainId)])})}),n.getPdbInfo(i.join(" "),function(t){_.each(a,function(t,n){var i=e.chainTipFn;i(t)})})}function r(t,e,n,i,a,o){for(var r=t.append("g").attr("class","pdb-chain-group").attr("opacity",1),l=i.chainHeight,u=new MergedAlignmentSegmentor(e.mergedAlignment);u.hasNextSegment();){var s=u.getNextSegment(),c=Math.abs(a(s.start)-a(s.end)),d=a(s.start);if(s.type==PdbDataUtil.ALIGNMENT_GAP){var p=r.append("line").attr("stroke",i.chainBorderColor).attr("stroke-width",i.chainBorderWidth).attr("x1",d).attr("y1",o+l/2).attr("x2",d+c).attr("y2",o+l/2);p.datum({initPos:{x:d,y:o+l/2}})}else{var m=r.append("rect").attr("fill",n).attr("opacity",e.mergedAlignment.identityPerc).attr("stroke",i.chainBorderColor).attr("stroke-width",i.chainBorderWidth).attr("x",d).attr("y",o).attr("width",c).attr("height",l);m.datum({initPos:{x:d,y:o}})}}return r}function l(t,e){var n=e.marginLeft-e.labelYPaddingRightV,i=e.marginTop+e.labelYPaddingTopV,a="middle",o="rotate(270, "+n+","+i+")",r="vertical";J.length<e.labelAlignThreshold&&(n=e.marginLeft-e.labelYPaddingRightH,i=e.marginTop+e.labelYPaddingTopH,a="start",o="rotate(0, "+n+","+i+")",r="horizontal");var l=t.append("g").attr("class","pdb-panel-y-axis-label-group").attr("opacity",1),s=l.append("text").attr("fill",e.labelYFontColor).attr("text-anchor",a).attr("x",n).attr("y",i).attr("class","pdb-panel-y-axis-label").attr("transform",o).style("font-family",e.labelYFont).style("font-size",e.labelYFontSize).style("font-weight",e.labelYFontWeight);_.isArray(e.labelY)?_.each(e.labelY,function(t,e){var i=0==e?0:10,a=0==e&&"vertical"==r?-5:0;s.append("tspan").attr("x",n+a).attr("dy",i).text(t)}):s.text(e.labelY);var c=u(l,n,i,r,e),d=e.yHelpTipFn;return d(c),s}function u(t,e,n,i,a){var o=12,r=12,l=e-o+2,u=a.marginTop;return"horizontal"==i&&(l=a.marginLeft-o-5,u=n-r+2),t.append("svg:image").attr("xlink:href","images/help.png").attr("class","pdb-panel-y-axis-help").attr("x",l).attr("y",u).attr("width",o).attr("height",r)}function s(){return Q}function c(t,e){return nt[t+":"+e]}function d(t,e){for(var n=-1,i=0;i<e.length;i++)if(e[i]>t){n=i;break}return-1==n&&(n=e.length-1),n}function p(t){var e=0,n=J.length;return e="auto"!=t?t:W.marginTop+W.marginBottom+n*(W.chainHeight+W.chainPadding)-W.chainPadding/2}function m(t){var e=0,n=J.length;return e=n>t?W.marginTop+t*(W.chainHeight+W.chainPadding)-W.chainPadding/2:p("auto")}function h(t,e,n){var i=t.append("svg");return i.attr("width",e),i.attr("height",n),i}function f(){J=PdbDataUtil.allocateChainRows(e),X=d(J.length,W.numRows);var t=$(W.el)[0],n=d3.select(t),o=W.numRows[0];at=m(o);var r=h(n,W.elWidth,at);K=r,a(r,W,J.slice(0,o),i,0),et[0]=!0,0!=W.labelY&&l(r,W),it=g(J),y()}function g(t){var e={};return _.each(t,function(t,n){_.each(t,function(t,i){e[PdbDataUtil.chainKey(t.pdbId,t.chain.chainId)]=n})}),e}function v(t,e,n){K.selectAll(t).on(e,n),null==G[t]&&(G[t]={}),G[t][e]=n}function b(t,e){K.selectAll(t).on(e,null),G[t]&&G[t][e]&&delete G[t][e]}function y(){v(".pdb-chain-group","click",function(t,e){I(d3.select(this))})}function T(){for(var t in G){var e=K.selectAll(t);for(var n in G[t])e.on(n,G[t][n])}}function C(){$(W.el).show()}function P(){$(W.el).hide()}function w(t){var e=m(W.numRows[t]),n=K.attr("height");z(e,n),K.transition().duration(W.animationDuration).attr("height",e).each("end",function(){H(e,n)}),at=e}function S(){var t=D();w(t)}function D(){var t=(Z+1)%(X+1);return et[t]||(a(K,W,J.slice(W.numRows[Z],W.numRows[t]),i,W.numRows[Z]),T(),et[t]=!0),Z=t,t}function x(t){for(var e=-1,n=Z;t>n&&X>n;n++)e=D();-1!==e&&w(e)}function M(t,e){for(var n=-1,i=it[PdbDataUtil.chainKey(t,e)],a=0;a<W.numRows.length;a++)if(i<W.numRows[a]){n=a;break}-1!==n&&x(n)}function A(){return J.length>W.numRows[0]}function I(t){ot=t;var e=F(t);K.selectAll(".pdb-selection-rectangle-group").remove();var n=K.append("g").attr("class","pdb-selection-rectangle-group").attr("opacity",0),i=n.append("rect").attr("fill","none").attr("stroke",W.highlightBorderColor).attr("stroke-width",W.highlightBorderWidth).attr("x",e.x).attr("y",e.y).attr("width",e.width).attr("height",e.height);n.transition().duration(W.animationDuration).attr("opacity",1),i.datum({initPos:{x:e.x,y:e.y}}),Y.trigger(MutationDetailsEvents.PANEL_CHAIN_SELECTED,t)}function F(t){var e=1/0,n=-1,i=-1,a=-1;return t.selectAll("rect").each(function(t,o){var r=d3.select(this);i=parseFloat(r.attr("y")),a=parseFloat(r.attr("height"));var l=parseFloat(r.attr("x")),u=parseFloat(r.attr("width"));e>l&&(e=l),l+u>n&&(n=l+u)}),{x:e,y:i,width:n-e,height:a}}function L(t){null!=ot&&k(ot,t)}function k(t,e){var n=W.animationDuration;E(t,e),t==ot&&E(K.selectAll(".pdb-selection-rectangle-group")),V(t);var i=m(1),a=K.attr("height");z(i,a),K.transition().duration(n).attr("height",i).each("end",function(){H(i,a)})}function E(t,e){var n=W.animationDuration,i=W.marginTop,a=W.chainHeight;t.selectAll("line").transition().duration(n).attr("y1",i+a/2).attr("y2",i+a/2),t.selectAll("rect").transition().duration(n).attr("y",i).each("end",function(){_.isFunction(e)&&e()})}function V(t,e){var n=W.animationDuration,i=t.datum(),a=PdbDataUtil.chainKey(i.pdbId,i.chain.chainId);K.selectAll(".pdb-chain-group").transition().duration(n).attr("opacity",function(t){return PdbDataUtil.chainKey(t.pdbId,t.chain.chainId)===a?1:0}),K.selectAll(".pdb-selection-rectangle-group").transition().duration(n).attr("opacity",function(e){return ot==t?1:0}),K.select(".pdb-panel-y-axis-label-group").transition().duration(n).attr("opacity",0).each("end",function(){_.isFunction(e)&&e()})}function B(t,e,n){K.selectAll(t).transition().duration(n).attr("y1",function(t){return e(this,t,"y1")}).attr("y2",function(t){return e(this,t,"y2")})}function O(t,e,n){K.selectAll(t).transition().duration(n).attr("y",function(t){return e(this,t,"y")})}function q(t){var e=W.animationDuration;N(),R();var n=K.attr("height");z(at,n),K.transition().duration(e).attr("height",at).each("end",function(){_.isFunction(t)&&t(),H(at,n)})}function N(t){var e=W.animationDuration,n=function(t,e,n){return e.initPos.y};O(".pdb-chain-group rect",n,e),B(".pdb-chain-group line",n,e),O(".pdb-selection-rectangle-group rect",n,e),setTimeout(t,e+50)}function R(t){var e=W.animationDuration;K.selectAll(".pdb-chain-group").transition().duration(e).attr("opacity",1),K.selectAll(".pdb-selection-rectangle-group").transition().duration(e).attr("opacity",1),K.selectAll(".pdb-panel-y-axis-label-group").transition().duration(e).attr("opacity",1).each("end",function(){_.isFunction(t)&&t()})}function U(){return ot}function z(t,e){Y.trigger(MutationDetailsEvents.PDB_PANEL_RESIZE_STARTED,t,e,W.maxHeight)}function H(t,e){Y.trigger(MutationDetailsEvents.PDB_PANEL_RESIZE_ENDED,t,e,W.maxHeight)}var j={el:"#mutation_pdb_panel_d3",elWidth:740,elHeight:"auto",maxHeight:200,numRows:[1/0],marginLeft:45,marginRight:30,marginTop:2,marginBottom:0,chainHeight:6,chainPadding:3,labelY:["PDB","Chains"],labelYFont:"sans-serif",labelYFontColor:"#2E3436",labelYFontSize:"12px",labelYFontWeight:"normal",labelYPaddingRightH:45,labelYPaddingTopH:7,labelYPaddingRightV:25,labelYPaddingTopV:20,labelAlignThreshold:5,chainBorderColor:"#666666",chainBorderWidth:.5,highlightBorderColor:"#FF9900",highlightBorderWidth:2,colors:["#3366cc"],animationDuration:1e3,chainTipFn:function(t){var e=t.datum();n.getPdbInfo(e.pdbId,function(n){var i=null;n&&(i=PdbDataUtil.generatePdbInfoSummary(n[e.pdbId],e.chain.chainId));var a=new PdbChainTipView({model:{pdbId:e.pdbId,pdbInfo:i.title,molInfo:i.molecule,chain:e.chain}}),o=a.compileTemplate(),r={content:{text:o},hide:{fixed:!0,delay:100},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-lightyellow"},position:{my:"bottom left",at:"top center",viewport:$(window)}};$(t).qtip(r)})},yHelpTipFn:function(t){var e=BackboneTemplateCache.getTemplateFn("mutation_details_pdb_help_tip_template"),n=e({}),i={content:{text:n},hide:{fixed:!0,delay:100},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-lightyellow qtip-wide"},position:{my:"bottom left",at:"top center",viewport:$(window)}};$(t).qtip(i)}},G={},Y={};_.extend(Y,Backbone.Events);var W=jQuery.extend(!0,{},j,t),K=null,J=null,Q=null,Z=0,X=null,tt=0,et=[],nt={},it={},at=0,ot=null;return{init:f,addListener:v,removeListener:b,getChainGroup:c,getDefaultChainGroup:s,show:C,hide:P,toggleHeight:S,expandToChainLevel:M,minimizeToChain:k,minimizeToHighlighted:L,restoreToFull:q,restoreChainPositions:N,fadeInAll:R,hasMoreChains:A,highlight:I,getHighlighted:U,dispatcher:Y}}function MutationPdbTable(t){function e(t,e,n,i,a,o,r,l){var s=DataTableUtil.getColumnOptions(n,a),c={aaData:e,aoColumns:s,aoColumnDefs:[{bVisible:!1,aTargets:o},{bSearchable:!1,aTargets:l}],oColVis:{aiExclude:r},fnDrawCallback:function(t){u._addColumnTooltips()},fnHeaderCallback:function(t,e,n,i,a){$(t).find("th").addClass("mutation-pdb-table-header")},fnRowCallback:function(t,e,n,i){var o=e[a.datum],r=PdbDataUtil.chainKey(o.pdbId,o.chain.chainId);p[r]=t,$(t).addClass("pdb-chain-table-data-row")},fnInitComplete:function(t,e){d.trigger(MutationDetailsEvents.PDB_TABLE_READY)}};return c}function n(t){var e=c.columnVisibility[t],n=e;return e?_.isFunction(e)&&(n=e()):n="hidden",n}function i(t){var e=c.columnSearch[t],n=e;return null==e?n=!1:_.isFunction(e)&&(n=e()),n}function a(){u.getDataTable().fnFilter("")}function o(t,e){var n=PdbDataUtil.chainKey(t,e);r();var i=p[n];$(i).addClass("row_selected"),m=i}function r(){$(c.el).find("tr").removeClass("row_selected")}function l(){return m}var u=this,s={el:"#mutation_pdb_table_d3",elWidth:740,columns:{datum:{sTitle:"datum",tip:""},pdbId:{sTitle:"PDB Id",tip:"",sType:"string"},chain:{sTitle:"Chain",tip:"",sType:"string"},uniprotPos:{sTitle:"Uniprot Positions",tip:"",sType:"numeric"},identityPercent:{sTitle:"Identity Percent",tip:"",sType:"numeric"},organism:{sTitle:"Organism",tip:"",sType:"string"},summary:{sTitle:"Summary",tip:"",sType:"string",sWidth:"65%"}},columnOrder:["datum","pdbId","chain","uniprotPos","identityPercent","organism","summary"],columnVisibility:{pdbId:"visible",chain:"visible",uniprotPos:"visible",identityPercent:"hidden",organism:"visible",summary:"visible",datum:"excluded"},columnSearch:{pdbId:!0,organism:!0,summary:!0},columnRender:{identityPercent:function(t){return Math.round(100*t.chain.mergedAlignment.identityPerc)},pdbId:function(t){var e=BackboneTemplateCache.getTemplateFn("mutation_pdb_table_pdb_cell_template");return e({pdbId:t.pdbId})},chain:function(t){var e=BackboneTemplateCache.getTemplateFn("mutation_pdb_table_chain_cell_template");return e({chainId:t.chain.chainId})},organism:function(t){return t.organism},summary:function(t){var e={summary:t.summary.title,molecule:t.summary.molecule},n=BackboneTemplateCache.getTemplateFn("mutation_pdb_table_summary_cell_template");return n(e)},uniprotPos:function(t){return t.chain.mergedAlignment.uniprotFrom+"-"+t.chain.mergedAlignment.uniprotTo}},columnTooltips:{simple:function(t){var e=MutationViewsUtil.defaultTableTooltipOpts();$(t).find(".simple-tip").qtip(e)}},eventListeners:{pdbLink:function(t,e,n){$(t).on("click",".pbd-chain-table-chain-cell a",function(i){i.preventDefault(),r();var a=$(i.target).closest("tr.pdb-chain-table-data-row");a.addClass("row_selected");var o=t.fnGetData(a[0]),l=o[n.datum];e.trigger(MutationDetailsEvents.TABLE_CHAIN_SELECTED,l.pdbId,l.chain.chainId)})}},columnSort:{identityPercent:function(t){return MutationDetailsTableFormatter.assignFloatValue(Math.round(100*t.chain.mergedAlignment.identityPerc))},pdbId:function(t){return t.pdbId},chain:function(t){return t.chain.chainId},organism:function(t){return t.organism},summary:function(t){return t.summary.title+t.summary.molecule},uniprotPos:function(t){return MutationDetailsTableFormatter.assignIntValue(t.chain.mergedAlignment.uniprotFrom)}},columnFilter:{identityPercent:function(t){return Math.round(100*t.chain.mergedAlignment.identityPerc)},summary:function(t){return t.summary.title+" "+t.summary.molecule},uniprotPos:function(t){return t.chain.mergedAlignment.uniprotFrom+"-"+t.chain.mergedAlignment.uniprotTo}},filteringDelay:0,dataTableOpts:{sDom:'<"H"<"mutation_pdb_datatable_info"i><"mutation_pdb_datatable_filter"f>>t',bJQueryUI:!0,bPaginate:!1,bFilter:!0,sScrollY:"200px",bScrollCollapse:!0,oLanguage:{sInfo:"Showing _TOTAL_ PDB chain(s)",sInfoFiltered:"(out of _MAX_ total chains)",sInfoEmpty:"No chains to show"}}},c=jQuery.extend(!0,{},s,t);AdvancedDataTable.call(this,c),c=u._options;var d=u._dispatcher,p={},m=null;this._initDataTableOpts=e,this._visibilityValue=n,this._searchValue=i,this.selectRow=o,this.cleanFilters=a,this.getSelectedRow=l,this.dispatcher=this._dispatcher}function PancanMutationHistogram(t,e,n,i,a){function o(t){return t.map(_.clone)}function r(t){return _.reduce(t,function(t,e){return t[e.cancer_study]=e,t},{})}function l(t){var e=v[t.cancer_study].num_sequenced_samples;return t.num_sequenced_samples=e,t.frequency=t.count/e,t}function u(t){var e=_.reduce(t,function(t,e){return t+e.frequency},0);return-1*e}function s(t){var e=t[0].cancer_type;if(!_.every(t,function(t){return t.cancer_type===e}))throw new Error("not all data in a group have the same cancer type");return e}function c(t){function e(t){return{cancer_study:t,count:0,cancer_type:v[t].cancer_type,num_sequenced_samples:v[t].num_sequenced_samples}}var n=r(t);return _.chain(b).reduce(function(t,e){return _.has(n,e)||t.push(e),t},[]).map(e).value()}function d(t){return t.concat(c(t))}function p(){var t,e=_.find(M[0],function(t){return t.cancer_study===a.this_cancer_study});try{t=e.cancer_type}catch(n){throw new Error(n+": could not find this the corresponding datum for this cancer study, ["+a.this_cancer_study+"]")}var i=function(t){return _.find(t,function(t){return t.cancer_study===a.this_cancer_study})},o=_.zip.apply(null,M);o=_.find(o,i);var r=u(o);L.append("text").text("*").attr("id","star").attr("x",V(a.this_cancer_study)).attr("y",q(-1*r)+10).style("font-family","Helvetica Neue, Helvetica, Arial, sans-serif").style("font-size",3*V.rangeBand()+"px")}function m(t){var e=d3.select(t).selectAll(".mouseOver").data(b).enter().append("rect").attr("class","mouseOver").attr("y",a.margin.top).attr("x",function(t){return V(t)+a.margin.left}).attr("opacity","0").attr("height",F+5).attr("width",V.rangeBand()).on("mouseover",function(){d3.select(this).attr("opacity","0.25")}).on("mouseout",function(){d3.select(this).attr("opacity","0")});e.each(function(t){$(this).qtip({content:{text:"mouseover failed"},position:{my:"left top",at:"center right",viewport:$(window)},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-wide"},hide:{fixed:!0,delay:100},events:{render:function(e,n){var i=g(t).map(function(t){return t[0].__data__}),a=i.filter(function(t){return _.has(t,"keyword")})[0]||{},o=i.filter(function(t){return!_.has(t,"keyword")})[0]||{},r=o.cancer_study,l=v[r].num_sequenced_samples,u="<p style='font-weight:bold;'>"+r+"</p>"+f(a,o,l);n.set("content.text",u)}}})})}function h(t,e){var n=t.count||0;"frequency"in t||(t.frequency=n/e);var i=(100*t.frequency).toFixed(1)+"%";return _.template("<span><b>{{percent}}</b> (<b>{{count}}</b> of {{total}} sequenced samples)</span>")({percent:i,count:n,total:e})}function f(t,e,n){return"<p style='color: "+R+"; margin-bottom:0;'>"+C+": "+h(t,n)+"</p><p style='color: "+N+"; margin-top:0;'>Other "+Y+" mutations: "+h(e,n)+"</p>"}function g(t){return z.filter(function(e){return e.cancer_study===t})}a=a||{},a=a.sparkline?_.extend({margin:{top:-12,right:0,bottom:0,left:0},width:30,height:12,this_cancer_study:void 0},a):_.extend({margin:{top:6,right:10,bottom:20,left:40},width:600,height:300,this_cancer_study:void 0},a);var v=r(n),b=_.keys(v),y=o(t),T=o(e),C=y[0].hugo+" "+y[0].protein_pos_start;y=d(y).map(function(t){return t.keyword=C,t}),T=d(T);var P={bykeyword:r(y),bygene:r(T)},w=_.intersection(_.keys(P.bykeyword),_.keys(P.bygene));if(y=[],T=[],_.each(w,function(t){y.push(P.bykeyword[t]),T.push(P.bygene[t])}),T.length!==y.length)throw new Error("must be same length");if(T.length!==b.length)throw new Error("there must be a datum for every cancer study and visa versa");T.forEach(function(t){var e=P.bykeyword[t.cancer_study],n=t.count-e.count;if(0>n)throw new Error("more mutations for a particular keyword than for all keywords of a particular gene");t.count=n});var S=_.reduce(T,function(t,e){return t+e.count},0),D=_.reduce(y,function(t,e){return t+e.count},0),x=_.reduce(v,function(t,e){return t+e.num_sequenced_samples},0);_.mixin({unzip:function(t){return _.zip.apply(_,t)}});var M=y.concat(T);try{M=_.chain(M).map(l).groupBy(function(t){return t.cancer_study}).map(_.identity).sortBy(s).unzip().value()}catch(A){throw new Error(A)}var I=a.width-a.margin.left-a.margin.left,F=a.height-a.margin.top-a.margin.bottom,L=d3.select(i).append("svg").attr("width",a.width).attr("height",a.height).append("g").attr("transform","translate("+a.margin.left+","+a.margin.top+")"),k=d3.layout.stack().x(function(t){return t.cancer_study}).y(function(t){return t.frequency}),E=k(M),V=d3.scale.ordinal().domain(M[0].map(function(t){return t.cancer_study})).rangeBands([0,I],.1),B=.2,O=a.sparkline?B:d3.max(E,function(t){return d3.max(t,function(t){return t.y0+t.y})}),q=d3.scale.linear().domain([0,O]).range([F,0]).clamp(!0),N="LimeGreen",R="Green",U=L.selectAll(".layer").data(E).enter().append("g").attr("class","layer").style("fill",function(t,e){return[R,N][e]}),z=U.selectAll("rect").data(function(t){return t}).enter().append("rect").attr("x",function(t){return V(t.cancer_study)}).attr("y",function(t){return q(t.y0+t.y)}).attr("width",function(t){
return V.rangeBand()}).attr("height",function(t){return q(t.y0)-q(t.y0+t.y)});if(a.sparkline)return{el:i,qtip:function(){throw new Error("don't qtip a sparkline")}};var H=d3.format(O>.1?".0%":".1%"),j=d3.svg.axis().scale(q).tickFormat(H).orient("left");j.tickSize(j.tickSize(),0,0);var G=function(){function t(t){return{cancer_type:t.cancer_type,start:t.cancer_study,end:t.cancer_study,color:v[t.cancer_study].color}}var e=M[0][0];return _.chain(M[0]).reduce(function(e,n){var i=_.last(e);return i.cancer_type!==n.cancer_type?e.concat(t(n)):i.cancer_type===n.cancer_type?(i.end=n.cancer_study,e):void 0},[t(e)]).value()}();L.selectAll("line").data(G).enter().append("line").attr("x1",function(t){return V(t.start)}).attr("x2",function(t){return V(t.end)+V.rangeBand()}).attr("y1",F+a.margin.bottom/3).attr("y2",F+a.margin.bottom/3).style("stroke-width",5).style("stroke",function(t){return t.color});var Y=(L.append("g").call(j).attr("stroke","#000").attr("shape-rendering","crispEdges"),_.find(E[0],function(t){return void 0!==t.hugo}).hugo),C=_.find(E[0],function(t){return void 0!==t.keyword}).keyword;return _.isUndefined(a.this_cancer_study)||p(),{el:i,qtip:m,overallCountText:function(){return f({count:D},{count:S},x)}}}function MainMutationController(t,e){function n(){e.dispatcher.on(MutationDetailsEvents.ALL_LOLLIPOPS_DESELECTED,o),e.dispatcher.on(MutationDetailsEvents.LOLLIPOP_DESELECTED,r),e.dispatcher.on(MutationDetailsEvents.LOLLIPOP_SELECTED,l),e.dispatcher.on(MutationDetailsEvents.DIAGRAM_PLOT_UPDATED,a),t.addResetCallback(i)}function i(n){e.resetPlot(),t.hideFilterInfo()}function a(){e.isFiltered()?t.showFilterInfo():t.hideFilterInfo()}function o(){e.isFiltered()||t.hideFilterInfo()}function r(t,n){0==e.getSelectedElements().length&&o()}function l(e,n){t.showFilterInfo()}n()}function Mutation3dController(t,e,n,i,a,o,r,l,u,s){function c(){l.dispatcher.on(MutationDetailsEvents.ALL_LOLLIPOPS_DESELECTED,D),l.dispatcher.on(MutationDetailsEvents.LOLLIPOP_DESELECTED,x),l.dispatcher.on(MutationDetailsEvents.LOLLIPOP_SELECTED,M),l.dispatcher.on(MutationDetailsEvents.LOLLIPOP_MOUSEOVER,A),l.dispatcher.on(MutationDetailsEvents.LOLLIPOP_MOUSEOUT,I),l.dispatcher.on(MutationDetailsEvents.DIAGRAM_PLOT_UPDATED,S),l.dispatcher.on(MutationDetailsEvents.DIAGRAM_PLOT_RESET,w),u.dispatcher.on(MutationDetailsEvents.PDB_LINK_CLICKED,L),u.dispatcher.on(MutationDetailsEvents.PROTEIN_CHANGE_LINK_CLICKED,F),i.addInitCallback(m),n.dispatcher.on(MutationDetailsEvents.VIEW_3D_PANEL_CLOSED,p),n.dispatcher.on(MutationDetailsEvents.VIEW_3D_STRUCTURE_RELOADED,v),t.dispatcher.on(MutationDetailsEvents.GENE_TAB_SELECTED,d)}function d(t){n&&(n.resetPanelPosition(),n.hideView())}function p(){q&&q.hideView()}function m(t){B(),null!=n&&(n.resetPanelPosition(),n.maximizeView())}function h(t,e,n){t>n&&q.toggleScrollBar(n)}function f(t,e,n){n>=t&&q.toggleScrollBar(-1),e!=t&&q.scrollToSelected()}function g(t){R&&q.scrollToSelected();var e=t.datum();null!=n&&(n.maximizeView(),n.updateView(s,e.pdbId,e.chain)),R||null==N||(N.resetFilters(),N.selectChain(e.pdbId,e.chain.chainId),N.scrollToSelected()),R=!1}function v(){i.isVisible()&&l.isHighlighted()&&V()}function b(t,e){t&&e&&(q.selectChain(t,e),R=!0)}function y(){q.pdbPanel.minimizeToHighlighted()}function T(t,e){t&&e&&q.pdbPanel.minimizeToChain(q.pdbPanel.getChainGroup(t,e))}function C(t){null==N&&null!=q&&t.length>0&&(N=q.initPdbTableView(t,function(t,e){e.dispatcher.on(MutationDetailsEvents.PDB_TABLE_READY,P),N=t}),N.pdbTable.dispatcher.on(MutationDetailsEvents.TABLE_CHAIN_SELECTED,b),N.pdbTable.dispatcher.on(MutationDetailsEvents.TABLE_CHAIN_MOUSEOUT,y),N.pdbTable.dispatcher.on(MutationDetailsEvents.TABLE_CHAIN_MOUSEOVER,T)),null!=q&&null!=N&&(q.toggleTableControls(),N.toggleView())}function P(){if(null!=q){var t=q.getSelectedChain();if(null!=t){var e=t.datum();N.selectChain(e.pdbId,e.chain.chainId),N.scrollToSelected()}}}function w(){n&&n.isVisible()&&n.refreshView()}function S(){n&&n.isVisible()&&n.refreshView()}function D(){n&&n.isVisible()&&(n.resetHighlight(),n.hideResidueWarning())}function x(t,e){l.isHighlighted()?M():D()}function M(t,e){n&&n.isVisible()&&V()}function A(t,e){if(n&&n.isVisible()){var i=E();i.push(t),$(i,!0)}}function I(t,e){x(t,e)}function F(t){var e=k(t);e&&n&&n.isVisible()&&V()}function L(t){var e=k(t);e&&B(e.pdbMatch.pdbId,e.pdbMatch.chainId)}function k(t){var e=r.getMutationIdMap(),n=e[t];return n&&(l.clearHighlights(),l.highlightMutation(n.mutationSid)),n}function E(){var t=[];return _.each(l.getSelectedElements(),function(e,n){t=t.concat(e.datum())}),t}function V(){var t=E();$(t)}function $(t,e){var i=n.highlightView(t,!0),a=t.length-i;e||(a>0?n.showResidueWarning(a,t.length):n.hideResidueWarning())}function B(t,a){var r=i.model.uniprotId,l=function(i){null==q&&(q=e.initPdbPanelView(i),q.pdbPanel.dispatcher.on(MutationDetailsEvents.PANEL_CHAIN_SELECTED,g),q.pdbPanel.dispatcher.on(MutationDetailsEvents.PDB_PANEL_RESIZE_STARTED,h),q.pdbPanel.dispatcher.on(MutationDetailsEvents.PDB_PANEL_RESIZE_ENDED,f),q.addInitCallback(function(t){C(i)})),null!=n&&null!=q&&i.length>0&&(O(),q.showView(),t&&a?q.selectChain(t,a):q.selectDefaultChain(),q.autoCollapse())};o.getPdbData(r,l)}function O(){var t=function(t,e,n){return l.mutationColorMap[t]};a.updateOptions({mutationColorMapper:t})}var q=null,N=null,R=!1;c()}function MutationDetailsController(t,e,n,i,a,o){function r(){t.dispatcher.on(MutationDetailsEvents.GENE_TAB_SELECTED,l),t.dispatcher.on(MutationDetailsEvents.GENE_TABS_CREATED,u)}function l(t){null==h[t]&&s(t,n,i,a)}function u(){var e=t.$el.find(".mutation-3d-container");if(o){var r=new Mutation3dVisView({el:e,mut3dVis:o,pdbProxy:m,mutationProxy:d});r.render(),f=r}else $(e).hide();var l=d.getGeneList();s(l[0],n,i,a)}function s(n,i,a,r){var l=function(l,u,s){u=c(u,d.getMutationUtil(),s);var p=d.getMutationUtil(),g={geneSymbol:n,mutationData:u,dataProxies:e,sequence:l,sampleArray:i,diagramOpts:a,tableOpts:r},v=new MainMutationView({el:"#mutation_details_"+cbio.util.safeProperty(n),model:g});v.render(),h[n].mainMutationView=v;var b=v.initComponents(f);(null==u||0==u.length)&&(v.showNoDataInfo(),b.tableView.hideView()),new MainMutationController(v,b.diagram),new MutationDetailsTableController(b.tableView,b.diagram,t),o&&f&&new Mutation3dController(t,v,f,b.view3d,o,m,p,b.diagram,b.tableView.tableUtil,n),new MutationDiagramController(b.diagram,b.tableView.tableUtil,p)};d.getMutationData(n,function(t){h[n]={},null==t&&(t=[]);var e=d.getMutationUtil().dataFieldCount(n,"uniprotAcc",["NA"]),i=null,a={geneSymbol:n};e.length>0&&(i=e[0].uniprotAcc),i&&(a.uniprotAcc=i),p.getPfamData(a,function(e){if(null==e)return void console.log("[warning] no pfam data found: %o",a);var n=e[0];if(m){var i=n.metadata.identifier;m.getPdbRowData(i,function(e){l(n,t,e)})}else l(n,t)})})}function c(t,e,n){if(!n)return t;var i=e.getMutationIdMap();return _.each(t,function(t,e){if(null==t)return void console.log("warning [processMutationData]: mutation (at index %d) is null.",e);var a=i[t.mutationId],o=PdbDataUtil.mutationToPdb(a,n);t.pdbMatch=o,a.pdbMatch=o}),t}var d=e.mutationProxy,p=e.pfamProxy,m=e.pdbProxy,h={},f=null;r()}function MutationDetailsTableController(t,e,n){function i(){e.dispatcher.on(MutationDetailsEvents.ALL_LOLLIPOPS_DESELECTED,o),e.dispatcher.on(MutationDetailsEvents.LOLLIPOP_DESELECTED,r),e.dispatcher.on(MutationDetailsEvents.LOLLIPOP_SELECTED,l),e.dispatcher.on(MutationDetailsEvents.LOLLIPOP_MOUSEOVER,u),e.dispatcher.on(MutationDetailsEvents.LOLLIPOP_MOUSEOUT,s),e.dispatcher.on(MutationDetailsEvents.DIAGRAM_PLOT_RESET,a),n.dispatcher.on(MutationDetailsEvents.GENE_TAB_SELECTED,c)}function a(){t&&t.resetFilters()}function o(){t&&(t.clearHighlights(),t.rollBack())}function r(n,i){if(t){t.clearHighlights();var a=[];_.each(e.getSelectedElements(),function(t,e){a=a.concat(t.datum().mutations)}),a.length>0?t.filter(a):t.rollBack()}}function l(n,i){if(t){t.clearHighlights();var a=[];_.each(e.getSelectedElements(),function(t,e){a=a.concat(t.datum().mutations)}),t.filter(a)}}function u(e,n){t&&t.highlight(e.mutations)}function s(e,n){t&&t.clearHighlights()}function c(e){if(t){var n=t.tableUtil.getDataTable();n.is(":visible")&&n.fnAdjustColumnSizing()}}i()}function MutationDiagramController(t,e,n){function i(){e.dispatcher.on(MutationDetailsEvents.MUTATION_TABLE_FILTERED,a)}function a(e){var n=[],i=[];try{i=$(e).DataTable().rows({filter:"applied"}).data()}catch(a){i=$(e).dataTable()._("tr",{filter:"applied"})}if(_.each(i,function(t,e){var i=t[0].mutation;i&&n.push(i)}),null!==t){var o=new MutationCollection(n);t.updatePlot(PileupUtil.convertToPileups(o))}}i()}function MutationMapper(t){function e(t){a.proxy.mutationProxy.options.geneList=a.data.geneList.join(" ");var e=DataProxyUtil.initDataProxies(a.proxy,t),i={mutationProxy:e.mutationProxy,sampleArray:a.data.sampleList,tableOpts:a.view.mutationTable,diagramOpts:a.view.mutationDiagram},o={el:a.el,model:i,mut3dVis:t},r=new MutationDetailsView(o);n=r;new MutationDetailsController(r,e,i.sampleArray,i.diagramOpts,i.tableOpts,t);r.render()}var n=null,i={el:"#mutation_details",data:{geneList:[],sampleList:[]},view:{mutationDiagram:{},mutationTable:{},pdbPanel:{},pdbTable:{},vis3d:{}},proxy:{pfamProxy:{instance:null,instanceClass:PfamDataProxy,options:{data:{}}},mutationProxy:{instance:null,instanceClass:MutationDataProxy,options:{data:{},params:{},geneList:""}},pdbProxy:{instance:null,instanceClass:PdbDataProxy,options:{data:{pdbData:{},infoData:{},summaryData:{},positionData:{}},mutationUtil:{}}},pancanProxy:{instance:null,instanceClass:PancanMutationDataProxy,options:{data:{byKeyword:{},byProteinChange:{},byProteinPosition:{},byGeneSymbol:{}}}},mutationAlignerProxy:{instance:null,instanceClass:MutationAlignerDataProxy,options:{data:{}}},portalProxy:{instance:null,instanceClass:PortalDataProxy,options:{data:{}}}}},a=jQuery.extend(!0,{},i,t);this.init=e,this.getView=function(){return n}}var DataTableUtil=function(){function t(t){var e={};return _.each(t,function(t,n){null==e[t]&&(e[t]=n)}),e}function e(t){var e={};return _.each(_.pairs(t),function(t,n){var i=t[0],a=t[1];null!=a.sTitle&&a.sTitle.length>0&&(e[a.sTitle]=i)}),e}function n(t,e){var n={};return _.each(t,function(t,i){null==n[t]&&(_.isFunction(e)?n[t]=e(t):n[t]="hidden")}),n}function i(t,e){var n={};return _.each(t,function(t,i){null==n[t]&&(n[t]=_.isFunction(e)&&e(t))}),n}function a(t,e,n){var i=[];return _.each(t,function(t,a){"visible"!=n[t]&&i.push(e[t])}),i}function o(t,e,n){var i=[];return _.each(t,function(t,a){"excluded"==n[t]&&i.push(e[t])}),i}function r(t,e,n){var i=[];return _.each(t,function(t,a){n[t]===!1&&i.push(e[t])}),i}function l(t,e){var n=[];return _.each(_.pairs(t),function(t){var i=t[0],a=t[1],o=e[i];if(null!=o){var r={fnRender:function(t){var n=t.aData[e.datum];return a(t,n)},aTargets:[o]};n.push(r)}}),n}function u(t,e,n,i,a){var o={};return _.each(_.pairs(e),function(e){var a=e[0],r=e[1],l=n[a],u=i[a],s=t[a],c=function(t){return null!=l?l(t):r(t)};if(null!=s){var d={mData:function(e,n,i){var a=e[t.datum];return"set"===n?null:"display"===n?r(a):"sort"===n?c(a):"filter"===n?null!=u?u(a):c(a):e[s]},aTargets:[s]};o[a]=d}}),_.each(_.pairs(a),function(e){var n=e[0],i=e[1],a=t[n],r={mData:function(e,n,a){return i(e,n,a,t)},aTargets:[a]};o[n]=r}),_.values(o)}function s(t,e){var n=[];return _.each(_.pairs(t),function(t){var i=t[0],a=t[1],o=e[i];o>0&&(n[o]=a)}),n}function c(t){var e=$(t).attr("alt"),n=parseFloat(e);return isNaN(n)&&(n=""),n}function d(t){return-1!=t.indexOf("label")?$(t).find("label").text().trim()||$(t).text().trim():-1}function p(t){return-1!=t.indexOf("label")?parseInt($(t).text()):-1}function m(t){return-1!=t.indexOf("label")?parseFloat($(t).text()):-1}function h(t,e,n,i){return n>=0?i>=0?n==i?0:i>n?-1:1:-1:i>=0?1:t==e?0:e>t?1:-1}function f(t,e,n,i){return n>=0?i>=0?n==i?0:i>n?1:-1:-1:i>=0?1:t==e?0:e>t?-1:1}return{buildColumnIndexMap:t,buildColumnNameMap:e,buildColumnVisMap:n,buildColumnSearchMap:i,getHiddenColumns:a,getExcludedColumns:o,getNonSearchableColumns:r,getColumnOptions:s,getColumnRenderers:l,getColumnData:u,compareSortAsc:h,compareSortDesc:f,getAltTextValue:c,getLabelTextValue:d,getLabelTextIntValue:p,getLabelTextFloatValue:m}}(),MutationViewsUtil=function(){function t(t,e,n,i,a){var o=new MutationMapper(e),r=!1;return $(t).is(":visible")&&(o.init(a),r=!0),$(n).bind("tabsactivate",function(t,e){e.newTab.text().trim().toLowerCase()==i.toLowerCase()&&(r?o.getView().refreshGenesTab():(o.init(a),r=!0))}),o}function e(){return{mutationType:i,validationStatus:a,mutationStatus:o,omaScore:r,cna:l}}function n(){return{content:{attr:"alt"},show:{event:"mouseover"},hide:{fixed:!0,delay:100,event:"mouseout"},style:{classes:"mutation-details-tooltip qtip-shadow qtip-light qtip-rounded"},position:{my:"top left",at:"bottom right",viewport:$(window)}}}var i={missense_mutation:{label:"Missense",style:"missense_mutation"},nonsense_mutation:{label:"Nonsense",style:"trunc_mutation"},nonstop_mutation:{label:"Nonstop",style:"trunc_mutation"},frame_shift_del:{label:"FS del",style:"trunc_mutation"},frame_shift_ins:{label:"FS ins",style:"trunc_mutation"},in_frame_ins:{label:"IF ins",style:"inframe_mutation"},in_frame_del:{label:"IF del",style:"inframe_mutation"},splice_site:{label:"Splice",style:"trunc_mutation"},other:{style:"other_mutation"}},a={valid:{label:"V",style:"valid",tooltip:"Valid"},validated:{label:"V",style:"valid",tooltip:"Valid"},wildtype:{label:"W",style:"wildtype",tooltip:"Wildtype"},unknown:{label:"U",style:"unknown",tooltip:"Unknown"},not_tested:{label:"U",style:"unknown",tooltip:"Unknown"},none:{label:"U",style:"unknown",tooltip:"Unknown"},na:{label:"U",style:"unknown",tooltip:"Unknown"}},o={somatic:{label:"S",style:"somatic",tooltip:"Somatic"},germline:{label:"G",style:"germline",tooltip:"Germline"},unknown:{label:"U",style:"unknown",tooltip:"Unknown"},none:{label:"U",style:"unknown",tooltip:"Unknown"},na:{label:"U",style:"unknown",tooltip:"Unknown"}},r={h:{label:"High",style:"oma_high",tooltip:"High"},m:{label:"Medium",style:"oma_medium",tooltip:"Medium"},l:{label:"Low",style:"oma_low",tooltip:"Low"},n:{label:"Neutral",style:"oma_neutral",tooltip:"Neutral"}},l={"-2":{label:"DeepDel",style:"cna-homdel",tooltip:"Deep deletion"},"-1":{label:"ShallowDel",style:"cna-hetloss",tooltip:"Shallow deletion"},0:{label:"Diploid",style:"cna-diploid",tooltip:"Diploid / normal"},1:{label:"Gain",style:"cna-gain",tooltip:"Low-level gain"},2:{label:"AMP",style:"cna-amp",tooltip:"High-level amplification"},unknown:{label:"NA",style:"cna-unknown",tooltip:"CNA data is not available for this gene"}};return{initMutationMapper:t,defaultTableTooltipOpts:n,getVisualStyleMaps:e}}(),MutationDetailsTableFormatter=function(){function t(t){return e(F,t)}function e(t,e){var n,i,a;return null!=t[e]?(n=t[e].style,i=t[e].label,a=t[e].tooltip):(n=t.unknown.style,i=t.unknown.label,a=t.unknown.tooltip),{style:n,tip:a,text:i}}function n(t){var e=16,n=t,i="",a=t;return t.length>e+2&&(n=t.substring(0,e)+"...",i="simple-tip"),{style:i,tip:a,text:n}}function i(t){return a(x,t)}function a(t,e){var n,i;return e=e.toLowerCase(),null!=t[e]?(n=t[e].style,i=t[e].label):(n=t.other.style,i=e),{style:n,text:i}}function o(t){return r(A,t)}function r(t,e){var n="simple-tip",i=e,a="";return e=e.toLowerCase(),null!=t[e]&&(n=t[e].style,i=t[e].label,a=t[e].tooltip),{style:n,tip:a,text:i}}function l(t){return u(M,t)}function u(t,e){var n,i,a;return e=e.toLowerCase(),null!=t[e]?(n=t[e].style,i=t[e].label,a=t[e].tooltip):(n=t.unknown.style,i=t.unknown.label,a=t.unknown.tooltip),{style:n,tip:a,text:i}}function s(t,e){return c(I,t,e)}function c(t,e,n){var i="",a="",o="",r="";return e=e.toLowerCase(),null!=t[e]&&(r=t[e].tooltip,null!=n&&(r=n.toFixed(2)),i=t[e].label,a=t[e].style,o="oma_link"),{fisClass:a,omaClass:o,value:r,text:i}}function d(t,e,n,i){var a="NA",o=e+n,r="",l="";return t&&(r="mutation_table_allele_freq",a=t.toFixed(2),l=i),{text:a,total:o,style:r,tipClass:l}}function p(t){return h(t.pdbMatch)}function m(t){return h(t.igvLink)}function h(t){return t?"#":""}function f(t){var e="mutation-table-protein-change",n="click to highlight the position on the diagram",i="";return null!=t.aminoAcidChange&&t.aminoAcidChange.length>0&&"NA"!=t.aminoAcidChange&&-1!=t.cancerStudyShort.toLowerCase().indexOf("msk-impact")&&g(t.proteinChange,t.aminoAcidChange)&&(i="The original annotation file indicates a different value: <b>"+v(t.aminoAcidChange)+"</b>"),{text:v(t.proteinChange),style:e,tip:n,additionalTip:i}}function g(t,e){var n=!1;if(t=v(t),e=v(e),e!==t){var i=t.match(/[A-Z]/g),a=e.match(/[A-Z]/g),o=t.match(/[0-9]+/),r=e.match(/[0-9]+/),l=t.match(/([a-z]+)/),u=e.match(/([a-z]+)/);o&&r&&o.length>0&&r.length>0&&o[0]!=r[0]?n=!0:i&&a&&i.length>0&&a.length>0&&"X"!==i[0]&&"X"!==a[0]&&i[0]!==a[0]?n=!0:i&&a&&i.length>1&&a.length>1&&i[1]!==a[1]?n=!0:l&&u&&l.length>0&&u.length>0&&l[0]!==u[0]&&(n=!0)}return n}function v(t){var e="p.";return-1!=t.indexOf(e)&&(t=t.substr(t.indexOf(e)+e.length)),t}function b(t){var e="tumor_type",n="";return{text:t.tumorType,style:e,tip:n}}function y(t){var e="",n="";return t>0&&(e="mutation_table_cosmic",n=t),{style:e,count:n}}function _(t){var e="",n="";return t>0&&(e="mutation_table_cbio_portal",n=t),{style:e,frequency:n}}function T(t){var e=t,n="mutation_table_int_value";return null==t&&(e="NA",n=""),{text:e,style:n}}function C(t){var e=t,n="mutation_table_allele_count";return null==t&&(e="NA",n=""),{text:e,style:n}}function P(t,e){var n;return t=t.toLowerCase(),n="low"==t||"l"==t?2:"medium"==t||"m"==t?3:"high"==t||"h"==t?4:"neutral"==t||"n"==t?1:-1,n>0&&!isNaN(e)&&(n+=e/1e3),n}function w(t){var e=parseInt(t);return isNaN(e)&&(e=-(1/0)),e}function S(t){var e=parseFloat(t);return isNaN(e)&&(e=-(1/0)),e}var D=MutationViewsUtil.getVisualStyleMaps(),x=D.mutationType,M=D.validationStatus,A=D.mutationStatus,I=D.omaScore,F=D.cna;return{getCaseId:n,getProteinChange:f,getPdbMatchLink:p,getIgvLink:m,getAlleleCount:C,getAlleleFreq:d,getCNA:t,getMutationType:i,getMutationStatus:o,getValidationStatus:l,getFis:s,getTumorType:b,getCosmic:y,getCbioPortal:_,getIntValue:T,assignValueToPredictedImpact:P,assignIntValue:w,assignFloatValue:S}}(),PileupUtil=function(){function t(t){for(var e=t.mutations,n={},i=0;i<e.length;i++){var a=e[i].mutationType.toLowerCase();void 0==n[a]&&(n[a]=[]),n[a].push(e[i])}return n}function e(e){var n=t(e),i=[];for(var a in n)i.push({type:a,count:n[a].length});return i.sort(function(t,e){return e.count-t.count}),i}function n(e){var n=MutationViewsUtil.getVisualStyleMaps().mutationType,i=t(e),a=[],o={};for(var r in i){var l=void 0;null!=n[r]&&(l=n[r].style),void 0==l&&(l=n.other.style),void 0==o[l]&&(o[l]=0),o[l]++}for(var l in o)a.push({group:l,count:o[l]});return a.sort(function(t,e){return e.count-t.count}),a}function i(){return s++,"pileup_"+s}function a(t){var e={};return _.each(t,function(t){_.each(t.mutations,function(n){e[n.mutationSid]=t.pileupId})}),e}function o(t){t=r(t);for(var e={},n=0;n<t.length;n++){var i=t.at(n),a=i.getProteinStartPos(),o=i.mutationType.trim().toLowerCase();null!=a&&"fusion"!=o&&(null==e[a]&&(e[a]=[]),e[a].push(i))}var u=[];for(var s in e){var c={};c.pileupId=PileupUtil.nextId(),c.mutations=e[s],c.count=e[s].length,c.location=parseInt(s),c.label=l(e[s]),c.stats=_.chain(e[s]).groupBy(function(t){return t.cancerType}).sortBy(function(t){return-t.length}).reduce(function(t,e){return t.push({cancerType:e[0].cancerType,count:e.length}),t},[]).value(),u.push(new Pileup(c))}return u.sort(function(t,e){var n=e.count-t.count;return 0==n&&(n=e.location-t.location),n}),u}function r(t){for(var e={},n=[],i=0;i<t.length;i++){var a=t.at(i),o=e[a.mutationSid];null==o?e[a.mutationSid]=!0:n.push(a)}return t.remove(n),t}function l(t){for(var e={},n=0;n<t.length;n++)null!=t[n].proteinChange&&t[n].proteinChange.length>0&&(e[t[n].proteinChange]=t[n].proteinChange);var i=[];for(var a in e)i.push(a);i.sort();var o="";i.length>1&&(o=cbio.util.lcss(i[0],i[i.length-1]));for(var r=o,n=0;n<i.length;n++)r+=i[n].substring(o.length)+"/";return r.substring(0,r.length-1)}function u(t){var e=0;return _.each(t,function(t){e+=t.count}),e}var s=0;return{nextId:i,mapToMutations:a,convertToPileups:o,countMutations:u,getMutationTypeMap:t,getMutationTypeArray:e,getMutationTypeGroups:n}}(),BackboneTemplateCache=function(){function t(t){return _.template($("#"+t).html())}function e(e){var i=n[e];return null==i&&(i=t(e),n[e]=i),i}var n={};return{getTemplateFn:e}}(),DataProxyUtil=function(){function t(t,n){var i={};return _.each(_.keys(t).sort(),function(a){var o=t[a],r=null;r="pdbProxy"==a?e(o,function(t){var e=i.mutationProxy;return null!=n&&null!=e&&e.hasData()?(t.options.mutationUtil=e.getMutationUtil(),!0):!1}):e(o),i[a]=r}),i}function e(t,e){var n=t.instance;if(null==n){if(null!=e&&_.isFunction(e)&&!e(t))return null;var i=t.instanceClass;n=new i(t.options),n.init()}return n}return{initDataProxies:t,initDataProxy:e}}();JmolScriptGenerator.prototype=new MolScriptGenerator,JmolScriptGenerator.prototype.constructor=JmolScriptGenerator;var MutationDetailsUtil=function(t){var e="germline",n="valid",i={},a={},o={},r={},l={},u={},s=[];this.getMutationGeneMap=function(){return i},this.getMutationCaseMap=function(){return a},this.getMutationIdMap=function(){return o},this.getMutations=function(){return s},this.processMutationData=function(t){i=this._updateGeneMap(t),a=this._updateCaseMap(t),o=this._updateIdMap(t),r=this._updateKeywordMap(t),l=this._updateProteinChangeMap(t),u=this._updateProteinPosStartMap(t),s=s.concat(t.models)},this.getProteinPositions=function(t){var e=i[t],n=[];if(null!=e)for(var a=0;a<e.length;a++){var o={id:e[a].id,start:e[a].getProteinStartPos(),end:e[a].proteinPosEnd};n.push(o)}return n},this.getAllKeywords=function(){return _.keys(r)},this.getAllProteinChanges=function(){return _.keys(l)},this.getAllProteinPosStarts=function(){return _.keys(u)},this.getAllGenes=function(){return _.keys(i)},this._updateGeneMap=function(t){for(var e=i,n=0;n<t.length;n++){var a=t.at(n).geneSymbol.toUpperCase();void 0==e[a]&&(e[a]=[]),e[a].push(t.at(n))}return e},this._updateCaseMap=function(t){for(var e=a,n=0;n<t.length;n++){var i=t.at(n).caseId.toLowerCase();void 0==e[i]&&(e[i]=[]),e[i].push(t.at(n))}return e},this._updateIdMap=function(t){for(var e=o,n=0;n<t.length;n++){var i=t.at(n).mutationId;e[i]=t.at(n)}return e},this._updateKeywordMap=function(t){for(var e=r,n=0;n<t.length;n++){var i=t.at(n).keyword;null!=i&&(void 0==e[i]&&(e[i]=[]),e[i].push(t.at(n)))}return e},this._updateProteinChangeMap=function(t){for(var e=l,n=0;n<t.length;n++){var i=t.at(n).proteinChange;null!=i&&(void 0==e[i]&&(e[i]=[]),e[i].push(t.at(n)))}return e},this._updateProteinPosStartMap=function(t){for(var e=u,n=0;n<t.length;n++){var i=t.at(n).geneSymbol,a=t.at(n).proteinPosStart;if(null!=a&&null!=i){var o=i+"_"+a;void 0==e[o]&&(e[o]=[]),e[o].push(t.at(n))}}return e},this.generateSummary=function(t){var e,n="[";return t.numGermline>0&&(e=t.numGermline/t.numCases*100,n+="Germline Mutation Rate: "+e.toFixed(1)+"%, "),e=t.numSomatic/t.numCases*100,n+="Somatic Mutation Rate: "+e.toFixed(1)+"%]"},this.countMutations=function(t,n){for(var i=n.length,o=0,r=0,l=0,u=0;u<n.length;u++){var s=a[n[u].toLowerCase()];if(null!=s){for(var c=0,d=0,p=0;p<s.length;p++)s[p].geneSymbol.toLowerCase()==t.toLowerCase()&&(s[p].mutationStatus.toLowerCase()===e?d=1:c=1);r+=c,l+=d,o++}}return{numCases:i,numMutated:o,numSomatic:r,numGermline:l}},this.cancerStudyAllTheSame=function(t){t=t.toUpperCase();var e=i[t];if(null!=e)for(var n=null,a=0;a<e.length;a++){var o=e[a].cancerStudy;if(null==n)n=o;else if(n!=o)return!1}return!0},this._contains=function(t,e){var n=!1;t=t.toUpperCase();var a=i[t];if(null!=a)for(var o=0;o<a.length&&!(n=e(a[o]));o++);return n},this.containsGermline=function(t){return this._contains(t,function(t){return t.mutationStatus&&t.mutationStatus.toLowerCase()==e})},this.containsValidStatus=function(t){return this._contains(t,function(t){return t.validationStatus&&t.validationStatus.toLowerCase()==n})},this.containsIgvLink=function(t){return this._contains(t,function(t){return t.igvLink&&"NA"!=t.igvLink})},this.containsAlleleFreqT=function(t){return this._contains(t,function(t){return t.tumorFreq&&"NA"!=t.tumorFreq})},this.containsCnaData=function(t){return this._contains(t,function(t){return t.cna&&"NA"!=t.cna&&"unknown"!=t.cna})},this.containsCaseId=function(t){return this._contains(t,function(t){return t.caseId&&"NA"!=t.caseId})},this.containsChr=function(t){return this._contains(t,function(t){return t.chr&&"NA"!=t.chr})},this.containsStartPos=function(t){return this._contains(t,function(t){return t.startPos&&t.startPos>0})},this.containsRefAllele=function(t){return this._contains(t,function(t){return t.referenceAllele&&"NA"!=t.referenceAllele})},this.containsVarAllele=function(t){return this._contains(t,function(t){return t.variantAllele&&"NA"!=t.variantAllele})},this.containsEndPos=function(t){return this._contains(t,function(t){return t.endPos&&t.endPos>0})},this.containsFis=function(t){return this._contains(t,function(t){return t.functionalImpactScore&&"NA"!=t.functionalImpactScore})},this.containsCosmic=function(t){return this._contains(t,function(t){return t.cosmic&&t.cosmicCount&&t.cosmicCount>0})},this.containsMutationType=function(t){return this._contains(t,function(t){return t.mutationType&&"NA"!=t.mutationType})},this.containsMutationCount=function(t){return this._contains(t,function(t){return t.mutationCount&&t.mutationCount>0})},this.containsKeyword=function(t){return this._contains(t,function(t){return t.keyword&&"NA"!=t.keyword})},this.containsMutationEventId=function(t){return this._contains(t,function(t){return t.mutationEventId&&"NA"!=t.mutationEventId})},this.distinctTumorTypeCount=function(t){t=t.toUpperCase();var e=i[t],n={};if(null!=e)for(var a=0;a<e.length;a++)e[a].tumorType&&(n[e[a].tumorType]=!0);return _.keys(n).length},this.dataFieldCount=function(t,e,n){t=t.toUpperCase();var a=i[t],o={};if(null!=a)for(var r=0;r<a.length;r++){var l=a[r][e];l&&!_.contains(n,l)&&(void 0===o[l]&&(o[l]=0),o[l]++)}var u=_.pairs(o);u.sort(function(t,e){return e[1]-t[1]});var s=[];return _.each(u,function(t,n){var i={count:t[1]};i[e]=t[0],s.push(i)}),s},null!=t&&this.processMutationData(t)},PancanMutationDataUtil=function(){function t(t,e){return d3.nest().key(function(t){return t[e]}).entries(t).reduce(function(t,e){return t[e.key]=e.values,t},{})}function e(e){var n={};return _.each(_.keys(e),function(i,a){n=_.extend(n,t(e[i],i))}),n}function n(t,e){var n=t[e];return _.reduce(n,function(t,e){return t+e.count},0)}return{getMutationFrequencies:e,countByKey:n}}(),PdbDataUtil=function(){function t(t){var e=null,n=[],i={};_.each(t,function(t,n){e=new PdbAlignmentModel(t),void 0==i[e.pdbId]&&(i[e.pdbId]={}),void 0==i[e.pdbId][e.chain]&&(i[e.pdbId][e.chain]=[]),i[e.pdbId][e.chain].push(e)});for(var a in i){var o=[];for(var r in i[a]){var l=new PdbChainModel({chainId:r,alignments:i[a][r]});o.push(l)}var u=new PdbModel({pdbId:a,chains:o});n.push(u)}return new PdbCollection(n)}function e(t,e){var n={};n.title=t.title;for(var i in t.compound){var a=t.compound[i];if(a.molecule&&-1!=_.indexOf(a.chain,e.toLowerCase())){n.molecule=a.molecule;break}}return n}function n(t,e){var n="NA";for(var i in t.compound){var a=t.compound[i];if(-1!=_.indexOf(a.chain,e.toLowerCase())&&null!=t.source[a.mol_id]){n=t.source[a.mol_id].organism_scientific||n;break}}return n}function i(t){return a(t)}function a(t){var e,n={mergedString:"",uniprotFrom:-1,uniprotTo:-1,pdbFrom:-1},i="",a=-1;return t.length>0?(i+=t[0].alignmentString,a=t[0].uniprotTo,e=t[0],_.each(t,function(t,n){var o=t.uniprotFrom-a-1,r=t.alignmentString;if(0==o)i+=r;else if(o>0){for(var l=[],u=0;o>u;u++)l.push(y);l.push(r),i+=l.join("")}else{var s=[],c=Math.min(-1*o,r.length);s.push(i.substr(i.length+o,c)),s.push(r.substr(0,c)),s[0]!=s[1]&&(console.log("[warning] alignment mismatch: "+e.alignmentId+" & "+t.alignmentId),console.log(s[0]),console.log(s[1])),i+=r.substr(-1*o)}a=Math.max(a,t.uniprotTo),a==t.uniprotTo&&(e=t)}),n.uniprotFrom=t[0].uniprotFrom,n.uniprotTo=n.uniprotFrom+i.length,n.pdbFrom=t[0].pdbFrom,n.mergedString=i,n.identityPerc=l(i),n.identity=u(i),n):n}function o(t,e){var n=null,i=t.getProteinStartPos(),a=t.mutationType.trim().toLowerCase();if(null==i||"fusion"==a)return n;for(var o=0;o<e.length&&!n;o++){for(var l=e[o],u=0;u<l.length&&!n;u++){var s=l[u],c=s.chain.mergedAlignment,d=i>=c.uniprotFrom&&i<=c.uniprotTo;if(d&&r(c,i)){n={pdbId:s.pdbId,chainId:s.chain.chainId};break}}if(n)break}return n}function r(t,e){var n=e-t.uniprotFrom,i=t.mergedString[n],a=i==y;return!a}function l(t){for(var e=0,n=0,i=0;i<t.length;i++){var a=t[i];a==y?e++:(a==C||a==T||a==P)&&n++}return 1-n/(i-e)}function u(t){t=t.toLowerCase();for(var e=0,n=0;n<t.length;n++){var i=t[n];i.match(/[a-z]/)&&e++}return e}function s(t){var e=d(t),n=[];return _.each(e,function(t,e){var i=t.chain;if(i.alignments.length>0){for(var a=!1,o=0;o<n.length;o++){for(var r=n[o],l=!1,u=0;u<r.length;u++)if(c(i,r[u].chain)){l=!0;break}if(!l){r.push(t),a=!0;break}}if(!a){var s=[];s.push(t),n.push(s)}}}),n.length>0&&n[0].sort(function(t,e){return e.chain.mergedAlignment.mergedString.length-t.chain.mergedAlignment.mergedString.length}),n}function c(t,e){var n=!0;return(t.mergedAlignment.uniprotFrom>=e.mergedAlignment.uniprotTo||e.mergedAlignment.uniprotFrom>=t.mergedAlignment.uniprotTo)&&(n=!1),n}function d(t){var e=[];return t.each(function(t,n){t.chains.each(function(n,i){var a={pdbId:t.pdbId,chain:n};e.push(a)})}),p(e,[h,g,f,v,b]),e}function p(t,e){t.sort(function(t,n){for(var i=0,a=0;a<e.length&&0==i;a++){var o=e[a];i=o(t,n)}return i})}function m(t,e){return t+":"+e}function h(t,e){return e.chain.mergedAlignment.identity-t.chain.mergedAlignment.identity}function f(t,e){return e.chain.mergedAlignment.identityPerc-t.chain.mergedAlignment.identityPerc}function g(t,e){return e.chain.mergedAlignment.mergedString.length-t.chain.mergedAlignment.mergedString.length}function v(t,e){return e.pdbId>t.pdbId?-1:e.pdbId<t.pdbId?1:0}function b(t,e){return e.chain.chainId>t.chain.chainId?-1:e.chain.chainId<t.chain.chainId?1:0}var y="*",T="+",C="-",P=" ";return{ALIGNMENT_GAP:y,ALIGNMENT_PLUS:T,ALIGNMENT_MINUS:C,ALIGNMENT_SPACE:P,processPdbData:t,mutationToPdb:o,allocateChainRows:s,mergeAlignments:i,generatePdbInfoSummary:e,getOrganism:n,chainKey:m}}();PymolScriptGenerator.prototype=new JmolScriptGenerator,PymolScriptGenerator.prototype.constructor=PymolScriptGenerator;var MutationModel=Backbone.Model.extend({initialize:function(t){this.mutationId=t.mutationId,this.mutationSid=t.mutationSid,this.geneticProfileId=t.geneticProfileId,this.mutationEventId=t.mutationEventId,this.caseId=t.caseId,this.geneSymbol=t.geneSymbol,this.linkToPatientView=t.linkToPatientView,this.cancerType=t.cancerType,this.cancerStudy=t.cancerStudy,this.cancerStudyShort=t.cancerStudyShort,this.cancerStudyLink=t.cancerStudyLink,this.tumorType=t.tumorType,this.proteinChange=t.proteinChange,this.aminoAcidChange=t.aminoAcidChange,this.mutationType=t.mutationType,this.cosmic=t.cosmic,this.cosmicCount=this.calcCosmicCount(t.cosmic),this.functionalImpactScore=t.functionalImpactScore,this.fisValue=t.fisValue,this.msaLink=t.msaLink,this.xVarLink=t.xVarLink,this.pdbLink=t.pdbLink,this.pdbMatch=t.pdbMatch,this.igvLink=t.igvLink,this.mutationStatus=t.mutationStatus,this.validationStatus=t.validationStatus,this.sequencingCenter=t.sequencingCenter,this.ncbiBuildNo=t.ncbiBuildNo,this.chr=t.chr,this.startPos=t.startPos,this.endPos=t.endPos,this.referenceAllele=t.referenceAllele,this.variantAllele=t.variantAllele,this.tumorFreq=t.tumorFreq,this.normalFreq=t.normalFreq,this.tumorRefCount=t.tumorRefCount,this.tumorAltCount=t.tumorAltCount,this.normalRefCount=t.normalRefCount,this.normalAltCount=t.normalAltCount,this.canonicalTranscript=t.canonicalTranscript,this.refseqMrnaId=t.refseqMrnaId,this.codonChange=t.codonChange,this.uniprotId=t.uniprotId,this.uniprotAcc=t.uniprotAcc,this.proteinPosStart=t.proteinPosStart,
this.proteinPosEnd=t.proteinPosEnd,this.mutationCount=t.mutationCount,this.specialGeneData=t.specialGeneData,this.keyword=t.keyword,this.cna=t.cna,this.myCancerGenome=t.myCancerGenome,this.isHotspot=t.isHotspot},url:function(){},getProteinStartPos:function(){var t=this.proteinPosStart;return(null==t||0==t.length||"NA"==t||0>t)&&(t=this.getProteinChangeLocation()),t},getProteinChangeLocation:function(){var t=null,e=this.proteinChange,n=e.match(/[0-9]+/);return n&&n.length>0&&(t=n[0]),t},calcCosmicCount:function(t){var e=0;return t&&t.forEach(function(t){e+=t[2]}),e}}),MutationCollection=Backbone.Collection.extend({model:MutationModel,initialize:function(t){},parse:function(t){},url:function(){}}),PdbAlignmentModel=Backbone.Model.extend({initialize:function(t){this.alignmentId=t.alignmentId,this.pdbId=t.pdbId,this.chain=t.chain,this.uniprotId=t.uniprotId,this.pdbFrom=t.pdbFrom,this.pdbTo=t.pdbTo,this.uniprotFrom=t.uniprotFrom,this.uniprotTo=t.uniprotTo,this.alignmentString=t.alignmentString,this.eValue=t.eValue,this.identityPerc=t.identityPerc}}),PdbAlignmentCollection=Backbone.Collection.extend({model:PdbAlignmentModel,initialize:function(t){}}),PdbChainModel=Backbone.Model.extend({initialize:function(t){this.chainId=t.chainId,this.positionMap=t.positionMap,this.alignments=new PdbAlignmentCollection(t.alignments),this.mergedAlignment=PdbDataUtil.mergeAlignments(t.alignments)}}),PdbChainCollection=Backbone.Collection.extend({model:PdbChainModel,initialize:function(t){}}),PdbModel=Backbone.Model.extend({initialize:function(t){this.pdbId=t.pdbId,this.chains=new PdbChainCollection(t.chains)}}),PdbCollection=Backbone.Collection.extend({model:PdbModel,initialize:function(t){}}),Pileup=Backbone.Model.extend({initialize:function(t){this.pileupId=t.pileupId,this.mutations=t.mutations,this.count=t.count,this.location=t.location,this.label=t.label,this.stats=t.stats}}),CosmicTipView=Backbone.View.extend({render:function(){var t=this.compileTemplate();this.$el.html(t),this.format()},format:function(){this.$el.find(".cosmic-details-table").dataTable({aaSorting:[[2,"desc"]],sDom:"pt",aoColumnDefs:[{mRender:function(t,e,n){return'<a href="http://cancer.sanger.ac.uk/cosmic/mutation/overview?id='+t+'">'+t+"</a>"},aTargets:[0]},{sType:"aa-change-col",sClass:"left-align-td",aTargets:[1]},{sType:"numeric",sClass:"left-align-td",aTargets:[2]}],bDestroy:!1,bPaginate:!0,bJQueryUI:!0,bFilter:!1})},_parseCosmic:function(t){var e=[];return t.forEach(function(t){e.push(t[0]+"</td><td>"+t[1]+"</td><td>"+t[2])}),"<tr><td>"+e.join("</td></tr><tr><td>")+"</td></tr>"},compileTemplate:function(){var t=this._parseCosmic(this.model.cosmic),e={cosmicDataRows:t,cosmicTotal:this.model.total,mutationKeyword:this.model.keyword},n=BackboneTemplateCache.getTemplateFn("mutation_details_cosmic_tip_template");return n(e)}}),LollipopTipStatsView=Backbone.View.extend({initialize:function(){},render:function(){var t=BackboneTemplateCache.getTemplateFn("mutation_details_lollipop_tip_stats_template"),e=this.$el.find("table tbody");return _.each(this.model,function(n){e.append(t(n))}),this}}),LollipopTipView=Backbone.View.extend({render:function(){var t=this.compileTemplate();this.$el.html(t),this.format()},format:function(){},showStats:!1,setShowStats:function(t){this.showStats=t},getShowStats:function(t){return this.showStats},compileTemplate:function(){var t=this.model,e=t.count>1?"mutations":"mutation",n={count:t.count,mutationStr:e,label:t.label},i=BackboneTemplateCache.getTemplateFn("mutation_details_lollipop_tip_template"),a=$(i(n)),o=a.find(".lollipop-stats");return this.showStats?(new LollipopTipStatsView({el:o,model:t.stats}).render(),o.find("table").dataTable({sDom:"t",bJQueryUI:!0,bDestroy:!0,aaSorting:[[1,"desc"]],aoColumns:[{bSortable:!1},{bSortable:!1}]})):o.hide(),a.html()}}),MainMutationView=Backbone.View.extend({initialize:function(t){this.options=t||{},this.dispatcher={},_.extend(this.dispatcher,Backbone.Events)},render:function(){var t=this,e={geneSymbol:t.model.geneSymbol,mutationSummary:t._mutationSummary(),uniprotId:t.model.sequence.metadata.identifier},n=BackboneTemplateCache.getTemplateFn("mutation_view_template"),i=n(e);t.$el.html(i),t.format()},format:function(){var t=this;t.$el.find(".mutation-details-filter-info").hide(),t.$el.find(".mutation-details-no-data-info").hide()},initComponents:function(t){var e=this,n=e.model.geneSymbol,i=e.model.mutationData,a=e.model.dataProxies,o=e.model.sequence,r=e.model.diagramOpts,l=e.model.tableOpts,u=e._initMutationDiagramView(n,i,o,a,r),s=u.mutationDiagram,c=null;s?t&&(c=e._init3dView(n,o,e.model.dataProxies.pdbProxy,t)):console.log("Error initializing mutation diagram: %s",n);var d=e._initMutationTableView(n,i,a,l);return e._mutationDiagram=s,e._tableView=d,e._mut3dView=c,{diagram:s,tableView:d,view3d:c}},initPdbPanelView:function(t){var e=this,n={el:e.$el.find(".mutation-pdb-panel-view"),model:{geneSymbol:e.model.geneSymbol,pdbColl:t,pdbProxy:e.model.dataProxies.pdbProxy},diagram:e._mutationDiagram},i=new PdbPanelView(n);return i.render(),e._pdbPanelView=i,i},_mutationSummary:function(){var t=this,e=t.model.dataProxies.mutationProxy.getMutationUtil(),n=t.model.geneSymbol,i=t.model.sampleArray,a="";if(i.length>0){var o=e.countMutations(n,i);a=e.generateSummary(o)}return a},_init3dView:function(t,e,n,i){var a=this,o=null;return i&&(o=new Mutation3dView({el:a.$el.find(".mutation-3d-initializer"),model:{uniprotId:e.metadata.identifier,geneSymbol:t,pdbProxy:n}}),o.render(),i.isVisible()&&o.resetView()),o},_initMutationDiagramView:function(t,e,n,i,a){var o=this,r={mutations:e,sequence:n,geneSymbol:t,dataProxies:i,diagramOpts:a},l=new MutationDiagramView({el:o.$el.find(".mutation-diagram-view"),model:r});return l.render(),l},_initMutationTableView:function(t,e,n,i){var a=this,o=new MutationDetailsTableView({el:a.$el.find(".mutation-table-container"),model:{geneSymbol:t,mutations:e,dataProxies:n,tableOpts:i}});return o.render(),o},addResetCallback:function(t){var e=this,n=e.$el.find(".mutation-details-filter-reset");n.click(t)},showFilterInfo:function(){this.$el.find(".mutation-details-filter-info").slideDown()},hideFilterInfo:function(){this.$el.find(".mutation-details-filter-info").slideUp()},showNoDataInfo:function(){this.$el.find(".mutation-details-no-data-info").slideDown()},hideNoDataInfo:function(){this.$el.find(".mutation-details-no-data-info").slideUp()}}),Mutation3dView=Backbone.View.extend({initialize:function(t){this.options=t||{},this.dispatcher={},_.extend(this.dispatcher,Backbone.Events)},render:function(){var t=this,e=(t.model.geneSymbol,BackboneTemplateCache.getTemplateFn("mutation_3d_view_template")),n=e({});this.$el.html(n),this.format()},format:function(){var t=this,e=t.$el.find(".mutation-3d-vis");e.attr("disabled","disabled");var n=function(n){if(n)e.removeAttr("disabled");else{var i=t.model.geneSymbol,a="No structure data for "+i,o={content:{text:a},hide:{fixed:!0,delay:100,event:"mouseout"},show:{event:"mouseover"},style:{classes:"qtip-light qtip-rounded qtip-shadow cc-ui-tooltip"},position:{my:"bottom center",at:"top center",viewport:$(window)}};t.$el.qtip(o)}},i=t.model.pdbProxy,a=t.model.uniprotId;i.hasPdbData(a,n)},addInitCallback:function(t){var e=this,n=e.$el.find(".mutation-3d-vis");n.click(t)},resetView:function(){var t=this,e=t.$el.find(".mutation-3d-vis");e.click()},isVisible:function(){var t=this;return t.$el.is(":visible")}}),Mutation3dVisInfoView=Backbone.View.extend({render:function(){var t=this,e=BackboneTemplateCache.getTemplateFn("mutation_3d_vis_info_template"),n=e(t.model);t.$el.html(n),t.format()},format:function(){var t=this,e=t.model.pdbInfo,n=t.model.molInfo;null==e||0==e.length?t.$el.find(".mutation-3d-pdb-info").hide():t._addExpander(".mutation-3d-pdb-info"),null==n||0==n.length?t.$el.find(".mutation-3d-mol-info").hide():t._addExpander(".mutation-3d-mol-info")},_addExpander:function(t){var e=this,n={slicePoint:40,widow:2,expandPrefix:" ",expandText:"[...]",userCollapseText:"[^]",moreClass:"expander-read-more",lessClass:"expander-read-less",detailClass:"expander-details",expandEffect:"fadeIn",collapseEffect:"fadeOut"};e.$el.find(t).expander(n)}}),Mutation3dVisView=Backbone.View.extend({initialize:function(t){this.options=t||{},this.dispatcher={},_.extend(this.dispatcher,Backbone.Events)},render:function(){var t=this,e=BackboneTemplateCache.getTemplateFn("mutation_3d_vis_template"),n=e({loaderImage:"images/ajax-loader.gif",helpImage:"images/help.png"});t.$el.html(n),t.format()},format:function(){var t=this,e=t.options.mut3dVis,n=t.$el;n.hide(),t.hideResidueWarning(),t.hideNoMapWarning(),t.$el.find(".mutation-3d-vis-help-content").hide(),null!=e&&e.updateContainer(n),t.$el.find(".mutation-3d-close").click(function(){t.hideView()}),t.$el.find(".mutation-3d-minimize").click(function(){null!=e&&e.toggleSize()}),t._initMutationControls(),t._initProteinControls(),t._initButtons(),n.draggable({handle:".mutation-3d-info-title",stop:function(t,e){var i=parseInt(n.css("top")),a=parseInt(n.css("left"));0>i&&n.css("top",0),0>a&&n.css("left",0)}}),n.resizable({alsoResize:".mutation-3d-vis-container,.mutation-3d-vis-container div:eq(0)",handles:"sw, s, w",minWidth:400,minHeight:300,start:function(t,e){n.find(".mutation-3d-vis-help-content").css("width","auto"),n.css("position","fixed")},stop:function(t,e){n.css("height","auto"),n.css("position","fixed")}})},_initButtons:function(){var t=this,e=t.options.mut3dVis,n=t.$el.find(".mutation-3d-vis-help-content"),i=t.$el.find(".mutation-3d-vis-help-init"),a=t.$el.find(".mutation-3d-vis-help-open"),o=t.$el.find(".mutation-3d-vis-help-close"),r=t.$el.find(".mutation-3d-pymol-dload");a.click(function(t){t.preventDefault(),n.slideToggle(),i.slideToggle()}),o.click(function(t){t.preventDefault(),n.slideToggle(),i.slideToggle()}),r.click(function(n){n.preventDefault();var i=e.generatePymolScript(),a=t.$el.find(".mutation-3d-pdb-id").text().trim()+"_"+t.$el.find(".mutation-3d-chain-id").text().trim()+".pml",o={filename:a,contentType:"text/plain;charset=utf-8",preProcess:!1};cbio.download.initDownload(i,o)}),r.qtip(t._generateTooltipOpts("Download PyMOL script"))},_initMutationControls:function(){var t=this,e=t.options.mut3dVis,n=t.$el.find(".mutation-3d-side-chain-select");n.change(function(){var t=$(this).val();e&&(e.updateOptions({displaySideChain:t}),e.reapplyStyle())});var i=t.$el.find(".mutation-3d-mutation-color-select");i.change(function(){var t=$(this).val();e&&(e.updateOptions({colorMutations:t}),e.reapplyStyle())}),t._initMutationColorInfo(),t._initSideChainInfo()},_initProteinControls:function(){var t=this,e=t.options.mut3dVis,n=t.$el.find(".mutation-3d-display-non-protein");n.change(function(){var t=n.is(":checked");e&&(e.updateOptions({restrictProtein:!t}),e.reapplyStyle())}),t._initHideNonProteinInfo(),t._initProteinSchemeSelector(),t._initProteinColorSelector()},_initProteinColorSelector:function(){var t=this,e=t.$el.find(".mutation-3d-protein-color-select"),n=t.options.mut3dVis;e.change(function(){var t=$(this).val();n.updateOptions({colorProteins:t}),n.reapplyStyle()})},_initProteinSchemeSelector:function(){var t=this,e=t.options.mut3dVis,n=t.$el.find(".mutation-3d-protein-style-select"),i=t.$el.find(".mutation-3d-protein-color-select");t._initProteinColorInfo(),n.change(function(){var t=$(this).val(),n=!1;i.find("option").removeAttr("disabled");var a=null;if(a="spaceFilling"==t?i.find("option[value='bySecondaryStructure']"):i.find("option[value='byAtomType']"),a.is(":selected")&&(a.removeAttr("selected"),i.find("option[value='uniform']").attr("selected","selected"),n="uniform"),a.attr("disabled","disabled"),e){var o={};o.proteinScheme=t,n&&(o.colorProteins=n),e.updateOptions(o),e.reapplyStyle()}})},_initZoomSlider:function(){var t=this,e=t.$el.find(".mutation-3d-zoom-slider"),n=t.options.mut3dVis,i=function(t){return 0>t?100+t:100+5*t},a=function(t,e){n&&n.zoomTo(i(e.value))};e.slider({value:0,min:-80,max:80,stop:a,slide:a})},updateView:function(t,e,n){var i=this,a=i.options.mut3dVis,o=i.options.pdbProxy,r=function(t){n.positionMap=t,a.show(),i.refreshView(e,n),i.pdbId=e,i.chain=n},l=function(a){var l={pdbId:e,chainId:n.chainId,pdbInfo:"",molInfo:""};if(a&&a[e]){var u=PdbDataUtil.generatePdbInfoSummary(a[e],n.chainId);l.pdbInfo=u.title,l.molInfo=u.molecule}var s=new Mutation3dVisInfoView({el:i.$el.find(".mutation-3d-info"),model:l});s.render(),o.getPositionMap(t,n,r)};o.getPdbInfo(e,l)},refreshView:function(t,e){var n=this,i=n.options.mut3dVis;n.hideResidueWarning(),n.hideNoMapWarning();var a=function(t){0==t.length?n.showNoMapWarning():n.hideNoMapWarning()};if(null==t&&null==e||t==n.pdbId&&e==n.chain){var o=i.refresh();a(o),n.dispatcher.trigger(MutationDetailsEvents.VIEW_3D_STRUCTURE_RELOADED)}else n.showLoader(),setTimeout(function(){var o=i.reload(t,e,function(){n.hideLoader(),n.dispatcher.trigger(MutationDetailsEvents.VIEW_3D_STRUCTURE_RELOADED)});a(o)},50)},_initMutationColorInfo:function(){var t=this,e=t.$el.find(".mutation-type-color-help"),n=BackboneTemplateCache.getTemplateFn("mutation_3d_type_color_tip_template"),i=n({}),a=t._generateTooltipOpts(i);a.style.classes+=" qtip-wide",e.qtip(a)},_initProteinColorInfo:function(){var t=this,e=t.$el.find(".protein-struct-color-help"),n=BackboneTemplateCache.getTemplateFn("mutation_3d_structure_color_tip_template"),i=n({}),a=t._generateTooltipOpts(i);a.style.classes+=" qtip-wide",e.qtip(a)},_initSideChainInfo:function(){var t=this,e=t.$el.find(".display-side-chain-help"),n=BackboneTemplateCache.getTemplateFn("mutation_3d_side_chain_tip_template"),i=n({}),a=t._generateTooltipOpts(i);e.qtip(a)},_initHideNonProteinInfo:function(){var t=this,e=t.$el.find(".display-non-protein-help"),n=BackboneTemplateCache.getTemplateFn("mutation_3d_non_protein_tip_template"),i=n({}),a=t._generateTooltipOpts(i);e.qtip(a)},_generateTooltipOpts:function(t){return{content:{text:t},hide:{fixed:!0,delay:100,event:"mouseout"},show:{event:"mouseover"},style:{classes:"qtip-light qtip-rounded qtip-shadow"},position:{my:"top right",at:"bottom center",viewport:$(window)}}},minimizeView:function(){var t=this,e=t.options.mut3dVis;e&&e.minimize()},maximizeView:function(){var t=this,e=t.options.mut3dVis;e&&e.maximize()},resetPanelPosition:function(){var t=this,e=t.$el;e.css({left:"",position:"",top:0})},hideView:function(){var t=this,e=t.options.mut3dVis;null!=e&&e.hide(),t.dispatcher.trigger(MutationDetailsEvents.VIEW_3D_PANEL_CLOSED)},isVisible:function(){var t=this,e=t.options.mut3dVis;return e.isVisible()},focusView:function(t){var e=this,n=e.options.mut3dVis;return t?n.focusOn(t):(n.resetFocus(),!0)},highlightView:function(t,e){var n=this,i=n.options.mut3dVis;return i.highlight(t,e)},resetHighlight:function(){var t=this,e=t.options.mut3dVis;e.resetHighlight()},showLoader:function(){var t=this,e=t.$el.find(".mutation-3d-vis-loader"),n=t.$el.find(".mutation-3d-vis-container"),i=n.css("height");0!==i&&"0px"!==i&&(t._actualHeight=i,n.css("height",0)),e.show()},hideLoader:function(){var t=this,e=t.$el.find(".mutation-3d-vis-loader"),n=t.$el.find(".mutation-3d-vis-container");e.hide(),n.css("height",t._actualHeight)},showResidueWarning:function(t,e){var n=this,i=n.$el.find(".mutation-3d-residue-warning"),a=n.$el.find(".mutation-3d-unmapped-info");n.$el.find(".mutation-3d-nomap-warning").is(":visible")||(e>1?a.text(t+" of the selections"):a.text("Selected mutation"),i.show())},hideResidueWarning:function(){var t=this,e=t.$el.find(".mutation-3d-residue-warning");e.hide()},showNoMapWarning:function(){var t=this,e=t.$el.find(".mutation-3d-nomap-warning");e.show()},hideNoMapWarning:function(){var t=this,e=t.$el.find(".mutation-3d-nomap-warning");e.hide()}}),MutationCustomizePanelView=Backbone.View.extend({initialize:function(t){this.options=t||{}},render:function(){var t=this,e=t.options.diagram,n={minY:2,maxY:e.getMaxY()},i=BackboneTemplateCache.getTemplateFn("mutation_customize_panel_template"),a=i(n);t.$el.html(a),t.format()},format:function(){var t=this,e=t.options.diagram;t.$el.hide();var n=t.$el.find(".diagram-customize-close"),i=t.$el.find(".diagram-y-axis-slider"),a=t.$el.find(".diagram-y-axis-limit-input");n.click(function(e){e.preventDefault(),t.toggleView()});var o=e.getMaxY();a.val(o),i.slider({value:o,min:2,max:o,change:function(t,n){a.val(n.value),e.updateOptions({maxLengthY:n.value}),e.rescaleYAxis()},slide:function(t,e){a.val(e.value)}}),a.keypress(function(t){var n=13;if(t.keyCode==n){var r=a.val();isNaN(r)||r>o||2>r?a.val(e.getMaxY()):i.slider("option","value",Math.floor(r))}})},toggleView:function(){var t=this;t.$el.slideToggle()}}),MutationDetailsTableView=Backbone.View.extend({initialize:function(t){this.options=t||{},this.dispatcher={},_.extend(this.dispatcher,Backbone.Events)},render:function(){var t=this,e=BackboneTemplateCache.getTemplateFn("mutation_details_table_template"),n=e({loaderImage:"images/ajax-loader.gif"});t.$el.html(n),t._initMutationTable(),t.format()},_initMutationTable:function(t){var e=this,n=jQuery.extend(!0,{},e.model.tableOpts);n.el=n.el||e.$el.find(".mutation_details_table");var i=new MutationCollection(e.model.mutations),a=new MutationDetailsUtil(i),o=new MutationDetailsTable(n,e.model.geneSymbol,a,e.model.dataProxies);return e.tableUtil=o,_.isFunction(t)&&t(e,o),e._generateRowData(o.getColumnOptions(),i,function(t){o.renderTable(t)}),o},_generateRowData:function(t,e,n){var i=[];e.each(function(e){for(var n={mutation:e},a=[n],o=0;o<_.size(t)-1;o++)a.push(null);i.push(a)}),n(i)},format:function(){},hideView:function(){var t=this;t.$el.hide()},showView:function(){var t=this;t.$el.show()},highlight:function(t){for(var e=this,n=e.$el.find(".mutation_details_table"),i=0;i<t.length;i++){var a=n.find("tr."+t[i].mutationSid);a.addClass("mutation-table-highlight")}},clearHighlights:function(){var t=this,e=t.$el.find(".mutation_details_table");e.find("tr").removeClass("mutation-table-highlight")},filter:function(t,e,n){for(var i=this,a=i.tableUtil.getDataTable(),o=[],r=0;r<t.length;r++)o.push(t[r].mutationSid);var l="("+o.join("|")+")",u=!0;0==o.length&&(l="",u=!1),i.tableUtil.setEventActive(!1),i._applyFilter(a,l,u,e,n),i.tableUtil.setEventActive(!0)},resetFilters:function(){var t=this;t.filter([],!0),t.tableUtil.cleanFilters()},rollBack:function(){var t=this,e=t.tableUtil.getDataTable();t.tableUtil.setEventActive(!1);var n=t.tableUtil.getManualSearch();t._applyFilter(e,n,!1),t.tableUtil.setEventActive(!0)},_applyFilter:function(t,e,n,i,a){var o=this;void 0==a&&(a=null),void 0==i&&(i=!1);var r=!0,l=!0,u=o.$el.find(".mutation_datatables_filter input[type=search]").val();t.fnFilter(e,a,n,r,i,l),i||o.$el.find(".mutation_datatables_filter input[type=search]").val(u)}}),MutationDetailsView=Backbone.View.extend({initialize:function(t){this.options=t||{},this.dispatcher={},_.extend(this.dispatcher,Backbone.Events)},render:function(){var t=this;t.geneTabView={};var e=t._generateContent(),n={loaderImage:"images/ajax-loader.gif",listContent:e.listContent,mainContent:e.mainContent},i=BackboneTemplateCache.getTemplateFn("default_mutation_details_template"),a=i(n);t.$el.html(a),t.model.mutationProxy.hasData()&&t._initDefaultView(),t.format()},format:function(){var t=this;if(t.model.mutationProxy.hasData()){var e=t.$el.find(".mutation-details-content");e.tabs(),e.tabs("paging",{tabsPerPage:10,follow:!0,cycle:!1}),e.tabs("option","active",0),t.$el.find(".mutation-details-tabs-ref").tipTip({defaultPosition:"bottom",delay:"100",edgeOffset:10,maxWidth:200})}},refreshGenesTab:function(){$(window).trigger("resize")},_generateContent:function(){var t=this,e="",n="";return _.each(t.model.mutationProxy.getGeneList(),function(t,i){var a=BackboneTemplateCache.getTemplateFn("default_mutation_details_main_content_template");e+=a({loaderImage:"images/ajax-loader.gif",geneSymbol:t,geneId:cbio.util.safeProperty(t)}),a=BackboneTemplateCache.getTemplateFn("default_mutation_details_list_content_template"),n+=a({geneSymbol:t,geneId:cbio.util.safeProperty(t)})}),{mainContent:e,listContent:n}},_initDefaultView:function(){var t=this,e=t.$el.find(".mutation-details-content");e.bind("tabscreate",!1),e.bind("tabsactivate",!1),e.bind("tabscreate",function(e,n){t.$el.find(".mutation-details-loader").hide(),t.dispatcher.trigger(MutationDetailsEvents.GENE_TABS_CREATED)}),e.bind("tabsactivate",function(e,n){var i=n.newTab.text().trim();t.dispatcher.trigger(MutationDetailsEvents.GENE_TAB_SELECTED,i)})}}),MutationDiagramView=Backbone.View.extend({initialize:function(t){this.options=t||{},this.dispatcher={},_.extend(this.dispatcher,Backbone.Events)},render:function(){var t=this,e={geneSymbol:t.model.geneSymbol,uniprotId:t.model.sequence.metadata.identifier},n=BackboneTemplateCache.getTemplateFn("mutation_diagram_view_template"),i=n(e);t.$el.html(i),t.mutationDiagram=t._initMutationDiagram(t.model.geneSymbol,t.model.mutations,t.model.sequence,t.model.dataProxies,t.model.diagramOpts),t.format()},format:function(){var t=this;t.$el.find(".mutation-diagram-toolbar").hide(),t.$el.find(".mutation-diagram-customize").hide(),t.$el.find(".mutation-diagram-help").hide(),t.$el.find(".mutation-diagram-toolbar-buttons").css("visibility","hidden"),t.mutationDiagram&&t._initToolbar(t.mutationDiagram,t.model.geneSymbol)},_initMutationDiagram:function(t,e,n,i,a){var o=this;if(a||(a={}),""==n.length||parseInt(n.length)<=0)return null;a.el=o.$el.find(".mutation-diagram-container");var r=new MutationCollection(e),l={pileups:PileupUtil.convertToPileups(r),sequence:n},u=new MutationDiagram(t,a,l,i);return null==n?$.getJSON("getPfamSequence.json",{geneSymbol:o.geneSymbol},function(t){t&&u.updateSequenceData(t[0]),u.initDiagram()}):u.initDiagram(),u},_initToolbar:function(t,e){var n=this,i=n.$el.find(".mutation-diagram-toolbar"),a=n.$el.find(".diagram-to-pdf"),o=n.$el.find(".diagram-to-svg"),r=n.$el.find(".diagram-customize"),l=n.$el.find(".diagram-help"),u=function(t,n,i){var a="mutation_diagram_"+e+"."+i;if(t(n,!1),"svg"==i)cbio.download.initDownload(n.svg[0][0],{filename:a});else if("pdf"==i){var o={filename:a,contentType:"application/pdf",servletName:"svgtopdf.do"};cbio.download.initDownload(n.svg[0][0],o)}t(n,!0)},s=function(t,n){var i=e;n&&(i=""),t.updateTopLabel(i)},c=function(t,e){s(t,e)};o.click(function(e){u(s,t,"svg")}),a.click(function(e){u(c,t,"pdf")}),r.click(function(e){var i=n.customizePanelView;i||(i=new MutationCustomizePanelView({el:n.$el.find(".mutation-diagram-customize"),diagram:t}),i.render(),n.customizePanelView=i),i.toggleView()}),l.click(function(t){var e=n.helpPanelView;e||(e=new MutationHelpPanelView({el:n.$el.find(".mutation-diagram-help")}),e.render(),n.helpPanelView=e),e.toggleView()}),n._autoHideToolbarButtons(),i.show()},_autoHideToolbarButtons:function(){var t=this,e=t.$el.find(".mutation-diagram-toolbar-buttons");cbio.util.autoHideOnMouseLeave(t.$el,e)}}),MutationHelpPanelView=Backbone.View.extend({initialize:function(t){this.options=t||{}},render:function(){var t=this,e=BackboneTemplateCache.getTemplateFn("mutation_help_panel_template"),n=e({});t.$el.html(n),t.format()},format:function(){var t=this,e=t.$el.find(".diagram-help-close");e.click(function(e){e.preventDefault(),t.toggleView()})},toggleView:function(){var t=this;t.$el.slideToggle()}}),PancanMutationHistTipView=Backbone.View.extend({render:function(){var t=this,e={gene:t.model.geneSymbol},n=BackboneTemplateCache.getTemplateFn("pancan_mutation_hist_tip_template"),i=n(e);t.model.qtipApi.set("content.text",i),this.format()},format:function(){var t=this,e=t.model.geneSymbol,n=t.model.proteinPosStart,i=t.model.cancerStudyMetaData,a=t.model.cancerStudyName,o=t.model.pancanMutationFreq[n],r=t.model.pancanMutationFreq[e],l=t.$el.find(".pancan-histogram-container"),u=PancanMutationHistogram(o,r,i,l[0],{this_cancer_study:a});t.$el.find(".overall-count").html(u.overallCountText());var s=$(l).find("svg").attr("width");t.$el.css("max-width",parseInt(s));var c=t.$el.find("svg")[0];u.qtip(c),$(".cross-cancer-download").click(function(){var t=$(this).attr("file-type"),n=e+"_mutations."+t;"pdf"==t?cbio.download.initDownload(c,{filename:n,contentType:"application/pdf",servletName:"svgtopdf.do"}):cbio.download.initDownload(c,{filename:n})})}}),PdbChainTipView=Backbone.View.extend({render:function(){var t=this.compileTemplate();this.$el.html(t),this.format()},format:function(){},compileTemplate:function(){var t=this,e=t.model.pdbInfo,n=t.model.molInfo,i={pdbId:t.model.pdbId,chainId:t.model.chain.chainId,pdbInfo:"",molInfo:""};(null!=e||e.length>0)&&(i.pdbInfo=": "+e),(null!=n||n.length>0)&&(i.molInfo=": "+n);var a=BackboneTemplateCache.getTemplateFn("mutation_details_pdb_chain_tip_template");return a(i)}}),PdbPanelView=Backbone.View.extend({initialize:function(t){this.options=t||{},this.collapseTimer=null,this.expandTimer=null},render:function(){var t=this,e=BackboneTemplateCache.getTemplateFn("pdb_panel_view_template"),n=e({});t.$el.html(n),t.pdbPanel=t._initPdbPanel(),t.format()},format:function(){var t=this;t.$el.hide();var e=t.$el.find(".expand-collapse-pdb-panel"),n=t.$el.find(".init-pdb-table"),i=t.$el.find(".pdb-table-controls"),a=t.$el.find(".triangle-down"),o=t.$el.find(".triangle");t.pdbPanel.hasMoreChains()&&(e.button({icons:{primary:"ui-icon-triangle-2-n-s"},text:!1}),e.css({width:"300px",height:"12px"}),e.click(function(){t.pdbPanel.toggleHeight()})),e.hide(),i.hide(),a.hide(),o.click(function(t){n.click()}),t.$el.find(".mutation-pdb-main-container").mouseenter(function(e){t.autoExpand()}),t.$el.find(".mutation-pdb-main-container").mouseleave(function(e){t.autoCollapse()})},hideView:function(){var t=this;t.$el.slideUp()},showView:function(){var t=this;t.$el.slideDown()},initPdbTableView:function(t,e){var n=this,i={el:n.$el.find(".mutation-pdb-table-view"),model:{geneSymbol:n.model.geneSymbol,pdbColl:t,pdbProxy:n.model.pdbProxy}},a=new PdbTableView(i);return n.pdbTableView=a,a.render(e),a},addInitCallback:function(t){var e=this,n=e.$el.find(".init-pdb-table");n.click(function(e){e.preventDefault(),t(e)})},toggleTableControls:function(){var t=this;t.$el.find(".triangle").toggle()},selectDefaultChain:function(){var t=this,e=t.pdbPanel,n=e.getDefaultChainGroup();t.clearTimers(),e.restoreChainPositions(function(){e.highlight(n)})},selectChain:function(t,e){var n=this,i=n.pdbPanel;n.clearTimers(),i.restoreChainPositions(function(){i.expandToChainLevel(t,e);var n=i.getChainGroup(t,e);n&&i.highlight(n)})},getSelectedChain:function(){var t=this,e=t.pdbPanel;return e.getHighlighted()},autoCollapse:function(t){null==t&&(t=2e3);var e=this,n=e.$el.find(".expand-collapse-pdb-panel"),i=e.$el.find(".pdb-table-controls"),a=e.$el.find(".pdb-table-wrapper");e.clearTimers(),e.collapseTimer=setTimeout(function(){e.pdbPanel.minimizeToHighlighted(),n.slideUp(),i.slideUp(),a.slideUp()},t)},autoExpand:function(t){null==t&&(t=400);var e=this,n=e.$el.find(".expand-collapse-pdb-panel"),i=e.$el.find(".pdb-table-controls"),a=e.$el.find(".pdb-table-wrapper");e.clearTimers(),e.expandTimer=setTimeout(function(){e.pdbPanel.restoreToFull(),e.pdbPanel.hasMoreChains()&&n.slideDown(),i.slideDown(),a.slideDown(),null!=e.pdbTableView&&e.pdbTableView.refreshView()},t)},toggleScrollBar:function(t){var e=this,n=e.$el.find(".mutation-pdb-panel-container");t>0?(n.css("max-height",t),n.css("overflow",""),n.css("overflow-y","scroll")):(n.css("max-height",""),n.css("overflow-y",""),n.css("overflow","hidden"))},scrollToSelected:function(){var t=this,e=t.$el.find(".mutation-pdb-panel-container");e.scrollTo($(".pdb-selection-rectangle-group"),{axis:"y",duration:800,offset:-150})},clearTimers:function(){var t=this;null!=t.collapseTimer&&clearTimeout(t.collapseTimer),null!=t.expandTimer&&clearTimeout(t.expandTimer)},_initPdbPanel:function(){var t=this,e=null,n=t.model.pdbColl,i=t.model.pdbProxy,a=t.options.diagram;if(null!=a){var o=a.xScale,r={el:t.$el.find(".mutation-pdb-panel-container"),marginLeft:a.options.marginLeft,marginRight:a.options.marginRight,maxHeight:200};e=new MutationPdbPanel(r,n,i,o),e.init()}return e}}),PdbTableView=Backbone.View.extend({initialize:function(t){this.options=t||{}},render:function(t){var e=this,n=BackboneTemplateCache.getTemplateFn("pdb_table_view_template"),i=n({loaderImage:"images/ajax-loader.gif"});e.$el.html(i),e._initPdbTable(t),e.format()},format:function(){var t=this;t.$el.hide()},hideView:function(){var t=this;t.$el.slideUp()},showView:function(){var t=this;t.$el.slideDown()},toggleView:function(){var t=this;t.$el.slideToggle()},refreshView:function(){var t=this;t.pdbTable.getDataTable().fnAdjustColumnSizing()},resetFilters:function(){var t=this;t.pdbTable.cleanFilters()},selectChain:function(t,e){var n=this;null!=n.pdbTable&&n.pdbTable.selectRow(t,e)},scrollToSelected:function(){var t=this,e=t.pdbTable.getSelectedRow(),n=t.$el.find(".dataTables_scrollBody");n.scrollTo($(e),{axis:"y",duration:800})},_initPdbTable:function(t){var e=this,n=e.model.pdbColl,i=e.model.pdbProxy,a=jQuery.extend(!0,{},e.model.tableOpts);a.el=a.el||e.$el.find(".pdb-chain-table");var o=new MutationPdbTable(a);return e.pdbTable=o,_.isFunction(t)&&t(e,o),e._generateRowData(o.getColumnOptions(),n,i,function(t){o.renderTable(t),e.$el.find(".pdb-chain-table-loader").hide()}),o},_generateRowData:function(t,e,n,i){var a=[],o=[];e.each(function(t){o.push(t.pdbId)}),n.getPdbInfo(o.join(" "),function(n){e.each(function(e){e.chains.each(function(i){for(var o={pdbId:e.pdbId,chain:i,organism:PdbDataUtil.getOrganism(n[e.pdbId],i.chainId),summary:PdbDataUtil.generatePdbInfoSummary(n[e.pdbId],i.chainId)},r=[o],l=0;l<_.size(t)-1;l++)r.push(null);a.push(r)})}),i(a)})}}),PredictedImpactTipView=Backbone.View.extend({render:function(){var t=this.compileTemplate();this.$el.html(t),this.format()},format:function(){var t=function(t){var e=!0;return(null==t||"NA"==t||0==t.length)&&(e=!1),e},e=this.model.xvia;t(e)||this.$el.find(".mutation-assessor-main-link").hide();var n=this.model.pdbLink;t(n)||this.$el.find(".mutation-assessor-3d-link").hide();var i=this.model.msaLink;t(i)||this.$el.find(".mutation-assessor-msa-link").hide()},compileTemplate:function(){var t={linkOut:this.model.xvia,msaLink:this.model.msaLink,pdbLink:this.model.pdbLink,impact:this.model.impact},e=BackboneTemplateCache.getTemplateFn("mutation_details_fis_tip_template");return e(t)}}),RegionTipView=Backbone.View.extend({render:function(){var t=this.compileTemplate();this.$el.html(t),this.format()},format:function(){},compileTemplate:function(){var t={identifier:this.model.identifier,type:this.model.type.toLowerCase(),description:this.model.description,start:this.model.start,end:this.model.end,pfamAccession:this.model.pfamAccession,mutationAlignerInfo:this.model.mutationAlignerInfo},e=BackboneTemplateCache.getTemplateFn("mutation_details_region_tip_template");return e(t)}});MutationAlignerDataProxy.prototype=new AbstractDataProxy,MutationAlignerDataProxy.prototype.constructor=MutationAlignerDataProxy,MutationDataProxy.prototype=new AbstractDataProxy,MutationDataProxy.prototype.constructor=MutationDataProxy,PancanMutationDataProxy.prototype=new AbstractDataProxy,PancanMutationDataProxy.prototype.constructor=PancanMutationDataProxy,PdbDataProxy.prototype=new AbstractDataProxy,PdbDataProxy.prototype.constructor=PdbDataProxy,PfamDataProxy.prototype=new AbstractDataProxy,PfamDataProxy.prototype.constructor=PfamDataProxy,PortalDataProxy.prototype=new AbstractDataProxy,PortalDataProxy.prototype.constructor=PortalDataProxy,MutationDetailsTable.prototype=new AdvancedDataTable,MutationDetailsTable.prototype.constructor=MutationDetailsTable,MutationDiagram.prototype.defaultOpts={el:"#mutation_diagram_d3",elWidth:740,elHeight:180,marginLeft:45,marginRight:30,marginTop:30,marginBottom:60,labelTop:"",labelTopFont:"sans-serif",labelTopFontColor:"#2E3436",labelTopFontSize:"12px",labelTopFontWeight:"bold",labelTopMargin:2,labelX:!1,labelXFont:"sans-serif",labelXFontColor:"#2E3436",labelXFontSize:"12px",labelXFontWeight:"normal",labelY:"# Mutations",labelYFont:"sans-serif",labelYFontColor:"#2E3436",labelYFontSize:"12px",labelYFontWeight:"normal",
minLengthX:0,minLengthY:5,maxLengthX:1/0,maxLengthY:1/0,seqFillColor:"#BABDB6",seqHeight:14,seqPadding:5,regionHeight:24,regionFont:"sans-serif",regionFontColor:"#FFFFFF",regionFontSize:"12px",regionTextAnchor:"middle",showRegionText:!0,showStats:!1,multiSelectKeycode:16,lollipopLabelCount:1,lollipopLabelThreshold:2,lollipopFont:"sans-serif",lollipopFontColor:"#2E3436",lollipopFontSize:"10px",lollipopTextAnchor:"auto",lollipopTextPadding:8,lollipopTextAngle:0,lollipopFillColor:{missense_mutation:"#008000",nonsense_mutation:"#FF0000",nonstop_mutation:"#FF0000",frame_shift_del:"#FF0000",frame_shift_ins:"#FF0000",in_frame_ins:"#000000",in_frame_del:"#000000",splice_site:"#FF0000",other:"#808080","default":"#800080"},lollipopBorderColor:"#BABDB6",lollipopBorderWidth:.5,lollipopSize:30,lollipopHighlightSize:100,lollipopStrokeWidth:1,lollipopStrokeColor:"#BABDB6",lollipopShapeRegular:"circle",lollipopShapeSpecial:"circle",xAxisPadding:10,xAxisTickIntervals:[100,200,400,500,1e3,2e3,5e3,1e4,2e4,5e4],xAxisTicks:8,xAxisTickSize:6,xAxisStroke:"#AAAAAA",xAxisFont:"sans-serif",xAxisFontSize:"10px",xAxisFontColor:"#2E3436",yAxisPadding:5,yAxisLabelPadding:15,yAxisTicks:10,yAxisTickIntervals:[1,2,5,10,20,50,100,200,500],yAxisTickSize:6,yAxisStroke:"#AAAAAA",yAxisFont:"sans-serif",yAxisFontSize:"10px",yAxisFontColor:"#2E3436",animationDuration:1e3,fadeDuration:1500,lollipopTipFn:function(t,e,n){var i=new LollipopTipView({model:e});i.setShowStats(n);var a=i.compileTemplate(),o={content:{text:a},hide:{fixed:!0,delay:100,event:"mouseout"},show:{event:"mouseover"},style:{classes:"qtip-light qtip-rounded qtip-shadow cc-ui-tooltip"},position:{my:"bottom left",at:"top center",viewport:$(window)}};$(t).qtip(o)},regionTipFn:function(t,e,n){var i={identifier:e.metadata.identifier,type:e.type,description:e.metadata.description,start:e.metadata.start,end:e.metadata.end,pfamAccession:e.metadata.accession,mutationAlignerInfo:""};n.getMutationAlignerData({pfamAccession:e.metadata.accession},function(e){if(null!=e&&null!=e.linkToMutationAligner&&e.linkToMutationAligner.length>0){var n=BackboneTemplateCache.getTemplateFn("mutation_aligner_info_template");i.mutationAlignerInfo=n({linkToMutationAligner:e.linkToMutationAligner})}var a=new RegionTipView({model:i}),o=a.compileTemplate(),r={content:{text:o},hide:{fixed:!0,delay:100,event:"mouseout"},show:{event:"mouseover"},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-lightyellow"},position:{my:"bottom left",at:"top center",viewport:$(window)}};$(t).qtip(r)})}},MutationDiagram.prototype.updateOptions=function(t){var e=this;e.options=jQuery.extend(!0,{},e.options,t);var n=e.xMax=e.calcXMax(e.options,e.data),i=e.maxCount=e.calcMaxCount(e.data.pileups),a=e.yMax=e.calcYMax(e.options,i);e.bounds=this.calcBounds(e.options),e.xScale=this.xScaleFn(e.bounds,n),e.yScale=this.yScaleFn(e.bounds,a)},MutationDiagram.prototype.rescaleYAxis=function(){var t=this,e=t.maxCount=t.calcMaxCount(t.data.pileups),n=t.calcYMax(t.options,e);t.svg.select(".mut-dia-y-axis").remove(),t.drawYAxis(t.svg,t.yScale,n,t.options,t.bounds),t.updatePlot()},MutationDiagram.prototype.updateSequenceData=function(t){var e=this;e.data.sequence=t},MutationDiagram.prototype.initDiagram=function(){var t=this,e=$(t.options.el)[0],n=d3.select(e),i=t.bounds=t.calcBounds(t.options);t.mutationPileupMap=PileupUtil.mapToMutations(t.data.pileups);var a=t.createSvg(n,t.options.elWidth,t.options.elHeight);t.svg=a,t.drawDiagram(a,i,t.options,t.data),t.addDefaultListeners()},MutationDiagram.prototype.calcBounds=function(t){var e={};return e.width=t.elWidth-(t.marginLeft+t.marginRight),e.height=t.elHeight-(t.marginBottom+t.marginTop),e.x=t.marginLeft,e.y=t.elHeight-t.marginBottom,e},MutationDiagram.prototype.drawDiagram=function(t,e,n,i){var a=this,o=(parseInt(i.sequence.length),a.maxCount=a.calcMaxCount(i.pileups)),r=a.xMax=a.calcXMax(n,i),l=a.yMax=a.calcYMax(n,o),u=i.sequence.regions,s=i.pileups,c=a.generateSequenceTooltip(i),d=a.xScale=a.xScaleFn(e,r),p=a.yScale=a.yScaleFn(e,l);a.drawXAxis(t,d,r,n,e),0!=n.labelX,a.drawYAxis(t,p,l,n,e),0!=n.labelY&&(a.yAxisLabel=a.drawYAxisLabel(t,n,e)),0!=n.topLabel&&(a.topLabel=a.drawTopLabel(t,n,e));t.append("rect").attr("fill","#FFFFFF").attr("opacity",0).attr("x",e.x).attr("y",e.y-e.height).attr("width",e.width).attr("height",e.height).attr("class","mut-dia-background");a.drawPlot(t,s,n,e,d,p);var m=a.drawSequence(t,n,e);m.attr("title",c);for(var h=0,f=u.length;f>h;h++)a.drawRegion(t,u[h],n,e,d)},MutationDiagram.prototype.xScaleFn=function(t,e){return d3.scale.linear().domain([0,e]).range([t.x,t.x+t.width])},MutationDiagram.prototype.yScaleFn=function(t,e){return d3.scale.linear().domain([0,e]).range([t.y,t.y-t.height])},MutationDiagram.prototype.calcXMax=function(t,e){var n=parseInt(e.sequence.length);return Math.min(t.maxLengthX,Math.max(n,t.minLengthX))},MutationDiagram.prototype.calcYMax=function(t,e){return Math.min(t.maxLengthY,Math.max(e,t.minLengthY))},MutationDiagram.prototype.generateSequenceTooltip=function(t){var e="",n=parseInt(t.sequence.length);return t.sequence.metadata.identifier&&(e+=t.sequence.metadata.identifier,t.sequence.metadata.description&&(e+=", "+t.sequence.metadata.description)),e+=" ("+n+"aa)"},MutationDiagram.prototype.drawPlot=function(t,e,n,i,a,o){var r=this,l=r.gLabel;null===l&&(l=t.append("g").attr("class","mut-dia-lollipop-labels"),r.gLabel=l);var u=r.gLine;null===u&&(u=t.append("g").attr("class","mut-dia-lollipop-lines"),r.gLine=u);var s=r.gData;null===s&&(s=t.append("g").attr("class","mut-dia-lollipop-points"),r.gData=s);for(var c=0;c<e.length;c++)r.drawLollipop(s,u,e[c],n,i,a,o);r.drawLollipopLabels(l,e,n,a,o)},MutationDiagram.prototype.createSvg=function(t,e,n){var i=t.append("svg");return i.attr("width",e),i.attr("height",n),i},MutationDiagram.prototype.calcTickInterval=function(t,e,n){for(var i=-1,a=0;a<t.length;a++){i=t[a];var o=e/i;if(n-1>o)break}return i},MutationDiagram.prototype.getTickValues=function(t,e){for(var n=[],i=0;t>i;)n.push(i),i+=e/2;return n.push(t),n},MutationDiagram.prototype.drawXAxis=function(t,e,n,i,a){var o=this,r=o.calcTickInterval(i.xAxisTickIntervals,n,i.xAxisTicks),l=o.getTickValues(n,r),u=function(t){return t==n?t+" aa":t%r!=0?"":n-t>r/3?t:""},s=i.xAxisTickSize,c=d3.svg.axis().scale(e).orient("bottom").tickValues(l).tickFormat(u).tickSize(s,s/2,0),d=a.y+i.regionHeight+i.xAxisPadding,p=t.append("g").attr("class","mut-dia-x-axis").attr("transform","translate(0,"+d+")").call(c);return o.formatAxis(".mut-dia-x-axis",i.xAxisStroke,i.xAxisFont,i.xAxisFontSize,i.xAxisFontColor),p},MutationDiagram.prototype.drawYAxis=function(t,e,n,i,a){var o=this,r=o.calcTickInterval(i.yAxisTickIntervals,n,i.yAxisTicks),l=o.getTickValues(n,2*r),u=function(t){var e="";return t==n?(e=t,o.maxCount>n&&(e=">"+t)):0==t&&(e=t),e},s=i.yAxisTickSize,c=d3.svg.axis().scale(e).orient("left").tickValues(l).tickFormat(u).tickSize(s,s/2,0),d=a.x-i.yAxisPadding,p=t.append("g").attr("class","mut-dia-y-axis").attr("transform","translate("+d+",0)").call(c);return o.formatAxis(".mut-dia-y-axis",i.yAxisStroke,i.yAxisFont,i.yAxisFontSize,i.yAxisFontColor),p},MutationDiagram.prototype.drawTopLabel=function(t,e,n){var i=e.labelTopMargin,a=e.marginTop/2,o=t.append("text").attr("fill",e.labelTopFontColor).attr("text-anchor","start").attr("x",i).attr("y",a).attr("class","mut-dia-top-label").style("font-family",e.labelTopFont).style("font-size",e.labelTopFontSize).style("font-weight",e.labelTopFontWeight).text(e.labelTop);return o},MutationDiagram.prototype.drawYAxisLabel=function(t,e,n){var i=n.x-e.yAxisPadding-e.yAxisTickSize-e.yAxisLabelPadding,a=n.y-n.height/2,o=t.append("text").attr("fill",e.labelYFontColor).attr("text-anchor","middle").attr("x",i).attr("y",a).attr("class","mut-dia-y-axis-label").attr("transform","rotate(270, "+i+","+a+")").style("font-family",e.labelYFont).style("font-size",e.labelYFontSize).style("font-weight",e.labelYFontWeight).text(e.labelY);return o},MutationDiagram.prototype.formatAxis=function(t,e,n,i,a){var o=d3.selectAll(t+" line");o.style("fill","none").style("stroke",e).style("shape-rendering","crispEdges"),o=d3.selectAll(t+" path"),o.style("fill","none").style("stroke",e).style("shape-rendering","crispEdges"),o=d3.selectAll(t+" text"),o.attr("fill",a).style("font-family",n).style("font-size",i)},MutationDiagram.prototype.drawLollipop=function(t,e,n,i,a,o,r){var l=this,u=i.lollipopShapeRegular,s=n.count,c=n.location,d=o(c),p=r(s);s>i.maxLengthY&&(u=i.lollipopShapeSpecial,p=r(i.maxLengthY));var m=l.getLollipopFillColor(i,n);l.updateColorMap(n,m);var h=t.append("path").attr("d",d3.svg.symbol().size(i.lollipopSize).type(u)).attr("transform","translate("+d+","+p+")").attr("fill",m).attr("stroke",i.lollipopBorderColor).attr("stroke-width",i.lollipopBorderWidth).attr("id",n.pileupId).attr("class","mut-dia-data-point").attr("opacity",0);l.fadeIn(h),h.datum(n);var f=i.lollipopTipFn;f(h,n,i.showStats);var g=e.append("line").attr("x1",d).attr("y1",p).attr("x2",d).attr("y2",l.calcSequenceBounds(a,i).y).attr("stroke",i.lollipopStrokeColor).attr("stroke-width",i.lollipopStrokeWidth).attr("class","mut-dia-data-line").attr("opacity",0);return l.fadeIn(g),{dataPoint:h,line:g}},MutationDiagram.prototype.updateColorMap=function(t,e){for(var n=this,i=0;i<t.mutations.length;i++)n.mutationColorMap[t.mutations[i].mutationId]=e},MutationDiagram.prototype.getLollipopShapeFn=function(){var t=this,e=function(e){var n=t.options.lollipopShapeRegular;return e.count>t.options.maxLengthY&&(n=t.options.lollipopShapeSpecial),n};return e},MutationDiagram.prototype.getLollipopFillColor=function(t,e){var n,i=t.lollipopFillColor;if(_.isFunction(i))n=i();else if("string"==typeof i)n=i;else{var a=PileupUtil.getMutationTypeArray(e);if(a.length>1&&a[0].count==a[1].count){var o=PileupUtil.getMutationTypeGroups(e);n=1==o.length?i[a[0].type]:i["default"]}else n=void 0==i[a[0].type]?i.other:i[a[0].type]}return n},MutationDiagram.prototype.drawLollipopLabels=function(t,e,n,i,a){var o=this,r=function(t,e){var i=e;if("auto"==i.toLowerCase()){var a=t.attr("x")-t.node().getComputedTextLength()/2;i=a<n.marginLeft?"start":"middle"}return i},l=n.lollipopLabelCount,u=2;if(e.length>1){for(var s=e[0].count,c=0;c<e.length&&!(e[c].count<s);c++);c>l&&c>u&&(l=0)}for(var d=0;l>d&&d<e.length&&!(e.length>1&&e[d].count<n.lollipopLabelThreshold);d++){var p=i(e[d].location),m=a(Math.min(e[d].count,n.maxLengthY))-n.lollipopTextPadding,h=t.append("text").attr("fill",n.lollipopFontColor).attr("x",p).attr("y",m).attr("class","mut-dia-lollipop-text").attr("transform","rotate("+n.lollipopTextAngle+", "+p+","+m+")").style("font-size",n.lollipopFontSize).style("font-family",n.lollipopFont).text(e[d].label).attr("opacity",0);o.fadeIn(h);var f=r(h,n.lollipopTextAnchor);h.attr("text-anchor",f)}},MutationDiagram.prototype.drawRegion=function(t,e,n,i,a){var o=this,r=e.metadata.start,l=e.metadata.end,u=e.text,s=e.colour,c=Math.abs(a(r)-a(l)),d=n.regionHeight,p=i.y+n.seqPadding,m=a(r),h=t.append("g").attr("class","mut-dia-region").attr("transform","translate("+m+","+p+")"),f=h.append("rect").attr("fill",s).attr("x",0).attr("y",0).attr("width",c).attr("height",d),g=n.regionTipFn;if(g(f,e,o.dataProxies.mutationAlignerProxy),n.showRegionText){var v=o.drawRegionText(u,h,n,c);v&&g(v,e,o.dataProxies.mutationAlignerProxy)}return h},MutationDiagram.prototype.drawRegionText=function(t,e,n,i){var a=i/2,o=n.regionHeight;"start"===n.regionTextAnchor?a=0:"end"===n.regionTextAnchor&&(a=i);var r=e.append("text").style("font-size",n.regionFontSize).style("font-family",n.regionFont).text(t).attr("text-anchor",n.regionTextAnchor).attr("fill",n.regionFontColor).attr("x",a).attr("y",2*o/3).attr("class","mut-dia-region-text");return r.node().getComputedTextLength()>i&&(t=t.substring(0,3)+"..",r.text(t),r.node().getComputedTextLength()>i&&(r.remove(),r=null)),r},MutationDiagram.prototype.drawSequence=function(t,e,n){var i=this.calcSequenceBounds(n,e);return t.append("rect").attr("fill",e.seqFillColor).attr("x",i.x).attr("y",i.y).attr("width",i.width).attr("height",i.height).attr("class","mut-dia-sequence")},MutationDiagram.prototype.calcMaxCount=function(t){var e=-1;return t.length>0&&(e=t[0].count),e},MutationDiagram.prototype.calcSequenceBounds=function(t,e){var n=t.x,i=t.y+Math.abs(e.regionHeight-e.seqHeight)/2+e.seqPadding,a=t.width,o=e.seqHeight;return{x:n,y:i,width:a,height:o}},MutationDiagram.prototype.updatePlot=function(t){var e=this,n=e.pileups;t&&(e.pileups=n=t,e.mutationPileupMap=PileupUtil.mapToMutations(n)),e.cleanPlotArea(),e.mutationColorMap={},e.drawPlot(e.svg,n,e.options,e.bounds,e.xScale,e.yScale);for(var i in e.listeners){var a=e.svg.selectAll(i);for(var o in e.listeners[i])a.on(o,e.listeners[i][o])}return e.highlighted={},e.dispatcher.trigger(MutationDetailsEvents.DIAGRAM_PLOT_UPDATED),e.isFiltered()},MutationDiagram.prototype.cleanPlotArea=function(){var t=this,e=t.gLabel.selectAll("text"),n=t.gLine.selectAll("line"),i=t.gData.selectAll(".mut-dia-data-point");t.fadeOut(e,function(t){$(t).remove()}),t.fadeOut(n,function(t){$(t).remove()}),t.fadeOut(i,function(t){$(t).remove()})},MutationDiagram.prototype.resetPlot=function(){var t=this;t.updatePlot(t.data.pileups),t.dispatcher.trigger(MutationDetailsEvents.DIAGRAM_PLOT_RESET)},MutationDiagram.prototype.updateTopLabel=function(t){var e=this;(void 0==t||null==t)&&(t=""),e.topLabel.text(t)},MutationDiagram.prototype.addListener=function(t,e,n){var i=this;i.svg.selectAll(t).on(e,n),null==i.listeners[t]&&(i.listeners[t]={}),i.listeners[t][e]=n},MutationDiagram.prototype.removeListener=function(t,e){var n=this;n.svg.selectAll(t).on(e,null),n.listeners[t]&&n.listeners[t][e]&&delete n.listeners[t][e]},MutationDiagram.prototype.addDefaultListeners=function(){var t=this;t.addListener(".mut-dia-background","click",function(e,n){var i=!t.isHighlighted()||t.multiSelect;i||(t.clearHighlights(),t.dispatcher.trigger(MutationDetailsEvents.ALL_LOLLIPOPS_DESELECTED))}),t.addListener(".mut-dia-data-point","click",function(e,n){t.isHighlighted(this)?(t.removeHighlight(this),t.multiSelect||t.clearHighlights(),t.dispatcher.trigger(MutationDetailsEvents.LOLLIPOP_DESELECTED,e,n)):(t.multiSelect||t.clearHighlights(),t.highlight(this),t.dispatcher.trigger(MutationDetailsEvents.LOLLIPOP_SELECTED,e,n))}),t.addListener(".mut-dia-data-point","mouseout",function(e,n){t.dispatcher.trigger(MutationDetailsEvents.LOLLIPOP_MOUSEOUT,e,n)}),t.addListener(".mut-dia-data-point","mouseover",function(e,n){t.dispatcher.trigger(MutationDetailsEvents.LOLLIPOP_MOUSEOVER,e,n)});var e=function(e,n){t.multiSelect&&d3.event.preventDefault()};t.addListener(".mut-dia-data-point","mousedown",e),t.addListener(".mut-dia-background","mousedown",e),$(window).on("keydown",function(e){e.keyCode==t.options.multiSelectKeycode&&(t.multiSelect=!0)}),$(window).on("keyup",function(e){e.keyCode==t.options.multiSelectKeycode&&(t.multiSelect=!1)})},MutationDiagram.prototype.isHighlighted=function(t){var e=this,n=!1;if(void 0==t)n=!_.isEmpty(e.highlighted);else{var i=d3.select(t),a=i.datum().location;void 0!=e.highlighted[a]&&(n=!0)}return n},MutationDiagram.prototype.clearHighlights=function(){var t=this,e=t.gData.selectAll(".mut-dia-data-point");e.transition().ease("elastic").duration(t.options.animationDuration).attr("d",d3.svg.symbol().size(t.options.lollipopSize).type(t.getLollipopShapeFn())),t.highlighted={}},MutationDiagram.prototype.highlightMutation=function(t){var e=this,n=e.mutationPileupMap[t],i=e.svg.select("#"+n);i.length>0&&e.highlight(i[0][0])},MutationDiagram.prototype.highlight=function(t){var e=this,n=d3.select(t);n.transition().ease("elastic").duration(e.options.animationDuration).attr("d",d3.svg.symbol().size(e.options.lollipopHighlightSize).type(e.getLollipopShapeFn()));var i=n.datum().location;e.highlighted[i]=n},MutationDiagram.prototype.removeHighlight=function(t){var e=this,n=d3.select(t);n.transition().ease("elastic").duration(e.options.animationDuration).attr("d",d3.svg.symbol().size(e.options.lollipopSize).type(e.getLollipopShapeFn()));var i=n.datum().location;delete e.highlighted[i]},MutationDiagram.prototype.fadeIn=function(t,e){var n=this;t.transition().style("opacity",1).duration(n.options.fadeDuration).each("end",function(){_.isFunction(e)&&e(this)})},MutationDiagram.prototype.fadeOut=function(t,e){var n=this;t.transition().style("opacity",0).duration(n.options.fadeDuration).each("end",function(){_.isFunction(e)&&e(this)})},MutationDiagram.prototype.getSelectedElements=function(){var t=this,e=[];for(var n in t.highlighted)e.push(t.highlighted[n]);return e},MutationDiagram.prototype.isFiltered=function(){var t=this,e=!1;return PileupUtil.countMutations(t.pileups)<PileupUtil.countMutations(t.data.pileups)&&(e=!0),e},MutationDiagram.prototype.getMaxY=function(){return this.yMax},MutationDiagram.prototype.getMinY=function(){return this.options.minLengthY},MutationHistogram.prototype=new MutationDiagram,MutationHistogram.prototype.constructor=MutationHistogram,MutationHistogram.prototype.drawPlot=function(t,e,n,i,a,o){},MutationPdbTable.prototype=new AdvancedDataTable,MutationPdbTable.prototype.constructor=MutationPdbTable;var MutationDetailsEvents=function(){var t="mutationDiagramLollipopSelected",e="mutationDiagramLollipopDeselected",n="mutationDiagramAllDeselected",i="mutationDiagramLollipopMouseover",a="mutationDiagramLollipopMouseout",o="mutationDiagramPlotUpdated",r="mutationDiagramPlotReset",l="mutationTableFiltered",u="mutationTableProteinChangeLinkClicked",s="mutationTablePdbLinkClicked",c="mutationPdbPanelResizeStarted",d="mutationPdbPanelResizeEnded",p="mutationPdbPanelChainSelected",m="mutationPdbTableChainSelected",h="mutationPdbTableChainMouseout",f="mutationPdbTableChainMouseover",g="mutationPdbTableReady",v="mutationDetailsGeneTabSelected",b="mutationDetailsGeneTabsCreated",y="mutation3dPanelClosed",_="mutation3dStructureReloaded";return{LOLLIPOP_SELECTED:t,LOLLIPOP_DESELECTED:e,LOLLIPOP_MOUSEOVER:i,LOLLIPOP_MOUSEOUT:a,ALL_LOLLIPOPS_DESELECTED:n,DIAGRAM_PLOT_UPDATED:o,DIAGRAM_PLOT_RESET:r,MUTATION_TABLE_FILTERED:l,PROTEIN_CHANGE_LINK_CLICKED:u,PDB_LINK_CLICKED:s,PDB_PANEL_RESIZE_STARTED:c,PDB_PANEL_RESIZE_ENDED:d,PANEL_CHAIN_SELECTED:p,TABLE_CHAIN_SELECTED:m,TABLE_CHAIN_MOUSEOUT:h,TABLE_CHAIN_MOUSEOVER:f,PDB_TABLE_READY:g,GENE_TAB_SELECTED:v,GENE_TABS_CREATED:b,VIEW_3D_STRUCTURE_RELOADED:_,VIEW_3D_PANEL_CLOSED:y}}();