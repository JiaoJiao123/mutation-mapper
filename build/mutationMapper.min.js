function JSmolWrapper(){function t(t,n,e){a=t,o=jQuery.extend(!0,{},h,n);var i=o.width,m=4*o.height;r='<iframe id="jsmol_frame" src="'+e+'" seamless="seamless" width="'+i+'" height="'+m+'" frameBorder="0" scrolling="no"></iframe>';var f=function(t){if(cbio.util.getWindowOrigin()==t.origin)if("ready"==t.data.type)l&&(u=cbio.util.getTargetDocument("jsmol_frame"));else if("menu"==t.data.type)s&&("visible"==t.data.content?s.css("overflow","visible"):"hidden"==t.data.content&&s.css("overflow","hidden"));else if("done"==t.data.type){var n=p[t.data.scriptId];if(null!=n){delete p[t.data.scriptId];var e=n.callback;e&&_.isFunction(e)&&e()}_.isEmpty(d)||(n=d.shift(),p[n.data.scriptId]=n,l.postMessage(n.data,c))}};window.addEventListener("message",f,!1)}function n(t){t&&r&&(t.empty(),t.append(r),s=t),l=cbio.util.getTargetWindow("jsmol_frame"),l||console.log("warning: JSmol frame cannot be initialized properly")}function e(t,n){if(l){m=(m+1)%1e6;var e={type:"script",content:t,scriptId:"script_"+m};i(e,n)}}function i(t,n){var e={data:t,callback:n};_.isEmpty(d)?(p[e.data.scriptId]=e,l.postMessage(t,c)):d.push(e)}var a=null,o=null,r=null,l=null,u=null,s=null,c=cbio.util.getWindowOrigin(),d=[],p={},m=0,h={use:"HTML5",j2sPath:"js/lib/jsmol/j2s",disableJ2SLoadMonitor:!0,disableInitialConsole:!0};return{init:t,updateContainer:n,script:e}}function JmolScriptGenerator(){function t(t){return"load="+t+";"}function n(){return"select all;"}function e(){return"select none;"}function i(t){return S[t]}function a(t){return"color ["+w(t)+"];"}function o(t){return"select :"+t+";"}function r(t){return"select :"+t+" and helix;"}function l(t){return"select :"+t+" and sheet;"}function u(t){var n="@{{:"+t+"}.atomNo.min}",e="@{{:"+t+"}.atomNo.max}";return'color atoms property atomNo "roygb" range '+n+" "+e+";"}function s(t){return"color atoms CPK;"}function c(){return"restrict protein;"}function d(t){return"color translucent;"}function p(){return"color opaque;"}function m(t){var n=function(t){var n="";return null!=t&&t.length>0&&(n+="^"+t),n},e=t.start.pdbPos+n(t.start.insertion);return t.end.pdbPos>t.start.pdbPos&&(e+="-"+t.end.pdbPos+n(t.end.insertion)),e}function h(t,n){return"select ("+t.join(", ")+") and :"+n+";"}function f(t,n){return"select (("+t.join(", ")+") and :"+n+" and sidechain) or (("+t.join(", ")+") and :"+n+" and *.CA);"}function g(){return"wireframe 0.15; spacefill 25%;"}function v(){return"wireframe OFF; spacefill OFF;"}function b(t,n){var e=this,i=e.scriptPosition(t);return"center "+i+":"+n+";"}function y(){return"center;"}function _(){return"zoom in;"}function T(){return"zoom out;"}function C(t){return"spin "+t+";"}function P(t,n,e,i){var a=this,o=[];o.push(a.selectPositions(t,i.chainId)),o.push(a.setColor(n));var r="none"!=e.displaySideChain;return o=o.concat(a.generateSideChainScript(t,r,e,i))}function w(t){return t.replace("#","x")}var S={ballAndStick:"wireframe ONLY; wireframe 0.15; spacefill 20%;",spaceFilling:"spacefill ONLY; spacefill 100%;",ribbon:"ribbon ONLY;",cartoon:"cartoon ONLY;",trace:"trace ONLY;"};this.loadPdb=t,this.selectAll=n,this.selectNone=e,this.setScheme=i,this.setColor=a,this.selectChain=o,this.selectAlphaHelix=r,this.selectBetaSheet=l,this.rainbowColor=u,this.cpkColor=s,this.hideBoundMolecules=c,this.setTransparency=d,this.makeOpaque=p,this.scriptPosition=m,this.selectPositions=h,this.selectSideChains=f,this.enableBallAndStick=g,this.disableBallAndStick=v,this.highlightScript=P,this.center=b,this.defaultZoomIn=_,this.defaultZoomOut=T,this.defaultCenter=y,this.spin=C}function JmolWrapper(t){function n(t,n){u=jQuery.extend(!0,{},l,n),delete Jmol._tracker,o=Jmol.getApplet(t,u),r=$("#"+t+"_appletinfotablediv"),r.hide()}function e(t){null!=r&&(t.append(r),r.show())}function i(t,n){Jmol.script(o,t),_.isFunction(n)&&n()}function a(t){return t?{jarPath:"js/lib/jmol/",jarFile:"JmolAppletSigned.jar",disableJ2SLoadMonitor:!0,disableInitialConsole:!0}:{use:"HTML5",j2sPath:"js/lib/jsmol/j2s",disableJ2SLoadMonitor:!0,disableInitialConsole:!0}}var o=null,r=null,l=a(t),u=null;return{init:n,updateContainer:e,script:i}}function MergedAlignmentSegmentor(t){function n(){return o<a.mergedString.length}function e(){var t=a.mergedString,n={};n.start=o+a.uniprotFrom;var e=t[o],r=o;if(i(e))for(n.type=e;t[r]==e&&r<=t.length;)r++;else for(n.type="regular";!i(t[r])&&r<=t.length;)r++;return n.end=r+a.uniprotFrom,n.str=t.substring(o,r),o=r,n}function i(t){return t==PdbDataUtil.ALIGNMENT_GAP}var a=t,o=0;return{hasNextSegment:n,getNextSegment:e}}function MolScriptGenerator(){this.loadPdb=function(t){return""},this.selectAll=function(){return""},this.selectNone=function(){return""},this.setScheme=function(t){return""},this.setColor=function(t){return""},this.selectChain=function(t){return""},this.selectAlphaHelix=function(t){return""},this.selectBetaSheet=function(t){return""},this.rainbowColor=function(t){return""},this.cpkColor=function(t){return""},this.hideBoundMolecules=function(){return""},this.setTransparency=function(t){return""},this.makeOpaque=function(){return""},this.scriptPosition=function(t){return""},this.selectPositions=function(t,n){return""},this.selectSideChains=function(t,n){return""},this.enableBallAndStick=function(){return""},this.disableBallAndStick=function(){return""},this.center=function(t,n){return""},this.zoom=function(t){return""},this.defaultZoomIn=function(){return""},this.defaultZoomOut=function(){return""},this.defaultCenter=function(){return""},this.spin=function(t){return""},this.highlightScript=function(t,n,e,i){return[]},this.generateVisualStyleScript=function(t,n,e){var i=this,a=[];a.push(i.selectAll()),a.push(i.setScheme(e.proteinScheme)),a.push(i.setColor(e.defaultColor)),a.push(i.selectChain(n.chainId)),a.push(i.setColor(e.chainColor)),a.push(i.selectChain(n.chainId)),"byAtomType"==e.colorProteins?a.push(i.cpkColor(n.chainId)):"bySecondaryStructure"==e.colorProteins?(a.push(i.selectAlphaHelix(n.chainId)),a.push(i.setColor(e.structureColors.alphaHelix)),a.push(i.selectBetaSheet(n.chainId)),a.push(i.setColor(e.structureColors.betaSheet))):"byChain"==e.colorProteins&&(a.push(i.selectChain(n.chainId)),a.push(i.rainbowColor(n.chainId)));for(var o in t)a.push(i.selectPositions(t[o],n.chainId)),"byMutationType"==e.colorMutations?a.push(i.setColor(o)):"uniform"==e.colorMutations&&a.push(i.setColor(e.mutationColor)),a=a.concat(i.generateSideChainScript(t[o],"all"==e.displaySideChain,e,n));return a.push(i.selectAll()),a.push(i.setTransparency(e.defaultTranslucency)),a.push(i.selectChain(n.chainId)),a.push(i.makeOpaque()),e.restrictProtein&&a.push(i.hideBoundMolecules()),a},this.generateSideChainScript=function(t,n,e,i){var a=this,o=[];return"spaceFilling"!=e.proteinScheme&&(o.push(a.selectSideChains(t,i.chainId)),n?o.push(a.enableBallAndStick()):o.push(a.disableBallAndStick())),o},this.generateHighlightScript=function(t,n,e,i){var a=this,o=[];if(!_.isEmpty(t)){var r=a.highlightScriptPositions(t);o=o.concat(a.highlightScript(r,n,e,i))}return o},this.highlightScriptPositions=function(t){var n=this,e=[];return _.each(t,function(t){e.push(n.scriptPosition(t))}),e}}function MutationInputParser(){function t(){return{proteinPosEnd:"",uniprotId:"",cancerType:"",tumorType:"",cancerStudyLink:"",codonChange:"",proteinPosStart:"",linkToPatientView:"",geneticProfileId:"",mutationCount:"",mutationType:"",referenceAllele:"",uniprotAcc:"",fisValue:"",functionalImpactScore:"",cancerStudy:"",normalRefCount:"",ncbiBuildNo:"",normalFreq:"",cancerStudyShort:"",msaLink:"",mutationStatus:"",cna:"",proteinChange:"",aminoAcidChange:"",endPos:"",refseqMrnaId:"",geneSymbol:"",tumorFreq:"",startPos:"",keyword:"",cosmic:"",validationStatus:"",mutationSid:"",normalAltCount:"",variantAllele:"",mutationId:"",caseId:"",xVarLink:"",pdbLink:"",tumorAltCount:"",tumorRefCount:"",sequencingCenter:"",chr:""}}function n(t){var n=[],i=t.split("\n");if(i.length>0)for(var o=a(i[0]),r=1;r<i.length;r++)i[r].length>0&&n.push(e(i[r],o));return u=n,n}function e(n,e){var a=t(),o=n.split("	");return _.each(_.keys(a),function(t){a[t]=i(t,o,e)}),a.mutationId=a.mutationId||l(),a.mutationSid=a.mutationSid||a.mutationId,a}function i(t,n,e){var i=p[t],a=e[i],o="";return null!=a&&(o=n[a]||""),o}function a(t){var n=t.split("	"),e={};return _.each(n,function(t,n){e[t.toLowerCase()]=n}),e}function o(){if(null==u)return[];if(null==c){var t={};_.each(u,function(n,e){null!=n.caseId&&n.caseId.length>0&&(t[n.caseId]=n.caseId)}),c=_.values(t)}return c}function r(){if(null==u)return[];if(null==s){var t={};_.each(u,function(n,e){null!=n.geneSymbol&&n.geneSymbol.length>0&&(t[n.geneSymbol.toUpperCase()]=n.geneSymbol.toUpperCase())}),s=_.values(t)}return s}function l(){return d++,"stalone_mut_"+d}var u=null,s=null,c=null,d=0,p={proteinPosEnd:"protein_position_end",uniprotId:"uniprot_id",cancerType:"cancer_type",tumorType:"tumor_type",cancerStudyLink:"cancer_study_link",codonChange:"codon_change",proteinPosStart:"protein_position_start",linkToPatientView:"patient_view_link",geneticProfileId:"genetic_profile_id",mutationCount:"mutation_count",mutationType:"mutation_type",referenceAllele:"reference_allele",uniprotAcc:"uniprot_accession",fisValue:"fis_value",functionalImpactScore:"fis",cancerStudy:"cancer_study",normalRefCount:"normal_ref_count",ncbiBuildNo:"ncbi_build",normalFreq:"normal_frequency",cancerStudyShort:"cancer_study_short",msaLink:"msa_link",mutationStatus:"mutation_status",cna:"copy_number",proteinChange:"protein_change",aminoAcidChange:"amino_acid_change",endPos:"end_position",geneSymbol:"hugo_symbol",tumorFreq:"tumor_frequency",startPos:"start_position",keyword:"keyword",cosmic:"cosmic",validationStatus:"validation_status",mutationSid:"mutation_sid",normalAltCount:"normal_alt_count",variantAllele:"variant_allele",mutationId:"mutation_id",caseId:"sample_id",xVarLink:"xvar_link",pdbLink:"pdb_link",tumorAltCount:"tumor_alt_count",tumorRefCount:"tumor_ref_count",sequencingCenter:"center",chr:"chromosome"};return{parseInput:n,getSampleArray:o,getGeneList:r}}function PymolScriptGenerator(){function t(){return"reinitialize;"}function n(t){return"bg_color "+v(t)+";"}function e(t){return"fetch "+t+", async=0;"}function i(t){return b[t]}function a(t){return"color "+v(t)+", sele;"}function o(t){return"select chain "+t+";"}function r(t){return"select (chain "+t+") and (ss h);"}function l(t){return"select (chain "+t+") and (ss s);"}function u(t,n){return"select (resi "+t.join(",")+") and (chain "+n+");"}function s(t,n){return"select ((resi "+t.join(",")+") and (chain "+n+") and (not name c+n+o));"}function c(t){return"set transparency, "+t/10+", sele;\nset cartoon_transparency, "+t/10+", sele;\nset sphere_transparency, "+t/10+", sele;\nset stick_transparency, "+t/10+", sele;"}function d(){return c(0)}function p(){return"show spheres, sele; show sticks, sele; alter sele, vdw=0.50;"}function m(){return"hide spheres, sele; hide sticks, sele;"}function h(t){return"spectrum count, rainbow_rev, sele"}function f(t){return"util.cbaw sele;"}function g(){return"hide everything,not resn asp+glu+arg+lys+his+asn+thr+cys+gln+tyr+ser+gly+ala+leu+val+ile+met+trp+phe+pro"}function v(t){return t.replace("#","0x")}var b={ballAndStick:"hide everything; show spheres; show sticks; alter all, vdw=0.50",spaceFilling:"hide everything; show spheres;",ribbon:"hide everything; show ribbon;",cartoon:"hide everything; show cartoon;",trace:"hide everything; show ribbon;"};this.loadPdb=e,this.setScheme=i,this.setColor=a,this.selectChain=o,this.selectAlphaHelix=r,this.selectBetaSheet=l,this.rainbowColor=h,this.cpkColor=f,this.hideBoundMolecules=g,this.setTransparency=c,this.makeOpaque=d,this.selectPositions=u,this.selectSideChains=s,this.enableBallAndStick=p,this.disableBallAndStick=m,this.reinitialize=t,this.bgColor=n}function AbstractDataProxy(t){var n=this;n._defaultOpts={initMode:"lazy",servletName:"",data:{}},n._options=jQuery.extend(!0,{},n._defaultOpts,t),n.init=function(){n.isFullInit()?n.fullInit(n._options):n.lazyInit(n._options)},n.lazyInit=function(t){},n.fullInit=function(t){},n.isFullInit=function(){return!("lazy"===n._options.initMode.toLowerCase())}}function MutationAlignerDataProxy(t){function n(t){r=t.data}function e(t,n){var e=t.pfamAccession;if(null==e)return void n(null);if(void 0==r[e]){if(i.isFullInit())return void n(null);var a=function(t){r[e]=t,n(t)};$.getJSON(o.servletName,t,a)}else n(r[e])}var i=this,a={servletName:"getMutationAligner.json"},o=jQuery.extend(!0,{},a,t);AbstractDataProxy.call(this,o),o=i._options;var r={};i.fullInit=n,i.getMutationAlignerData=e}function MutationDataProxy(t){function n(t){var n=t.data,e=new MutationCollection(n);d.processMutationData(e)}function e(){return m}function i(){return p}function a(){return c.geneList}function o(){return d}function r(t,n){var e=t.trim().split(/\s+/),i=[],a=[],o=d.getMutationGeneMap();if(_.each(e,function(t,n){t=t.toUpperCase();var e=o[t];void 0==e||0==e.length?i.push(t):a=a.concat(e)}),u.isFullInit())n(a);else{var r=function(t){var e=new MutationCollection(t);d.processMutationData(e),a=a.concat(t),n(a)};if(i.length>0){var l=c.params;l.geneList=i.join(" "),$.ajax({type:"POST",url:c.servletName,data:l,success:r,error:function(){console.log("[MutationDataProxy.getMutationData] error retrieving mutation data for genetic profiles: "+l.geneticProfiles),r([])},dataType:"json"})}else n(a)}}function l(){return!0}var u=this,s={servletName:"getMutationData.json",geneList:"",params:{}},c=jQuery.extend(!0,{},s,t);AbstractDataProxy.call(this,c),c=u._options;var d=new MutationDetailsUtil,p=c.geneList.trim().split(/\s+/),m=c.geneList.trim().split(/\s+/).sort();u.fullInit=n,u.getMutationData=r,u.getGeneList=e,u.getRawGeneList=a,u.getUnsortedGeneList=i,u.getMutationUtil=o,u.hasData=l}function PancanMutationDataProxy(t){function n(t){var n=t.data;c=n.byKeyword,d=n.byProteinChange,m=n.byGeneSymbol,p=n.byProteinPosition}function e(t,n,e){var a=t.cmd,o=t.q;if(null==a)e(null);else if("byKeywords"==a){var r=null==o?n.getAllKeywords():o.split(",");i(a,r,c,["keyword"],e)}else if("byHugos"==a){var l=null==o?n.getAllGenes():o.split(",");i(a,l,m,["hugo"],e)}else if("byProteinChanges"==a){var u=null==o?n.getAllProteinChanges():o.split(",");i(a,u,d,["protein_change"],e)}else if("byProteinPos"==a){var s=null==o?n.getAllProteinPosStarts():o.split(",");i(a,s,p,["hugo","protein_pos_start"],e)}else e(null)}function i(t,n,e,i,u){var c=o(n,e),d=r(c);d.length>0&&!l.isFullInit()?$.getJSON(s.servletName,{cmd:t,q:d.join(",")},function(t){a(t,c,e,i,u)}):a([],c,e,i,u)}function a(t,n,e,i,a){_.each(t,function(t,a){var o=[];_.each(i,function(n,e){o.push(t[n])});var r=o.join("_");null==e[r]&&(e[r]=[]),null==n[r]&&(n[r]=[]),e[r].push(t),n[r].push(t)});var o=[];_.each(n,function(t){o=o.concat(t)}),a(o)}function o(t,n){var e={};return _.each(t,function(t){e[t]=n[t]}),e}function r(t){var n=[];return _.each(_.keys(t),function(e){null==t[e]&&n.push(e)}),n}var l=this,u={servletName:"pancancerMutations.json"},s=jQuery.extend(!0,{},u,t);AbstractDataProxy.call(this,s),s=l._options;var c={},d={},p={},m={};l.fullInit=n,l.getPancanData=e}function PdbDataProxy(t){function n(t){var n=t.data;_.each(_.keys(n.pdbData),function(t){var e=PdbDataUtil.processPdbData(n.pdbData[t]);m[t]=e,h[t]=PdbDataUtil.allocateChainRows(e)}),f=n.infoData,g=n.summaryData,v=n.positionData}function e(t,n,e){var a=n.alignments,o=i(t,n);if(s.isFullInit()||null!=v[o])return void e(v[o]||{});var r=p.getProteinPositions(t),l={};_.each(r,function(t,e){t.start>-1&&t.start>=n.mergedAlignment.uniprotFrom&&t.start<=n.mergedAlignment.uniprotTo&&(l[t.start]=t.start),t.end>t.start&&t.end>=n.mergedAlignment.uniprotFrom&&t.end<=n.mergedAlignment.uniprotTo&&(l[t.end]=t.end)});var u=[];for(var c in l)u.push(l[c]);var m=[];a.each(function(t,n){m.push(t.alignmentId)});var h=function(n){var i={},a=p.getMutationGeneMap()[t];if(null!=n.positionMap)for(var r=0;r<a.length;r++){var l=n.positionMap[a[r].getProteinStartPos()],u=l,s=a[r].mutationType;null!=s&&"in_frame_del"===s.toLowerCase()&&(u=n.positionMap[a[r].proteinPosEnd]||u),null!=l&&null!=u&&(i[a[r].mutationId]={start:l,end:u})}o&&(v[o]=i),e(i)};u.length>0?$.getJSON(d.servletName,{positions:u.join(" "),alignments:m.join(" ")},h):e({})}function i(t,n){var e=null;return n.alignments.length>0&&(e=t+"_"+n.alignments.at(0).pdbId+"_"+n.chainId),e}function a(t,n){if(s.isFullInit())return void n(m[t]);if(void 0==m[t]){var e=function(e){var i=PdbDataUtil.processPdbData(e);m[t]=i,n(i)};$.getJSON(d.servletName,{uniprotId:t},e)}else n(m[t])}function o(t,n){s.isFullInit()||void 0!=h[t]?n(h[t]):a(t,function(e){var i=PdbDataUtil.allocateChainRows(e);h[t]=i,n(i)})}function r(t,n){if(s.isFullInit()||void 0!=g[t])n(g[t]);else{var e=function(e){g[t]=e,n(e)};$.getJSON(d.servletName,{uniprotId:t,type:"summary"},e)}}function l(t,n){var e=function(t){var e=t&&t.alignmentCount>0;n(e)};r(t,e)}function u(t,n){var e=t.trim().split(/\s+/),i=[],a={};if(_.each(e,function(t,n){var e=f[t];void 0==e||0==e.length?i.push(t):a[t]=e}),s.isFullInit())return void n(a);var o={};if(i.length>0){var r=function(t){_.each(e,function(n,e){null!=t[n]&&(f[n]=t[n],a[n]=t[n])}),n(a)};o.pdbIds=i.join(" "),$.post(d.servletName,o,r,"json")}else n(a)}var s=this,c={servletName:"get3dPdb.json",mutationUtil:{}},d=jQuery.extend(!0,{},c,t);AbstractDataProxy.call(this,d),d=s._options;var p=d.mutationUtil,m={},h={},f={},g={},v={};s.fullInit=n,s.hasPdbData=l,s.getPdbData=a,s.getPdbRowData=o,s.getPdbInfo=u,s.getPositionMap=e}function PfamDataProxy(t){function n(t){r=t.data}function e(t,n){var e=t.geneSymbol;if(null==e)return void n(null);if(void 0==r[e]){if(i.isFullInit())return void n(null);var a=function(t){r[e]=t,n(t)};$.getJSON(o.servletName,t,a)}else n(r[e])}var i=this,a={servletName:"getPfamSequence.json"},o=jQuery.extend(!0,{},a,t);AbstractDataProxy.call(this,o),o=i._options;var r={};i.fullInit=n,i.getPfamData=e}function PortalDataProxy(t){function n(t){r=t.data}function e(t,n){var e={},i={};_.each(_.keys(t),function(n,a){null==r[n]?i[n]=t[n]:e[n]=r[n]});var a=function(t){_.each(_.keys(t),function(n,e){r[n]=t[n]}),_.isFunction(n)&&n(jQuery.extend(!0,{},e,t))};_.isEmpty(i)?a(e):$.getJSON(o.servletName,i,a)}var i=this,a={servletName:"portalMetadata.json"},o=jQuery.extend(!0,{},a,t);AbstractDataProxy.call(this,o),o=i._options;var r={};i.fullInit=n,i.getPortalData=e}function AdvancedDataTable(t){var n=this,e=null;n._defaultOpts={el:"",columns:{},columnOrder:[],columnVisibility:{},columnSearch:{},columnRender:{},columnSort:{},columnFilter:{},columnData:{},additionalData:{},columnTooltips:{},eventListeners:{},customSort:{},filteringDelay:0,dataTableOpts:{}},n._options=jQuery.extend(!0,{},n._defaultOpts,t),n._dispatcher={},_.extend(n._dispatcher,Backbone.Events),n._dataTable=null,n._visibilityValue=function(t){return"hidden"},n._searchValue=function(t){return!1},n.renderTable=function(t){var i=n._options.columnOrder,a=e=DataTableUtil.buildColumnIndexMap(i),o=DataTableUtil.buildColumnNameMap(n._options.columns),r=DataTableUtil.buildColumnVisMap(i,n._visibilityValue);n._visiblityMap=r;var l=DataTableUtil.buildColumnSearchMap(i,n._searchValue),u=DataTableUtil.getHiddenColumns(i,a,r),s=DataTableUtil.getExcludedColumns(i,a,r),c=DataTableUtil.getNonSearchableColumns(i,a,l);n._addSortFunctions(),n._dataTable=n._initDataTable($(n._options.el),t,n._options.columns,o,a,u,s,c),n._addEventListeners(a),n._options.filteringDelay>0&&n._dataTable.fnSetFilteringDelay(n._options.filteringDelay)},n._initDataTableOpts=function(t,n,e,i,a,o,r,l){return null},n._initDataTable=function(t,e,i,a,o,r,l,u){var s=n._initDataTableOpts(t,e,i,a,o,r,l,u),c=DataTableUtil.getColumnData(o,n._options.columnRender,n._options.columnSort,n._options.columnFilter,n._options.columnData);return s.aoColumnDefs=s.aoColumnDefs.concat(c),s=jQuery.extend(!0,{},n._options.dataTableOpts,s),t.dataTable(s)},n._addSortFunctions=function(){_.each(_.pairs(n._options.customSort),function(t){var n=t[0],e=t[1];jQuery.fn.dataTableExt.oSort[n]=e})},n._addEventListeners=function(t){null!=n.getDataTable()&&_.each(n._options.eventListeners,function(e){e(n.getDataTable(),n._dispatcher,t)})},n._addColumnTooltips=function(t){t=t||{};var e=$(n._options.el);_.each(_.keys(n._options.columnTooltips),function(i){if("excluded"!=n._visiblityMap[i]){var a=n._options.columnTooltips[i];_.isFunction(a)&&a(e,t)}})},n._loadAdditionalData=function(t){t=t||{};$(n._options.el);_.each(_.keys(n._options.additionalData),function(e){if("excluded"!=n._visiblityMap[e]){var i=n._options.additionalData[e];_.isFunction(i)&&i(t)}})},n.getColumnOptions=function(){return n._options.columns},n.getDataTable=function(){return n._dataTable},n.getIndexMap=function(){return e}}function Mutation3dVis(t,n){function e(){E=new JSmolWrapper,E.init(t,H.appOptions,H.frame)}function i(t){k=$(t);var n=k.find(".mutation-3d-vis-container");n.css("width",H.appOptions.width),n.css("height",H.appOptions.height+H.containerPadding),E.updateContainer(n)}function a(){R="ON"==R?"OFF":"ON";var t=j.spin(R);E.script(t)}function o(){var t=j.generateVisualStyleScript(B,q,H);t=t.concat(w(O)),t=t.join(" "),E.script(t)}function r(){if(null!=k){k.show();var t=parseInt(k.css("top"));0>t&&(null!=U&&U>0?k.css("top",U):k.css("top",0))}}function l(){if(null!=k){var t=parseInt(k.css("top"));t>0&&(U=t),k.css("top",-9999)}}function u(){null!=k&&(k.css({overflow:"hidden",height:H.minimizedHeight}),V=!0)}function s(){null!=k&&(k.css({overflow:"",height:""}),V=!1)}function c(){null!=k&&(V?s():u())}function d(){var t=parseInt(k.css("top")),n=-9999==t||k.is(":hidden");return!n}function p(t,n,e){var i=[];if(O={},!t||!n)return i;q=n,N=t,i=h(t,n);var a=[];return a.push(j.loadPdb(t)),a=a.concat(j.generateVisualStyleScript(B,q,H)),a=a.join(" "),E.script(a,e),i}function m(){var t=[];if(O={},null==N||null==q)return t;t=h(N,q);var n=[];return n=n.concat(j.generateVisualStyleScript(B,q,H)),n=n.join(" "),E.script(n),t}function h(t,n){var e=f(t,n,H,j);return B=e.colorMap,e.mappedMutations}function f(t,n,e,i){var a=[],o={},r=e.mutationColor;for(var l in n.positionMap){var u=n.positionMap[l];if(_.isFunction(e.mutationColorMapper)&&(r=e.mutationColorMapper(l,t,n)),null!=r){null==o[r]&&(o[r]={});var s=i.scriptPosition(u);o[r][s]=s,a.push(l)}}return _.each(o,function(t,n,e){e[n]=_.values(t)}),{colorMap:o,mappedMutations:a}}function g(){if(1!=_.size(O))return!1;var t=[];return _.each(O,function(n){t=t.concat(S(n))}),t=t.join(" "),E.script(t),!0}function v(){var t=[];t.push(j.defaultCenter()),t=t.join(" "),E.script(t)}function b(t){if(null==q)return!1;var n=t.mutations[0].mutationId,e=D(n);return e.length>0?(e=e.join(" "),E.script(e),!0):(y(),!1)}function y(){var t=[];t.push(j.zoom(H.defaultZoom)),t.push(j.defaultCenter()),t=t.join(" "),E.script(t)}function T(t,n){if(null==q)return 0;n&&(O={});var e=j.generateVisualStyleScript(B,q,H),i=0;return _.each(t,function(t,n){var e=t.mutations[0].mutationId,a=q.positionMap[e];null!=a&&(O[e]=a,i++)}),e=e.concat(w(O)),e=e.join(" "),E.script(e),i}function C(){var t=w(O);t=t.join(" "),E.script(t)}function P(){O={};var t=j.generateVisualStyleScript(B,q,H);t=t.join(" "),E.script(t)}function w(t){return j.generateHighlightScript(t,H.highlightColor,H,q)}function S(t){var n=[];return n.push(j.center(t,q.chainId)),n}function D(t){var n=[],e=q.positionMap[t];return null!=e&&(n.push(j.zoom(H.focusZoom)),n.push(j.center(e,q.chainId))),n}function x(){E.script(j.defaultZoomIn())}function M(){E.script(j.defaultZoomOut())}function A(){E.script(j.zoom(H.defaultZoom))}function I(t){E.script(j.zoom(t))}function F(t){H=jQuery.extend(!0,{},H,t)}function L(){var t=new PymolScriptGenerator,n=[];return n.push(t.reinitialize()),n.push(t.bgColor(H.appOptions.color)),n.push(t.loadPdb(N)),n=n.concat(t.generateVisualStyleScript(B,q,H)),n=n.concat(t.generateHighlightScript(O,H.highlightColor,H,q)),n.push(t.selectNone()),n=n.join("\n")}var k=null,E=null,V=!1,B=null,O={},q=null,N=null,R="OFF",U=null,z={appOptions:{width:400,height:300,debug:!1,color:"white"},frame:"jsmol_frame.html",proteinScheme:"cartoon",restrictProtein:!1,defaultColor:"#DDDDDD",structureColors:{alphaHelix:"#FFA500",betaSheet:"#0000FF",loop:"#DDDDDD"},defaultTranslucency:5,chainColor:"#888888",chainTranslucency:0,colorProteins:"uniform",colorMutations:"byMutationType",mutationColor:"#8A2BE2",highlightColor:"#FFDD00",highlightGradient:["#FFDD00","#000000"],addGlowEffect:!1,displaySideChain:"highlighted",defaultZoom:100,focusZoom:250,containerPadding:10,minimizedHeight:10,mutationColorMapper:function(t,n,e){return"#FF0000"}},H=jQuery.extend(!0,{},z,n),j=new JmolScriptGenerator;return{init:e,show:r,hide:l,minimize:u,maximize:s,toggleSize:c,isVisible:d,reload:p,refresh:m,focusOn:b,center:g,resetCenter:v,highlight:T,resetHighlight:P,refreshHighlight:C,zoomIn:x,zoomOut:M,zoomActual:A,zoomTo:I,resetFocus:y,updateContainer:i,toggleSpin:a,reapplyStyle:o,updateOptions:F,generatePymolScript:L}}function MutationDetailsTable(t,n,e,i){function a(t,a,r,l,u,s,c,d){var p=DataTableUtil.getColumnOptions(r,u),h={aaData:a,aoColumns:p,aoColumnDefs:[{bVisible:!1,aTargets:s},{bSearchable:!1,aTargets:d}],oColVis:{aiExclude:c},oTableTools:{aButtons:[{sExtends:"text",sButtonText:"Download",mColumns:o(r,c),fnCellRender:function(t,n,e,i){var a=t;return-1!=t.indexOf("<")&&-1!=t.indexOf(">")&&(a=$(t).text()),n===u.proteinChange&&(a=a.replace(/(\s)3D/,"")),a.trim()},fnClick:function(t,e){var i=this.fnGetTableData(e),a={filename:"mutation_table_"+n+".tsv",contentType:"text/plain;charset=utf-8",preProcess:!1};cbio.download.initDownload(i,a)}}]},fnDrawCallback:function(a){m._addColumnTooltips({gene:n,mutationUtil:e,dataProxies:i,additionalData:T}),m._addEventListeners(u);var o=a.oPreviousSearch.sSearch;v&&b!=o&&(g.trigger(MutationDetailsEvents.MUTATION_TABLE_FILTERED,t),y=o),b=o},fnRowCallback:function(t,n,e,i){var a=n[u.datum].mutation;$(t).attr("id",a.mutationId),$(t).addClass(a.mutationSid),$(t).addClass("mutation-table-data-row")},fnCreatedRow:function(t,n,e){$(t).find('a[href=""]').remove(),$(t).find('span.mutation-table-additional-protein-change[alt=""]').remove()},fnInitComplete:function(t,n){m._loadAdditionalData({dataProxies:i,indexMap:m.getIndexMap(),additionalData:T,dataTable:this})},fnHeaderCallback:function(t,n,e,i,a){$(t).find("th").addClass("mutation-details-table-header"),m._addHeaderTooltips(t,l)}};return h}function o(t,n){for(var e=[],i=0;i<=_.keys(t).length;i++)e.push(i);return _.difference(e,n)}function r(t){var i=f.columnVisibility[t],a=i;return i?_.isFunction(i)&&(a=i(e,n)):a="hidden",a}function l(t){var n=f.columnSearch[t],e=n;return null==n?e=!1:_.isFunction(n)&&(e=n()),e}function u(t){null!=m.getDataTable()&&_.each(f.eventListeners,function(t){t(m.getDataTable(),g,e,n)})}function s(t){v=t}function c(){b="",y=""}function d(){return y}function p(t,n){var e=MutationViewsUtil.defaultTableTooltipOpts(),i={};jQuery.extend(!0,i,e),i.position={my:"bottom center",at:"top center",viewport:$(window)},$(t).find("th").each(function(){var t=$(this).text(),e=n[t];if(null!=e){var a=f.columns[e].tip;i.content={text:a},$(this).qtip(i)}})}var m=this,h={el:"#mutation_details_table_d3",columns:{datum:{sTitle:"datum",tip:""},mutationId:{sTitle:"Mutation ID",tip:"Mutation ID",sType:"string"},mutationSid:{sTitle:"Mutation SID",tip:"",sType:"string"},caseId:{sTitle:"Sample ID",tip:"Sample ID",sType:"string"},cancerStudy:{sTitle:"Cancer Study",tip:"Cancer Study",sType:"string"},tumorType:{sTitle:"Cancer Type",tip:"Cancer Type",sType:"string"},proteinChange:{sTitle:"AA change",tip:"Protein Change",sType:"numeric"},mutationType:{sTitle:"Type",tip:"Mutation Type",sType:"string",sClass:"center-align-td"},cna:{sTitle:"Copy #",tip:"Copy-number status of the mutated gene",sType:"numeric",sClass:"center-align-td"},cosmic:{sTitle:"COSMIC",tip:"Overlapping mutations in COSMIC",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]},mutationStatus:{sTitle:"MS",tip:"Mutation Status",sType:"string",sClass:"center-align-td"},validationStatus:{sTitle:"VS",tip:"Validation Status",sType:"string",sClass:"center-align-td"},mutationAssessor:{sTitle:"Mutation Assessor",tip:"Predicted Functional Impact Score (via Mutation Assessor) for missense mutations",sType:"numeric",sClass:"center-align-td",asSorting:["desc","asc"],sWidth:"2%"},sequencingCenter:{sTitle:"Center",tip:"Sequencing Center",sType:"string",sClass:"center-align-td"},chr:{sTitle:"Chr",tip:"Chromosome",sType:"string"},startPos:{sTitle:"Start Pos",tip:"Start Position",sType:"numeric",sClass:"right-align-td"},endPos:{sTitle:"End Pos",tip:"End Position",sType:"numeric",sClass:"right-align-td"},referenceAllele:{sTitle:"Ref",tip:"Reference Allele",sType:"string"},variantAllele:{sTitle:"Var",tip:"Variant Allele",sType:"string"},tumorFreq:{sTitle:"Allele Freq (T)",tip:"Variant allele frequency<br> in the tumor sample",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]},normalFreq:{sTitle:"Allele Freq (N)",tip:"Variant allele frequency<br> in the normal sample",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]},tumorRefCount:{sTitle:"Var Ref",tip:"Variant Ref Count",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]},tumorAltCount:{sTitle:"Var Alt",tip:"Variant Alt Count",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]},normalRefCount:{sTitle:"Norm Ref",tip:"Normal Ref Count",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]},normalAltCount:{sTitle:"Norm Alt",tip:"Normal Alt Count",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]},igvLink:{sTitle:"BAM",tip:"Link to BAM file",sType:"string",sClass:"center-align-td"},mutationCount:{sTitle:"#Mut in Sample",tip:"Total number of<br> nonsynonymous mutations<br> in the sample",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"],sWidth:"2%"},cBioPortal:{sTitle:"cBioPortal",tip:"Mutation frequency in cBioPortal",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]}},columnOrder:["datum","mutationId","mutationSid","caseId","cancerStudy","tumorType","proteinChange","mutationType","cna","cBioPortal","cosmic","mutationStatus","validationStatus","mutationAssessor","sequencingCenter","chr","startPos","endPos","referenceAllele","variantAllele","tumorFreq","normalFreq","tumorRefCount","tumorAltCount","normalRefCount","normalAltCount","igvLink","mutationCount"],columnVisibility:{datum:"excluded",proteinChange:"visible",caseId:function(t,n){return t.containsCaseId(n)?"visible":"hidden"},mutationType:function(t,n){return t.containsMutationType(n)?"visible":"hidden"},mutationAssessor:function(t,n){return t.containsFis(n)?"visible":"hidden"},cosmic:"visible",mutationCount:function(t,n){return t.containsMutationCount(n)?"visible":"hidden"},mutationId:"excluded",mutationSid:"excluded",cancerStudy:"excluded",cna:function(t,n){return t.containsCnaData(n)?"visible":"hidden"},tumorFreq:function(t,n){return t.containsAlleleFreqT(n)?"visible":"hidden"},igvLink:function(t,n){return t.containsIgvLink(n)?"visible":"excluded"},mutationStatus:function(t,n){return t.containsGermline(n)?"visible":"hidden"},validationStatus:function(t,n){return t.containsValidStatus(n)?"visible":"hidden"},tumorType:function(t,n){var e=t.distinctTumorTypeCount(n);return e>1?"visible":e>0?"hidden":"excluded"},cBioPortal:"excluded"},columnSearch:{caseId:!0,mutationId:!0,mutationSid:!0,cancerStudy:!0,proteinChange:!0,tumorType:!0,mutationType:!0},columnRender:{mutationId:function(t){var n=t.mutation;return n.mutationId},mutationSid:function(t){var n=t.mutation;return n.mutationSid},caseId:function(t){var n=t.mutation,e=MutationDetailsTableFormatter.getCaseId(n.caseId),i={};i.linkToPatientView=n.linkToPatientView,i.caseId=e.text,i.caseIdClass=e.style,i.caseIdTip=e.tip;var a=BackboneTemplateCache.getTemplateFn("mutation_table_case_id_template");return a(i)},proteinChange:function(t){var n=t.mutation,e=MutationDetailsTableFormatter.getProteinChange(n),i={};i.proteinChange=e.text,i.proteinChangeClass=e.style,i.proteinChangeTip=e.tip,i.additionalProteinChangeTip=e.additionalTip,
i.pdbMatchLink=MutationDetailsTableFormatter.getPdbMatchLink(n);var a=BackboneTemplateCache.getTemplateFn("mutation_table_protein_change_template");return a(i)},cancerStudy:function(t){var n=t.mutation,e={};e.cancerStudy=n.cancerStudy,e.cancerStudyShort=n.cancerStudyShort,e.cancerStudyLink=n.cancerStudyLink;var i=BackboneTemplateCache.getTemplateFn("mutation_table_cancer_study_template");return i(e)},tumorType:function(t){var n=t.mutation,e=MutationDetailsTableFormatter.getTumorType(n),i={};i.tumorType=e.text,i.tumorTypeClass=e.style,i.tumorTypeTip=e.tip;var a=BackboneTemplateCache.getTemplateFn("mutation_table_tumor_type_template");return a(i)},mutationType:function(t){var n=t.mutation,e=MutationDetailsTableFormatter.getMutationType(n.mutationType),i={};i.mutationTypeClass=e.style,i.mutationTypeText=e.text;var a=BackboneTemplateCache.getTemplateFn("mutation_table_mutation_type_template");return a(i)},cosmic:function(t){var n=t.mutation,e=MutationDetailsTableFormatter.getCosmic(n.cosmicCount),i={};i.cosmicClass=e.style,i.cosmicCount=e.count;var a=BackboneTemplateCache.getTemplateFn("mutation_table_cosmic_template");return a(i)},cna:function(t){var n=t.mutation,e=MutationDetailsTableFormatter.getCNA(n.cna),i={};i.cna=e.text,i.cnaClass=e.style,i.cnaTip=e.tip;var a=BackboneTemplateCache.getTemplateFn("mutation_table_cna_template");return a(i)},mutationCount:function(t){var n=t.mutation,e=MutationDetailsTableFormatter.getIntValue(n.mutationCount),i={};i.mutationCount=e.text,i.mutationCountClass=e.style;var a=BackboneTemplateCache.getTemplateFn("mutation_table_mutation_count_template");return a(i)},normalFreq:function(t){var n=t.mutation,e=MutationDetailsTableFormatter.getAlleleCount(n.normalAltCount),i=MutationDetailsTableFormatter.getAlleleFreq(n.normalFreq,n.normalAltCount,n.normalRefCount,"simple-tip"),a={};a.normalFreq=i.text,a.normalFreqClass=i.style,a.normalFreqTipClass=i.tipClass,a.normalTotalCount=i.total,a.normalAltCount=e.text;var o=BackboneTemplateCache.getTemplateFn("mutation_table_normal_freq_template");return o(a)},tumorFreq:function(t){var n=t.mutation,e=MutationDetailsTableFormatter.getAlleleCount(n.tumorAltCount),i=MutationDetailsTableFormatter.getAlleleFreq(n.tumorFreq,n.tumorAltCount,n.tumorRefCount,"simple-tip"),a={};a.tumorFreq=i.text,a.tumorFreqClass=i.style,a.tumorFreqTipClass=i.tipClass,a.tumorTotalCount=i.total,a.tumorAltCount=e.text;var o=BackboneTemplateCache.getTemplateFn("mutation_table_tumor_freq_template");return o(a)},mutationAssessor:function(t){var n=t.mutation,e=MutationDetailsTableFormatter.getFis(n.functionalImpactScore,n.fisValue),i={};i.fisClass=e.fisClass,i.omaClass=e.omaClass,i.fisText=e.text;var a=BackboneTemplateCache.getTemplateFn("mutation_table_mutation_assessor_template");return a(i)},mutationStatus:function(t){var n=t.mutation,e=MutationDetailsTableFormatter.getMutationStatus(n.mutationStatus),i={};i.mutationStatusTip=e.tip,i.mutationStatusClass=e.style,i.mutationStatusText=e.text;var a=BackboneTemplateCache.getTemplateFn("mutation_table_mutation_status_template");return a(i)},validationStatus:function(t){var n=t.mutation,e=MutationDetailsTableFormatter.getValidationStatus(n.validationStatus),i={};i.validationStatusTip=e.tip,i.validationStatusClass=e.style,i.validationStatusText=e.text;var a=BackboneTemplateCache.getTemplateFn("mutation_table_validation_status_template");return a(i)},normalRefCount:function(t){var n=t.mutation,e=MutationDetailsTableFormatter.getAlleleCount(n.normalRefCount),i={};i.normalRefCount=e.text,i.normalRefCountClass=e.style;var a=BackboneTemplateCache.getTemplateFn("mutation_table_normal_ref_count_template");return a(i)},normalAltCount:function(t){var n=t.mutation,e=MutationDetailsTableFormatter.getAlleleCount(n.normalAltCount),i={};i.normalAltCount=e.text,i.normalAltCountClass=e.style;var a=BackboneTemplateCache.getTemplateFn("mutation_table_normal_alt_count_template");return a(i)},tumorRefCount:function(t){var n=t.mutation,e=MutationDetailsTableFormatter.getAlleleCount(n.tumorRefCount),i={};i.tumorRefCount=e.text,i.tumorRefCountClass=e.style;var a=BackboneTemplateCache.getTemplateFn("mutation_table_tumor_ref_count_template");return a(i)},tumorAltCount:function(t){var n=t.mutation,e=MutationDetailsTableFormatter.getAlleleCount(n.tumorAltCount),i={};i.tumorAltCount=e.text,i.tumorAltCountClass=e.style;var a=BackboneTemplateCache.getTemplateFn("mutation_table_tumor_alt_count_template");return a(i)},startPos:function(t){var n=t.mutation,e=MutationDetailsTableFormatter.getIntValue(n.startPos),i={};i.startPos=e.text,i.startPosClass=e.style;var a=BackboneTemplateCache.getTemplateFn("mutation_table_start_pos_template");return a(i)},endPos:function(t){var n=t.mutation,e=MutationDetailsTableFormatter.getIntValue(n.endPos),i={};i.endPos=e.text,i.endPosClass=e.style;var a=BackboneTemplateCache.getTemplateFn("mutation_table_end_pos_template");return a(i)},sequencingCenter:function(t){var n=t.mutation;return n.sequencingCenter},chr:function(t){var n=t.mutation;return n.chr},referenceAllele:function(t){var n=t.mutation;return n.referenceAllele},variantAllele:function(t){var n=t.mutation;return n.variantAllele},igvLink:function(t){var n=t.mutation,e={};e.igvLink=MutationDetailsTableFormatter.getIgvLink(n);var i=BackboneTemplateCache.getTemplateFn("mutation_table_igv_link_template");return i(e)},cBioPortal:function(t){t.mutation;if(null==t.cBioPortal){var n={loaderImage:"images/ajax-loader.gif",width:15,height:15},e=BackboneTemplateCache.getTemplateFn("mutation_table_placeholder_template");return e(n)}var i=MutationDetailsTableFormatter.getCbioPortal(t.cBioPortal),n={};n.portalFrequency=i.frequency,n.portalClass=i.style;var e=BackboneTemplateCache.getTemplateFn("mutation_table_cbio_portal_template");return e(n)}},columnTooltips:{simple:function(t,n){var e=MutationViewsUtil.defaultTableTooltipOpts();$(t).find(".simple-tip").qtip(e)},cosmic:function(t,n){var e=n.gene,i=n.mutationUtil,a=MutationViewsUtil.defaultTableTooltipOpts();$(t).find(".mutation_table_cosmic").each(function(){var t=this,n=$(t).closest("tr.mutation-table-data-row").attr("id"),o=i.getMutationIdMap()[n],r={};jQuery.extend(!0,r,a),r.content={text:"NA"},r.events={render:function(n,i){var a={cosmic:o.cosmic,keyword:o.keyword,geneSymbol:e,total:$(t).text()},r=$(this).find(".qtip-content"),l=new CosmicTipView({el:r,model:a});l.render()}},$(t).qtip(r)})},mutationAssessor:function(t,n){var e=(n.gene,n.mutationUtil),i=MutationViewsUtil.defaultTableTooltipOpts();$(t).find(".oma_link").each(function(){var t=$(this).closest("tr.mutation-table-data-row").attr("id"),n=e.getMutationIdMap()[t],a=MutationDetailsTableFormatter.getFis(n.functionalImpactScore,n.fisValue),o={};jQuery.extend(!0,o,i),o.content={text:"NA"},o.events={render:function(t,e){var i={impact:a.value,xvia:n.xVarLink.replace("getma.org","mutationassessor.org"),msaLink:n.msaLink.replace("getma.org","mutationassessor.org"),pdbLink:n.pdbLink.replace("getma.org","mutationassessor.org")},o=$(this).find(".qtip-content"),r=new PredictedImpactTipView({el:o,model:i});r.render()}},$(this).qtip(o)})},cBioPortal:function(t,n){var e=n.gene,i=n.mutationUtil,a=n.dataProxies.portalProxy,o=n.additionalData,r=function(n,a,o){$(t).find(".mutation_table_cbio_portal").each(function(t,r){var l=$(this).closest("tr.mutation-table-data-row").attr("id"),u=i.getMutationIdMap()[l],s=o||u.cancerStudy;$(r).qtip({content:{text:"pancancer mutation bar chart is broken"},events:{render:function(t,i){var o={pancanMutationFreq:n,cancerStudyMetaData:a,cancerStudyName:s,geneSymbol:e,keyword:u.keyword,proteinPosStart:u.proteinPosStart,mutationType:u.mutationType,qtipApi:i},r=$(this),l=new PancanMutationHistTipView({el:r,model:o});l.render()}},hide:{fixed:!0,delay:100},style:{classes:"qtip-light qtip-rounded qtip-shadow",tip:!0},position:{my:"center right",at:"center left",viewport:$(window)}})})};null!=o.pancanFrequencies&&a.getPortalData({cancerStudyMetaData:!0,cancerStudyName:!0},function(t){r(o.pancanFrequencies,t.cancerStudyMetaData,t.cancerStudyName)})}},eventListeners:{windowResize:function(t,n,e,i){$(window).one("resize",function(){t.is(":visible")&&t.fnAdjustColumnSizing()})},igvLink:function(t,n,e,i){$(t).find(".igv-link").off("click").on("click",function(t){t.preventDefault();var n=$(this).closest("tr.mutation-table-data-row").attr("id"),i=e.getMutationIdMap()[n],a=i.igvLink;$.getJSON(a,function(t){prepIGVLaunch(t.bamFileUrl,t.encodedLocus,t.referenceGenome,t.trackName)})})},proteinChange3d:function(t,n,e,i){$(t).find(".mutation-table-3d-link").off("click").on("click",function(t){t.preventDefault();var e=$(this).closest("tr.mutation-table-data-row").attr("id");n.trigger(MutationDetailsEvents.PDB_LINK_CLICKED,e)})},proteinChange:function(t,n,e,i){$(t).find(".mutation-table-protein-change a").off("click").on("click",function(t){t.preventDefault();var e=$(this).closest("tr.mutation-table-data-row").attr("id");n.trigger(MutationDetailsEvents.PROTEIN_CHANGE_LINK_CLICKED,e)})}},columnSort:{mutationId:function(t){var n=t.mutation;return n.mutationId},mutationSid:function(t){var n=t.mutation;return n.mutationSid},caseId:function(t){var n=t.mutation;return n.caseId},proteinChange:function(t){var n=t.mutation.proteinChange,e=n.match(/.*[A-Z]([0-9]+)[^0-9]+/);return e&&e.length>1?parseInt(e[1]):-(1/0)},cancerStudy:function(t){var n=t.mutation;return n.cancerStudy},tumorType:function(t){var n=t.mutation;return n.tumorType},mutationType:function(t){var n=t.mutation;return n.mutationType},cosmic:function(t){var n=t.mutation;return MutationDetailsTableFormatter.assignIntValue(n.cosmicCount)},cna:function(t){var n=t.mutation;return MutationDetailsTableFormatter.assignIntValue(n.cna)},mutationCount:function(t){var n=t.mutation;return MutationDetailsTableFormatter.assignIntValue(n.mutationCount)},normalFreq:function(t){var n=t.mutation;return MutationDetailsTableFormatter.assignFloatValue(n.normalFreq)},tumorFreq:function(t){var n=t.mutation;return MutationDetailsTableFormatter.assignFloatValue(n.tumorFreq)},mutationAssessor:function(t){var n=t.mutation;return MutationDetailsTableFormatter.assignValueToPredictedImpact(n.functionalImpactScore,n.fisValue)},mutationStatus:function(t){var n=t.mutation;return n.mutationStatus},validationStatus:function(t){var n=t.mutation;return n.validationStatus},normalRefCount:function(t){var n=t.mutation;return MutationDetailsTableFormatter.assignIntValue(n.normalRefCount)},normalAltCount:function(t){var n=t.mutation;return MutationDetailsTableFormatter.assignIntValue(n.normalAltCount)},tumorRefCount:function(t){var n=t.mutation;return MutationDetailsTableFormatter.assignIntValue(n.tumorRefCount)},tumorAltCount:function(t){var n=t.mutation;return MutationDetailsTableFormatter.assignIntValue(n.tumorAltCount)},startPos:function(t){var n=t.mutation;return MutationDetailsTableFormatter.assignIntValue(n.startPos)},endPos:function(t){var n=t.mutation;return MutationDetailsTableFormatter.assignIntValue(n.endPos)},sequencingCenter:function(t){var n=t.mutation;return n.sequencingCenter},chr:function(t){var n=t.mutation;return n.chr},referenceAllele:function(t){var n=t.mutation;return n.referenceAllele},variantAllele:function(t){var n=t.mutation;return n.variantAllele},igvLink:function(t){var n=t.mutation;return n.igvLink},cBioPortal:function(t){var n=t.cBioPortal;return n||0}},columnFilter:{proteinChange:function(t){return t.mutation.proteinChange},cosmic:function(t){return t.mutation.cosmicCount},cna:function(t){return t.mutation.cna},mutationCount:function(t){return t.mutation.mutationCount},normalFreq:function(t){return t.mutation.normalFreq},tumorFreq:function(t){return t.mutation.tumorFreq},mutationAssessor:function(t){return t.mutation.functionalImpactScore},normalRefCount:function(t){return t.mutation.normalRefCount},normalAltCount:function(t){return t.mutation.normalAltCount},tumorRefCount:function(t){return t.mutation.tumorRefCount},tumorAltCount:function(t){return t.mutation.tumorAltCount},startPos:function(t){return t.mutation.startPos},endPos:function(t){return t.mutation.endPos}},columnData:{},additionalData:{cBioPortal:function(t){var n=t.dataProxies.pancanProxy,i=t.indexMap,a=t.dataTable,o=t.additionalData;n.getPancanData({cmd:"byProteinPos"},e,function(t){n.getPancanData({cmd:"byHugos"},e,function(n){var e=PancanMutationDataUtil.getMutationFrequencies({protein_pos_start:t,hugo:n});o.pancanFrequencies=e;var r=a.fnGetData();_.each(r,function(t,n){var o=t[i.datum].mutation.proteinPosStart;o>0?t[i.datum].cBioPortal=PancanMutationDataUtil.countByKey(e,o):t[i.datum].cBioPortal=0,a.fnUpdate(null,n,i.cBioPortal,!1,!1)}),r.length>0&&a.fnUpdate(null,0,i.cBioPortal)})})}},filteringDelay:600,dataTableOpts:{sDom:'<"H"<"mutation_datatables_filter"f>C<"mutation_datatables_info"i>>t<"F"<"mutation_datatables_download"T>>',bJQueryUI:!0,bPaginate:!1,bFilter:!0,sScrollY:"600px",bScrollCollapse:!0,oLanguage:{sInfo:"Showing _TOTAL_ mutation(s)",sInfoFiltered:"(out of _MAX_ total mutations)",sInfoEmpty:"No mutations to show"}}},f=jQuery.extend(!0,{},h,t);AdvancedDataTable.call(this,f),f=m._options;var g=m._dispatcher,v=!0,b="",y="",T={};this._initDataTableOpts=a,this._visibilityValue=r,this._searchValue=l,this._addEventListeners=u,this._addHeaderTooltips=p,this.setEventActive=s,this.getManualSearch=d,this.cleanFilters=c,this.dispatcher=this._dispatcher}function MutationDiagram(t,n,e,i){var a=this;a.listeners={},a.dispatcher={},_.extend(a.dispatcher,Backbone.Events),a.options=jQuery.extend(!0,{},a.defaultOpts,n),a.dataProxies=i,a.geneSymbol=t,a.data=e,a.pileups=null==e?null:e.pileups,a.highlighted={},a.multiSelect=!1,a.svg=null,a.bounds=null,a.gData=null,a.gLine=null,a.gLabel=null,a.xScale=null,a.yScale=null,a.topLabel=null,a.xAxisLabel=null,a.yAxisLabel=null,a.xMax=null,a.yMax=null,a.maxCount=null,a.mutationColorMap={},a.mutationPileupMap={}}function MutationHistogram(t,n,e){MutationDiagram.call(this,t,n,e)}function MutationPdbPanel(t,n,e,i){function a(t,n,e,i,a){var l=tt;_.each(e,function(e,o){_.each(e,function(e,u){var s=e.chain;if(s.alignments.length>0){var c=n.colors[u%n.colors.length],d=n.marginTop+(a+o)*(n.chainHeight+n.chainPadding),p=r(t,s,c,n,i,d);p.datum(e),et[PdbDataUtil.chainKey(e.pdbId,e.chain.chainId)]=p,null==Q&&(Q=p),l++}})}),tt=l,o(e,n)}function o(t,n){var i=[],a=[];_.each(t,function(t,n){_.each(t,function(t,n){i.push(t.pdbId),a.push(et[PdbDataUtil.chainKey(t.pdbId,t.chain.chainId)])})}),e.getPdbInfo(i.join(" "),function(t){_.each(a,function(t,e){var i=n.chainTipFn;i(t)})})}function r(t,n,e,i,a,o){for(var r=t.append("g").attr("class","pdb-chain-group").attr("opacity",1),l=i.chainHeight,u=new MergedAlignmentSegmentor(n.mergedAlignment);u.hasNextSegment();){var s=u.getNextSegment(),c=Math.abs(a(s.start)-a(s.end)),d=a(s.start);if(s.type==PdbDataUtil.ALIGNMENT_GAP){var p=r.append("line").attr("stroke",i.chainBorderColor).attr("stroke-width",i.chainBorderWidth).attr("x1",d).attr("y1",o+l/2).attr("x2",d+c).attr("y2",o+l/2);p.datum({initPos:{x:d,y:o+l/2}})}else{var m=r.append("rect").attr("fill",e).attr("opacity",n.mergedAlignment.identityPerc).attr("stroke",i.chainBorderColor).attr("stroke-width",i.chainBorderWidth).attr("x",d).attr("y",o).attr("width",c).attr("height",l);m.datum({initPos:{x:d,y:o}})}}return r}function l(t,n){var e=n.marginLeft-n.labelYPaddingRightV,i=n.marginTop+n.labelYPaddingTopV,a="middle",o="rotate(270, "+e+","+i+")",r="vertical";J.length<n.labelAlignThreshold&&(e=n.marginLeft-n.labelYPaddingRightH,i=n.marginTop+n.labelYPaddingTopH,a="start",o="rotate(0, "+e+","+i+")",r="horizontal");var l=t.append("g").attr("class","pdb-panel-y-axis-label-group").attr("opacity",1),s=l.append("text").attr("fill",n.labelYFontColor).attr("text-anchor",a).attr("x",e).attr("y",i).attr("class","pdb-panel-y-axis-label").attr("transform",o).style("font-family",n.labelYFont).style("font-size",n.labelYFontSize).style("font-weight",n.labelYFontWeight);_.isArray(n.labelY)?_.each(n.labelY,function(t,n){var i=0==n?0:10,a=0==n&&"vertical"==r?-5:0;s.append("tspan").attr("x",e+a).attr("dy",i).text(t)}):s.text(n.labelY);var c=u(l,e,i,r,n),d=n.yHelpTipFn;return d(c),s}function u(t,n,e,i,a){var o=12,r=12,l=n-o+2,u=a.marginTop;return"horizontal"==i&&(l=a.marginLeft-o-5,u=e-r+2),t.append("svg:image").attr("xlink:href","images/help.png").attr("class","pdb-panel-y-axis-help").attr("x",l).attr("y",u).attr("width",o).attr("height",r)}function s(){return Q}function c(t,n){return et[t+":"+n]}function d(t,n){for(var e=-1,i=0;i<n.length;i++)if(n[i]>t){e=i;break}return-1==e&&(e=n.length-1),e}function p(t){var n=0,e=J.length;return n="auto"!=t?t:W.marginTop+W.marginBottom+e*(W.chainHeight+W.chainPadding)-W.chainPadding/2}function m(t){var n=0,e=J.length;return n=e>t?W.marginTop+t*(W.chainHeight+W.chainPadding)-W.chainPadding/2:p("auto")}function h(t,n,e){var i=t.append("svg");return i.attr("width",n),i.attr("height",e),i}function f(){J=PdbDataUtil.allocateChainRows(n),X=d(J.length,W.numRows);var t=$(W.el)[0],e=d3.select(t),o=W.numRows[0];at=m(o);var r=h(e,W.elWidth,at);K=r,a(r,W,J.slice(0,o),i,0),nt[0]=!0,0!=W.labelY&&l(r,W),it=g(J),y()}function g(t){var n={};return _.each(t,function(t,e){_.each(t,function(t,i){n[PdbDataUtil.chainKey(t.pdbId,t.chain.chainId)]=e})}),n}function v(t,n,e){K.selectAll(t).on(n,e),null==G[t]&&(G[t]={}),G[t][n]=e}function b(t,n){K.selectAll(t).on(n,null),G[t]&&G[t][n]&&delete G[t][n]}function y(){v(".pdb-chain-group","click",function(t,n){I(d3.select(this))})}function T(){for(var t in G){var n=K.selectAll(t);for(var e in G[t])n.on(e,G[t][e])}}function C(){$(W.el).show()}function P(){$(W.el).hide()}function w(t){var n=m(W.numRows[t]),e=K.attr("height");z(n,e),K.transition().duration(W.animationDuration).attr("height",n).each("end",function(){H(n,e)}),at=n}function S(){var t=D();w(t)}function D(){var t=(Z+1)%(X+1);return nt[t]||(a(K,W,J.slice(W.numRows[Z],W.numRows[t]),i,W.numRows[Z]),T(),nt[t]=!0),Z=t,t}function x(t){for(var n=-1,e=Z;t>e&&X>e;e++)n=D();-1!==n&&w(n)}function M(t,n){for(var e=-1,i=it[PdbDataUtil.chainKey(t,n)],a=0;a<W.numRows.length;a++)if(i<W.numRows[a]){e=a;break}-1!==e&&x(e)}function A(){return J.length>W.numRows[0]}function I(t){ot=t;var n=F(t);K.selectAll(".pdb-selection-rectangle-group").remove();var e=K.append("g").attr("class","pdb-selection-rectangle-group").attr("opacity",0),i=e.append("rect").attr("fill","none").attr("stroke",W.highlightBorderColor).attr("stroke-width",W.highlightBorderWidth).attr("x",n.x).attr("y",n.y).attr("width",n.width).attr("height",n.height);e.transition().duration(W.animationDuration).attr("opacity",1),i.datum({initPos:{x:n.x,y:n.y}}),Y.trigger(MutationDetailsEvents.PANEL_CHAIN_SELECTED,t)}function F(t){var n=1/0,e=-1,i=-1,a=-1;return t.selectAll("rect").each(function(t,o){var r=d3.select(this);i=parseFloat(r.attr("y")),a=parseFloat(r.attr("height"));var l=parseFloat(r.attr("x")),u=parseFloat(r.attr("width"));n>l&&(n=l),l+u>e&&(e=l+u)}),{x:n,y:i,width:e-n,height:a}}function L(t){null!=ot&&k(ot,t)}function k(t,n){var e=W.animationDuration;E(t,n),t==ot&&E(K.selectAll(".pdb-selection-rectangle-group")),V(t);var i=m(1),a=K.attr("height");z(i,a),K.transition().duration(e).attr("height",i).each("end",function(){H(i,a)})}function E(t,n){var e=W.animationDuration,i=W.marginTop,a=W.chainHeight;t.selectAll("line").transition().duration(e).attr("y1",i+a/2).attr("y2",i+a/2),t.selectAll("rect").transition().duration(e).attr("y",i).each("end",function(){_.isFunction(n)&&n()})}function V(t,n){var e=W.animationDuration,i=t.datum(),a=PdbDataUtil.chainKey(i.pdbId,i.chain.chainId);K.selectAll(".pdb-chain-group").transition().duration(e).attr("opacity",function(t){return PdbDataUtil.chainKey(t.pdbId,t.chain.chainId)===a?1:0}),K.selectAll(".pdb-selection-rectangle-group").transition().duration(e).attr("opacity",function(n){return ot==t?1:0}),K.select(".pdb-panel-y-axis-label-group").transition().duration(e).attr("opacity",0).each("end",function(){_.isFunction(n)&&n()})}function B(t,n,e){K.selectAll(t).transition().duration(e).attr("y1",function(t){return n(this,t,"y1")}).attr("y2",function(t){return n(this,t,"y2")})}function O(t,n,e){K.selectAll(t).transition().duration(e).attr("y",function(t){return n(this,t,"y")})}function q(t){var n=W.animationDuration;N(),R();var e=K.attr("height");z(at,e),K.transition().duration(n).attr("height",at).each("end",function(){_.isFunction(t)&&t(),H(at,e)})}function N(t){var n=W.animationDuration,e=function(t,n,e){return n.initPos.y};O(".pdb-chain-group rect",e,n),B(".pdb-chain-group line",e,n),O(".pdb-selection-rectangle-group rect",e,n),setTimeout(t,n+50)}function R(t){var n=W.animationDuration;K.selectAll(".pdb-chain-group").transition().duration(n).attr("opacity",1),K.selectAll(".pdb-selection-rectangle-group").transition().duration(n).attr("opacity",1),K.selectAll(".pdb-panel-y-axis-label-group").transition().duration(n).attr("opacity",1).each("end",function(){_.isFunction(t)&&t()})}function U(){return ot}function z(t,n){Y.trigger(MutationDetailsEvents.PDB_PANEL_RESIZE_STARTED,t,n,W.maxHeight)}function H(t,n){Y.trigger(MutationDetailsEvents.PDB_PANEL_RESIZE_ENDED,t,n,W.maxHeight)}var j={el:"#mutation_pdb_panel_d3",elWidth:740,elHeight:"auto",maxHeight:200,numRows:[1/0],marginLeft:45,marginRight:30,marginTop:2,marginBottom:0,chainHeight:6,chainPadding:3,labelY:["PDB","Chains"],labelYFont:"sans-serif",labelYFontColor:"#2E3436",labelYFontSize:"12px",labelYFontWeight:"normal",labelYPaddingRightH:45,labelYPaddingTopH:7,labelYPaddingRightV:25,labelYPaddingTopV:20,labelAlignThreshold:5,chainBorderColor:"#666666",chainBorderWidth:.5,highlightBorderColor:"#FF9900",highlightBorderWidth:2,colors:["#3366cc"],animationDuration:1e3,chainTipFn:function(t){var n=t.datum();e.getPdbInfo(n.pdbId,function(e){var i=null;e&&(i=PdbDataUtil.generatePdbInfoSummary(e[n.pdbId],n.chain.chainId));var a=new PdbChainTipView({model:{pdbId:n.pdbId,pdbInfo:i.title,molInfo:i.molecule,chain:n.chain}}),o=a.compileTemplate(),r={content:{text:o},hide:{fixed:!0,delay:100},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-lightyellow"},position:{my:"bottom left",at:"top center",viewport:$(window)}};$(t).qtip(r)})},yHelpTipFn:function(t){var n=BackboneTemplateCache.getTemplateFn("mutation_details_pdb_help_tip_template"),e=n({}),i={content:{text:e},hide:{fixed:!0,delay:100},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-lightyellow qtip-wide"},position:{my:"bottom left",at:"top center",viewport:$(window)}};$(t).qtip(i)}},G={},Y={};_.extend(Y,Backbone.Events);var W=jQuery.extend(!0,{},j,t),K=null,J=null,Q=null,Z=0,X=null,tt=0,nt=[],et={},it={},at=0,ot=null;return{init:f,addListener:v,removeListener:b,getChainGroup:c,getDefaultChainGroup:s,show:C,hide:P,toggleHeight:S,expandToChainLevel:M,minimizeToChain:k,minimizeToHighlighted:L,restoreToFull:q,restoreChainPositions:N,fadeInAll:R,hasMoreChains:A,highlight:I,getHighlighted:U,dispatcher:Y}}function MutationPdbTable(t){function n(t,n,e,i,a,o,r,l){var s=DataTableUtil.getColumnOptions(e,a),c={aaData:n,aoColumns:s,aoColumnDefs:[{bVisible:!1,aTargets:o},{bSearchable:!1,aTargets:l}],oColVis:{aiExclude:r},fnDrawCallback:function(t){u._addColumnTooltips()},fnHeaderCallback:function(t,n,e,i,a){$(t).find("th").addClass("mutation-pdb-table-header")},fnRowCallback:function(t,n,e,i){var o=n[a.datum],r=PdbDataUtil.chainKey(o.pdbId,o.chain.chainId);p[r]=t,$(t).addClass("pdb-chain-table-data-row")},fnInitComplete:function(t,n){d.trigger(MutationDetailsEvents.PDB_TABLE_READY)}};return c}function e(t){var n=c.columnVisibility[t],e=n;return n?_.isFunction(n)&&(e=n()):e="hidden",e}function i(t){var n=c.columnSearch[t],e=n;return null==n?e=!1:_.isFunction(n)&&(e=n()),e}function a(){u.getDataTable().fnFilter("")}function o(t,n){var e=PdbDataUtil.chainKey(t,n);r();var i=p[e];$(i).addClass("row_selected"),m=i}function r(){$(c.el).find("tr").removeClass("row_selected")}function l(){return m}var u=this,s={el:"#mutation_pdb_table_d3",elWidth:740,columns:{datum:{sTitle:"datum",tip:""},pdbId:{sTitle:"PDB Id",tip:"",sType:"string"},chain:{sTitle:"Chain",tip:"",sType:"string"},uniprotPos:{sTitle:"Uniprot Positions",tip:"",sType:"numeric"},identityPercent:{sTitle:"Identity Percent",tip:"",sType:"numeric"},organism:{sTitle:"Organism",tip:"",sType:"string"},summary:{sTitle:"Summary",tip:"",sType:"string",sWidth:"65%"}},columnOrder:["datum","pdbId","chain","uniprotPos","identityPercent","organism","summary"],columnVisibility:{pdbId:"visible",chain:"visible",uniprotPos:"visible",identityPercent:"hidden",organism:"visible",summary:"visible",datum:"excluded"},columnSearch:{pdbId:!0,organism:!0,summary:!0},columnRender:{identityPercent:function(t){return Math.round(100*t.chain.mergedAlignment.identityPerc)},pdbId:function(t){var n=BackboneTemplateCache.getTemplateFn("mutation_pdb_table_pdb_cell_template");return n({pdbId:t.pdbId})},chain:function(t){var n=BackboneTemplateCache.getTemplateFn("mutation_pdb_table_chain_cell_template");return n({chainId:t.chain.chainId})},organism:function(t){return t.organism},summary:function(t){var n={summary:t.summary.title,molecule:t.summary.molecule},e=BackboneTemplateCache.getTemplateFn("mutation_pdb_table_summary_cell_template");return e(n)},uniprotPos:function(t){return t.chain.mergedAlignment.uniprotFrom+"-"+t.chain.mergedAlignment.uniprotTo}},columnTooltips:{simple:function(t){var n=MutationViewsUtil.defaultTableTooltipOpts();$(t).find(".simple-tip").qtip(n)}},eventListeners:{pdbLink:function(t,n,e){$(t).on("click",".pbd-chain-table-chain-cell a",function(i){i.preventDefault(),r();var a=$(i.target).closest("tr.pdb-chain-table-data-row");a.addClass("row_selected");var o=t.fnGetData(a[0]),l=o[e.datum];n.trigger(MutationDetailsEvents.TABLE_CHAIN_SELECTED,l.pdbId,l.chain.chainId)})}},columnSort:{identityPercent:function(t){return MutationDetailsTableFormatter.assignFloatValue(Math.round(100*t.chain.mergedAlignment.identityPerc))},pdbId:function(t){return t.pdbId},chain:function(t){return t.chain.chainId},organism:function(t){return t.organism},summary:function(t){return t.summary.title+t.summary.molecule},uniprotPos:function(t){return MutationDetailsTableFormatter.assignIntValue(t.chain.mergedAlignment.uniprotFrom)}},columnFilter:{identityPercent:function(t){return Math.round(100*t.chain.mergedAlignment.identityPerc)},summary:function(t){return t.summary.title+" "+t.summary.molecule},uniprotPos:function(t){return t.chain.mergedAlignment.uniprotFrom+"-"+t.chain.mergedAlignment.uniprotTo}},filteringDelay:0,dataTableOpts:{sDom:'<"H"<"mutation_pdb_datatable_info"i><"mutation_pdb_datatable_filter"f>>t',bJQueryUI:!0,bPaginate:!1,bFilter:!0,sScrollY:"200px",bScrollCollapse:!0,oLanguage:{sInfo:"Showing _TOTAL_ PDB chain(s)",sInfoFiltered:"(out of _MAX_ total chains)",sInfoEmpty:"No chains to show"}}},c=jQuery.extend(!0,{},s,t);AdvancedDataTable.call(this,c),c=u._options;var d=u._dispatcher,p={},m=null;this._initDataTableOpts=n,this._visibilityValue=e,this._searchValue=i,this.selectRow=o,this.cleanFilters=a,this.getSelectedRow=l,this.dispatcher=this._dispatcher}function PancanMutationHistogram(t,n,e,i,a){function o(t){return t.map(_.clone)}function r(t){return _.reduce(t,function(t,n){return t[n.cancer_study]=n,t},{})}function l(t){var n=v[t.cancer_study].num_sequenced_samples;return t.num_sequenced_samples=n,t.frequency=t.count/n,t}function u(t){var n=_.reduce(t,function(t,n){return t+n.frequency},0);return-1*n}function s(t){var n=t[0].cancer_type;if(!_.every(t,function(t){return t.cancer_type===n}))throw new Error("not all data in a group have the same cancer type");return n}function c(t){function n(t){return{cancer_study:t,count:0,cancer_type:v[t].cancer_type,num_sequenced_samples:v[t].num_sequenced_samples}}var e=r(t);return _.chain(b).reduce(function(t,n){return _.has(e,n)||t.push(n),t},[]).map(n).value()}function d(t){return t.concat(c(t))}function p(){var t,n=_.find(M[0],function(t){return t.cancer_study===a.this_cancer_study});try{t=n.cancer_type}catch(e){throw new Error(e+": could not find this the corresponding datum for this cancer study, ["+a.this_cancer_study+"]")}var i=function(t){return _.find(t,function(t){return t.cancer_study===a.this_cancer_study})},o=_.zip.apply(null,M);o=_.find(o,i);var r=u(o);L.append("text").text("*").attr("id","star").attr("x",V(a.this_cancer_study)).attr("y",q(-1*r)+10).style("font-family","Helvetica Neue, Helvetica, Arial, sans-serif").style("font-size",3*V.rangeBand()+"px")}function m(t){var n=d3.select(t).selectAll(".mouseOver").data(b).enter().append("rect").attr("class","mouseOver").attr("y",a.margin.top).attr("x",function(t){return V(t)+a.margin.left}).attr("opacity","0").attr("height",F+5).attr("width",V.rangeBand()).on("mouseover",function(){d3.select(this).attr("opacity","0.25")}).on("mouseout",function(){d3.select(this).attr("opacity","0")});n.each(function(t){$(this).qtip({content:{text:"mouseover failed"},position:{my:"left top",at:"center right",viewport:$(window)},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-wide"},hide:{fixed:!0,delay:100},events:{render:function(n,e){var i=g(t).map(function(t){return t[0].__data__}),a=i.filter(function(t){return _.has(t,"keyword")})[0]||{},o=i.filter(function(t){return!_.has(t,"keyword")})[0]||{},r=o.cancer_study,l=v[r].num_sequenced_samples,u="<p style='font-weight:bold;'>"+r+"</p>"+f(a,o,l);e.set("content.text",u)}}})})}function h(t,n){var e=t.count||0;"frequency"in t||(t.frequency=e/n);var i=(100*t.frequency).toFixed(1)+"%";return _.template("<span><b>{{percent}}</b> (<b>{{count}}</b> of {{total}} sequenced samples)</span>")({percent:i,count:e,total:n})}function f(t,n,e){return"<p style='color: "+R+"; margin-bottom:0;'>"+C+": "+h(t,e)+"</p><p style='color: "+N+"; margin-top:0;'>Other "+Y+" mutations: "+h(n,e)+"</p>"}function g(t){return z.filter(function(n){return n.cancer_study===t})}a=a||{},a=a.sparkline?_.extend({margin:{top:-12,right:0,bottom:0,left:0},width:30,height:12,this_cancer_study:void 0},a):_.extend({margin:{top:6,right:10,bottom:20,left:40},width:600,height:300,this_cancer_study:void 0},a);var v=r(e),b=_.keys(v),y=o(t),T=o(n),C=y[0].hugo+" "+y[0].protein_pos_start;y=d(y).map(function(t){return t.keyword=C,t}),T=d(T);var P={bykeyword:r(y),bygene:r(T)},w=_.intersection(_.keys(P.bykeyword),_.keys(P.bygene));if(y=[],T=[],_.each(w,function(t){y.push(P.bykeyword[t]),T.push(P.bygene[t])}),T.length!==y.length)throw new Error("must be same length");if(T.length!==b.length)throw new Error("there must be a datum for every cancer study and visa versa");T.forEach(function(t){var n=P.bykeyword[t.cancer_study],e=t.count-n.count;if(0>e)throw new Error("more mutations for a particular keyword than for all keywords of a particular gene");t.count=e});var S=_.reduce(T,function(t,n){return t+n.count},0),D=_.reduce(y,function(t,n){return t+n.count},0),x=_.reduce(v,function(t,n){return t+n.num_sequenced_samples},0);_.mixin({unzip:function(t){return _.zip.apply(_,t)}});var M=y.concat(T);try{M=_.chain(M).map(l).groupBy(function(t){return t.cancer_study}).map(_.identity).sortBy(s).unzip().value()}catch(A){throw new Error(A)}var I=a.width-a.margin.left-a.margin.left,F=a.height-a.margin.top-a.margin.bottom,L=d3.select(i).append("svg").attr("width",a.width).attr("height",a.height).append("g").attr("transform","translate("+a.margin.left+","+a.margin.top+")"),k=d3.layout.stack().x(function(t){return t.cancer_study}).y(function(t){return t.frequency}),E=k(M),V=d3.scale.ordinal().domain(M[0].map(function(t){return t.cancer_study})).rangeBands([0,I],.1),B=.2,O=a.sparkline?B:d3.max(E,function(t){return d3.max(t,function(t){return t.y0+t.y})}),q=d3.scale.linear().domain([0,O]).range([F,0]).clamp(!0),N="LimeGreen",R="Green",U=L.selectAll(".layer").data(E).enter().append("g").attr("class","layer").style("fill",function(t,n){return[R,N][n]}),z=U.selectAll("rect").data(function(t){return t}).enter().append("rect").attr("x",function(t){return V(t.cancer_study)}).attr("y",function(t){return q(t.y0+t.y)}).attr("width",function(t){return V.rangeBand()}).attr("height",function(t){
return q(t.y0)-q(t.y0+t.y)});if(a.sparkline)return{el:i,qtip:function(){throw new Error("don't qtip a sparkline")}};var H=d3.format(O>.1?".0%":".1%"),j=d3.svg.axis().scale(q).tickFormat(H).orient("left");j.tickSize(j.tickSize(),0,0);var G=function(){function t(t){return{cancer_type:t.cancer_type,start:t.cancer_study,end:t.cancer_study,color:v[t.cancer_study].color}}var n=M[0][0];return _.chain(M[0]).reduce(function(n,e){var i=_.last(n);return i.cancer_type!==e.cancer_type?n.concat(t(e)):i.cancer_type===e.cancer_type?(i.end=e.cancer_study,n):void 0},[t(n)]).value()}();L.selectAll("line").data(G).enter().append("line").attr("x1",function(t){return V(t.start)}).attr("x2",function(t){return V(t.end)+V.rangeBand()}).attr("y1",F+a.margin.bottom/3).attr("y2",F+a.margin.bottom/3).style("stroke-width",5).style("stroke",function(t){return t.color});var Y=(L.append("g").call(j).attr("stroke","#000").attr("shape-rendering","crispEdges"),_.find(E[0],function(t){return void 0!==t.hugo}).hugo),C=_.find(E[0],function(t){return void 0!==t.keyword}).keyword;return _.isUndefined(a.this_cancer_study)||p(),{el:i,qtip:m,overallCountText:function(){return f({count:D},{count:S},x)}}}function MainMutationController(t,n){function e(){n.dispatcher.on(MutationDetailsEvents.ALL_LOLLIPOPS_DESELECTED,o),n.dispatcher.on(MutationDetailsEvents.LOLLIPOP_DESELECTED,r),n.dispatcher.on(MutationDetailsEvents.LOLLIPOP_SELECTED,l),n.dispatcher.on(MutationDetailsEvents.DIAGRAM_PLOT_UPDATED,a),t.addResetCallback(i)}function i(e){n.resetPlot(),t.hideFilterInfo()}function a(){n.isFiltered()?t.showFilterInfo():t.hideFilterInfo()}function o(){n.isFiltered()||t.hideFilterInfo()}function r(t,e){0==n.getSelectedElements().length&&o()}function l(n,e){t.showFilterInfo()}e()}function Mutation3dController(t,n,e,i,a,o,r,l,u,s){function c(){l.dispatcher.on(MutationDetailsEvents.ALL_LOLLIPOPS_DESELECTED,D),l.dispatcher.on(MutationDetailsEvents.LOLLIPOP_DESELECTED,x),l.dispatcher.on(MutationDetailsEvents.LOLLIPOP_SELECTED,M),l.dispatcher.on(MutationDetailsEvents.LOLLIPOP_MOUSEOVER,A),l.dispatcher.on(MutationDetailsEvents.LOLLIPOP_MOUSEOUT,I),l.dispatcher.on(MutationDetailsEvents.DIAGRAM_PLOT_UPDATED,S),l.dispatcher.on(MutationDetailsEvents.DIAGRAM_PLOT_RESET,w),u.dispatcher.on(MutationDetailsEvents.PDB_LINK_CLICKED,L),u.dispatcher.on(MutationDetailsEvents.PROTEIN_CHANGE_LINK_CLICKED,F),i.addInitCallback(m),e.dispatcher.on(MutationDetailsEvents.VIEW_3D_PANEL_CLOSED,p),e.dispatcher.on(MutationDetailsEvents.VIEW_3D_STRUCTURE_RELOADED,v),t.dispatcher.on(MutationDetailsEvents.GENE_TAB_SELECTED,d)}function d(t){e&&(e.resetPanelPosition(),e.hideView())}function p(){q&&q.hideView()}function m(t){B(),null!=e&&(e.resetPanelPosition(),e.maximizeView())}function h(t,n,e){t>e&&q.toggleScrollBar(e)}function f(t,n,e){e>=t&&q.toggleScrollBar(-1),n!=t&&q.scrollToSelected()}function g(t){R&&q.scrollToSelected();var n=t.datum();null!=e&&(e.maximizeView(),e.updateView(s,n.pdbId,n.chain)),R||null==N||(N.resetFilters(),N.selectChain(n.pdbId,n.chain.chainId),N.scrollToSelected()),R=!1}function v(){i.isVisible()&&l.isHighlighted()&&V()}function b(t,n){t&&n&&(q.selectChain(t,n),R=!0)}function y(){q.pdbPanel.minimizeToHighlighted()}function T(t,n){t&&n&&q.pdbPanel.minimizeToChain(q.pdbPanel.getChainGroup(t,n))}function C(t){null==N&&null!=q&&t.length>0&&(N=q.initPdbTableView(t,function(t,n){n.dispatcher.on(MutationDetailsEvents.PDB_TABLE_READY,P),N=t}),N.pdbTable.dispatcher.on(MutationDetailsEvents.TABLE_CHAIN_SELECTED,b),N.pdbTable.dispatcher.on(MutationDetailsEvents.TABLE_CHAIN_MOUSEOUT,y),N.pdbTable.dispatcher.on(MutationDetailsEvents.TABLE_CHAIN_MOUSEOVER,T)),null!=q&&null!=N&&(q.toggleTableControls(),N.toggleView())}function P(){if(null!=q){var t=q.getSelectedChain();if(null!=t){var n=t.datum();N.selectChain(n.pdbId,n.chain.chainId),N.scrollToSelected()}}}function w(){e&&e.isVisible()&&e.refreshView()}function S(){e&&e.isVisible()&&e.refreshView()}function D(){e&&e.isVisible()&&(e.resetHighlight(),e.hideResidueWarning())}function x(t,n){l.isHighlighted()?M():D()}function M(t,n){e&&e.isVisible()&&V()}function A(t,n){if(e&&e.isVisible()){var i=E();i.push(t),$(i,!0)}}function I(t,n){x(t,n)}function F(t){var n=k(t);n&&e&&e.isVisible()&&V()}function L(t){var n=k(t);n&&B(n.pdbMatch.pdbId,n.pdbMatch.chainId)}function k(t){var n=r.getMutationIdMap(),e=n[t];return e&&(l.clearHighlights(),l.highlightMutation(e.mutationSid)),e}function E(){var t=[];return _.each(l.getSelectedElements(),function(n,e){t=t.concat(n.datum())}),t}function V(){var t=E();$(t)}function $(t,n){var i=e.highlightView(t,!0),a=t.length-i;n||(a>0?e.showResidueWarning(a,t.length):e.hideResidueWarning())}function B(t,a){var r=i.model.uniprotId,l=function(i){null==q&&(q=n.initPdbPanelView(i),q.pdbPanel.dispatcher.on(MutationDetailsEvents.PANEL_CHAIN_SELECTED,g),q.pdbPanel.dispatcher.on(MutationDetailsEvents.PDB_PANEL_RESIZE_STARTED,h),q.pdbPanel.dispatcher.on(MutationDetailsEvents.PDB_PANEL_RESIZE_ENDED,f),q.addInitCallback(function(t){C(i)})),null!=e&&null!=q&&i.length>0&&(O(),q.showView(),t&&a?q.selectChain(t,a):q.selectDefaultChain(),q.autoCollapse())};o.getPdbData(r,l)}function O(){var t=function(t,n,e){return l.mutationColorMap[t]};a.updateOptions({mutationColorMapper:t})}var q=null,N=null,R=!1;c()}function MutationDetailsController(t,n,e,i,a,o){function r(){t.dispatcher.on(MutationDetailsEvents.GENE_TAB_SELECTED,l),t.dispatcher.on(MutationDetailsEvents.GENE_TABS_CREATED,u)}function l(t){null==h[t]&&s(t,e,i,a)}function u(){var n=t.$el.find(".mutation-3d-container");if(o){var r=new Mutation3dVisView({el:n,mut3dVis:o,pdbProxy:m,mutationProxy:d});r.render(),f=r}else $(n).hide();var l=d.getGeneList();s(l[0],e,i,a)}function s(e,i,a,r){var l=function(l,u,s){u=c(u,d.getMutationUtil(),s);var p=d.getMutationUtil(),g={geneSymbol:e,mutationData:u,dataProxies:n,sequence:l,sampleArray:i,diagramOpts:a,tableOpts:r},v=new MainMutationView({el:"#mutation_details_"+cbio.util.safeProperty(e),model:g});v.render(),h[e].mainMutationView=v;var b=v.initComponents(f);(null==u||0==u.length)&&(v.showNoDataInfo(),b.tableView.hideView()),new MainMutationController(v,b.diagram),new MutationDetailsTableController(b.tableView,b.diagram,t),o&&f&&new Mutation3dController(t,v,f,b.view3d,o,m,p,b.diagram,b.tableView.tableUtil,e),new MutationDiagramController(b.diagram,b.tableView.tableUtil,p)};d.getMutationData(e,function(t){h[e]={},null==t&&(t=[]);var n=d.getMutationUtil().dataFieldCount(e,"uniprotAcc",["NA"]),i=null,a={geneSymbol:e};n.length>0&&(i=n[0].uniprotAcc),i&&(a.uniprotAcc=i),p.getPfamData(a,function(n){if(null==n)return void console.log("[warning] no pfam data found: %o",a);var e=n[0];if(m){var i=e.metadata.identifier;m.getPdbRowData(i,function(n){l(e,t,n)})}else l(e,t)})})}function c(t,n,e){if(!e)return t;var i=n.getMutationIdMap();return _.each(t,function(t,n){if(null==t)return void console.log("warning [processMutationData]: mutation (at index %d) is null.",n);var a=i[t.mutationId],o=PdbDataUtil.mutationToPdb(a,e);t.pdbMatch=o,a.pdbMatch=o}),t}var d=n.mutationProxy,p=n.pfamProxy,m=n.pdbProxy,h={},f=null;r()}function MutationDetailsTableController(t,n,e){function i(){n.dispatcher.on(MutationDetailsEvents.ALL_LOLLIPOPS_DESELECTED,o),n.dispatcher.on(MutationDetailsEvents.LOLLIPOP_DESELECTED,r),n.dispatcher.on(MutationDetailsEvents.LOLLIPOP_SELECTED,l),n.dispatcher.on(MutationDetailsEvents.LOLLIPOP_MOUSEOVER,u),n.dispatcher.on(MutationDetailsEvents.LOLLIPOP_MOUSEOUT,s),n.dispatcher.on(MutationDetailsEvents.DIAGRAM_PLOT_RESET,a),e.dispatcher.on(MutationDetailsEvents.GENE_TAB_SELECTED,c)}function a(){t&&t.resetFilters()}function o(){t&&(t.clearHighlights(),t.rollBack())}function r(e,i){if(t){t.clearHighlights();var a=[];_.each(n.getSelectedElements(),function(t,n){a=a.concat(t.datum().mutations)}),a.length>0?t.filter(a):t.rollBack()}}function l(e,i){if(t){t.clearHighlights();var a=[];_.each(n.getSelectedElements(),function(t,n){a=a.concat(t.datum().mutations)}),t.filter(a)}}function u(n,e){t&&t.highlight(n.mutations)}function s(n,e){t&&t.clearHighlights()}function c(n){if(t){var e=t.tableUtil.getDataTable();e.is(":visible")&&e.fnAdjustColumnSizing()}}i()}function MutationDiagramController(t,n,e){function i(){n.dispatcher.on(MutationDetailsEvents.MUTATION_TABLE_FILTERED,a)}function a(n){var e=[],i=[];try{i=$(n).DataTable().rows({filter:"applied"}).data()}catch(a){i=$(n).dataTable()._("tr",{filter:"applied"})}if(_.each(i,function(t,n){var i=t[0].mutation;i&&e.push(i)}),null!==t){var o=new MutationCollection(e);t.updatePlot(PileupUtil.convertToPileups(o))}}i()}function MutationMapper(t){function n(t){a.proxy.mutationProxy.options.geneList=a.data.geneList.join(" ");var n=DataProxyUtil.initDataProxies(a.proxy,t),i={mutationProxy:n.mutationProxy,sampleArray:a.data.sampleList,tableOpts:a.view.mutationTable,diagramOpts:a.view.mutationDiagram},o={el:a.el,model:i,mut3dVis:t},r=new MutationDetailsView(o);e=r;new MutationDetailsController(r,n,i.sampleArray,i.diagramOpts,i.tableOpts,t);r.render()}var e=null,i={el:"#mutation_details",data:{geneList:[],sampleList:[]},view:{mutationDiagram:{},mutationTable:{},pdbPanel:{},pdbTable:{},vis3d:{}},proxy:{pfamProxy:{instance:null,instanceClass:PfamDataProxy,options:{data:{}}},mutationProxy:{instance:null,instanceClass:MutationDataProxy,options:{data:{},params:{},geneList:""}},pdbProxy:{instance:null,instanceClass:PdbDataProxy,options:{data:{pdbData:{},infoData:{},summaryData:{},positionData:{}},mutationUtil:{}}},pancanProxy:{instance:null,instanceClass:PancanMutationDataProxy,options:{data:{byKeyword:{},byProteinChange:{},byProteinPosition:{},byGeneSymbol:{}}}},mutationAlignerProxy:{instance:null,instanceClass:MutationAlignerDataProxy,options:{data:{}}},portalProxy:{instance:null,instanceClass:PortalDataProxy,options:{data:{}}}}},a=jQuery.extend(!0,{},i,t);this.init=n,this.getView=function(){return e}}var DataTableUtil=function(){function t(t){var n={};return _.each(t,function(t,e){null==n[t]&&(n[t]=e)}),n}function n(t){var n={};return _.each(_.pairs(t),function(t,e){var i=t[0],a=t[1];null!=a.sTitle&&a.sTitle.length>0&&(n[a.sTitle]=i)}),n}function e(t,n){var e={};return _.each(t,function(t,i){null==e[t]&&(_.isFunction(n)?e[t]=n(t):e[t]="hidden")}),e}function i(t,n){var e={};return _.each(t,function(t,i){null==e[t]&&(e[t]=_.isFunction(n)&&n(t))}),e}function a(t,n,e){var i=[];return _.each(t,function(t,a){"visible"!=e[t]&&i.push(n[t])}),i}function o(t,n,e){var i=[];return _.each(t,function(t,a){"excluded"==e[t]&&i.push(n[t])}),i}function r(t,n,e){var i=[];return _.each(t,function(t,a){e[t]===!1&&i.push(n[t])}),i}function l(t,n){var e=[];return _.each(_.pairs(t),function(t){var i=t[0],a=t[1],o=n[i];if(null!=o){var r={fnRender:function(t){var e=t.aData[n.datum];return a(t,e)},aTargets:[o]};e.push(r)}}),e}function u(t,n,e,i,a){var o={};return _.each(_.pairs(n),function(n){var a=n[0],r=n[1],l=e[a],u=i[a],s=t[a],c=function(t){return null!=l?l(t):r(t)};if(null!=s){var d={mData:function(n,e,i){var a=n[t.datum];return"set"===e?null:"display"===e?r(a):"sort"===e?c(a):"filter"===e?null!=u?u(a):c(a):n[s]},aTargets:[s]};o[a]=d}}),_.each(_.pairs(a),function(n){var e=n[0],i=n[1],a=t[e],r={mData:function(n,e,a){return i(n,e,a,t)},aTargets:[a]};o[e]=r}),_.values(o)}function s(t,n){var e=[];return _.each(_.pairs(t),function(t){var i=t[0],a=t[1],o=n[i];o>0&&(e[o]=a)}),e}function c(t){var n=$(t).attr("alt"),e=parseFloat(n);return isNaN(e)&&(e=""),e}function d(t){return-1!=t.indexOf("label")?$(t).find("label").text().trim()||$(t).text().trim():-1}function p(t){return-1!=t.indexOf("label")?parseInt($(t).text()):-1}function m(t){return-1!=t.indexOf("label")?parseFloat($(t).text()):-1}function h(t,n,e,i){return e>=0?i>=0?e==i?0:i>e?-1:1:-1:i>=0?1:t==n?0:n>t?1:-1}function f(t,n,e,i){return e>=0?i>=0?e==i?0:i>e?1:-1:-1:i>=0?1:t==n?0:n>t?-1:1}return{buildColumnIndexMap:t,buildColumnNameMap:n,buildColumnVisMap:e,buildColumnSearchMap:i,getHiddenColumns:a,getExcludedColumns:o,getNonSearchableColumns:r,getColumnOptions:s,getColumnRenderers:l,getColumnData:u,compareSortAsc:h,compareSortDesc:f,getAltTextValue:c,getLabelTextValue:d,getLabelTextIntValue:p,getLabelTextFloatValue:m}}(),MutationViewsUtil=function(){function t(t,n,e,i,a){var o=new MutationMapper(n),r=!1;return $(t).is(":visible")&&(o.init(a),r=!0),$(e).bind("tabsactivate",function(t,n){n.newTab.text().trim().toLowerCase()==i.toLowerCase()&&(r?o.getView().refreshGenesTab():(o.init(a),r=!0))}),o}function n(){return{mutationType:i,validationStatus:a,mutationStatus:o,omaScore:r,cna:l}}function e(){return{content:{attr:"alt"},show:{event:"mouseover"},hide:{fixed:!0,delay:100,event:"mouseout"},style:{classes:"mutation-details-tooltip qtip-shadow qtip-light qtip-rounded"},position:{my:"top left",at:"bottom right",viewport:$(window)}}}var i={missense_mutation:{label:"Missense",style:"missense_mutation"},nonsense_mutation:{label:"Nonsense",style:"trunc_mutation"},nonstop_mutation:{label:"Nonstop",style:"trunc_mutation"},frame_shift_del:{label:"FS del",style:"trunc_mutation"},frame_shift_ins:{label:"FS ins",style:"trunc_mutation"},in_frame_ins:{label:"IF ins",style:"inframe_mutation"},in_frame_del:{label:"IF del",style:"inframe_mutation"},splice_site:{label:"Splice",style:"trunc_mutation"},other:{style:"other_mutation"}},a={valid:{label:"V",style:"valid",tooltip:"Valid"},validated:{label:"V",style:"valid",tooltip:"Valid"},wildtype:{label:"W",style:"wildtype",tooltip:"Wildtype"},unknown:{label:"U",style:"unknown",tooltip:"Unknown"},not_tested:{label:"U",style:"unknown",tooltip:"Unknown"},none:{label:"U",style:"unknown",tooltip:"Unknown"},na:{label:"U",style:"unknown",tooltip:"Unknown"}},o={somatic:{label:"S",style:"somatic",tooltip:"Somatic"},germline:{label:"G",style:"germline",tooltip:"Germline"},unknown:{label:"U",style:"unknown",tooltip:"Unknown"},none:{label:"U",style:"unknown",tooltip:"Unknown"},na:{label:"U",style:"unknown",tooltip:"Unknown"}},r={h:{label:"High",style:"oma_high",tooltip:"High"},m:{label:"Medium",style:"oma_medium",tooltip:"Medium"},l:{label:"Low",style:"oma_low",tooltip:"Low"},n:{label:"Neutral",style:"oma_neutral",tooltip:"Neutral"}},l={"-2":{label:"DeepDel",style:"cna-homdel",tooltip:"Deep deletion"},"-1":{label:"ShallowDel",style:"cna-hetloss",tooltip:"Shallow deletion"},0:{label:"Diploid",style:"cna-diploid",tooltip:"Diploid / normal"},1:{label:"Gain",style:"cna-gain",tooltip:"Low-level gain"},2:{label:"AMP",style:"cna-amp",tooltip:"High-level amplification"},unknown:{label:"NA",style:"cna-unknown",tooltip:"CNA data is not available for this gene"}};return{initMutationMapper:t,defaultTableTooltipOpts:e,getVisualStyleMaps:n}}(),MutationDetailsTableFormatter=function(){function t(t){return n(F,t)}function n(t,n){var e,i,a;return null!=t[n]?(e=t[n].style,i=t[n].label,a=t[n].tooltip):(e=t.unknown.style,i=t.unknown.label,a=t.unknown.tooltip),{style:e,tip:a,text:i}}function e(t){var n=16,e=t,i="",a=t;return t.length>n+2&&(e=t.substring(0,n)+"...",i="simple-tip"),{style:i,tip:a,text:e}}function i(t){return a(x,t)}function a(t,n){var e,i;return n=n.toLowerCase(),null!=t[n]?(e=t[n].style,i=t[n].label):(e=t.other.style,i=n),{style:e,text:i}}function o(t){return r(A,t)}function r(t,n){var e="simple-tip",i=n,a="";return n=n.toLowerCase(),null!=t[n]&&(e=t[n].style,i=t[n].label,a=t[n].tooltip),{style:e,tip:a,text:i}}function l(t){return u(M,t)}function u(t,n){var e,i,a;return n=n.toLowerCase(),null!=t[n]?(e=t[n].style,i=t[n].label,a=t[n].tooltip):(e=t.unknown.style,i=t.unknown.label,a=t.unknown.tooltip),{style:e,tip:a,text:i}}function s(t,n){return c(I,t,n)}function c(t,n,e){var i="",a="",o="",r="";return n=n.toLowerCase(),null!=t[n]&&(r=t[n].tooltip,null!=e&&(r=e.toFixed(2)),i=t[n].label,a=t[n].style,o="oma_link"),{fisClass:a,omaClass:o,value:r,text:i}}function d(t,n,e,i){var a="NA",o=n+e,r="",l="";return t&&(r="mutation_table_allele_freq",a=t.toFixed(2),l=i),{text:a,total:o,style:r,tipClass:l}}function p(t){return h(t.pdbMatch)}function m(t){return h(t.igvLink)}function h(t){return t?"#":""}function f(t){var n="mutation-table-protein-change",e="click to highlight the position on the diagram",i="";return null!=t.aminoAcidChange&&t.aminoAcidChange.length>0&&"NA"!=t.aminoAcidChange&&-1!=t.cancerStudyShort.toLowerCase().indexOf("msk-impact")&&g(t.proteinChange,t.aminoAcidChange)&&(i="The original annotation file indicates a different value: <b>"+v(t.aminoAcidChange)+"</b>"),{text:v(t.proteinChange),style:n,tip:e,additionalTip:i}}function g(t,n){var e=!1;if(t=v(t),n=v(n),n!==t){var i=t.match(/[A-Z]/g),a=n.match(/[A-Z]/g),o=t.match(/[0-9]+/),r=n.match(/[0-9]+/),l=t.match(/([a-z]+)/),u=n.match(/([a-z]+)/);o&&r&&o.length>0&&r.length>0&&o[0]!=r[0]?e=!0:i&&a&&i.length>0&&a.length>0&&"X"!==i[0]&&"X"!==a[0]&&i[0]!==a[0]?e=!0:i&&a&&i.length>1&&a.length>1&&i[1]!==a[1]?e=!0:l&&u&&l.length>0&&u.length>0&&l[0]!==u[0]&&(e=!0)}return e}function v(t){var n="p.";return-1!=t.indexOf(n)&&(t=t.substr(t.indexOf(n)+n.length)),t}function b(t){var n="tumor_type",e="";return{text:t.tumorType,style:n,tip:e}}function y(t){var n="",e="";return t>0&&(n="mutation_table_cosmic",e=t),{style:n,count:e}}function _(t){var n="",e="";return t>0&&(n="mutation_table_cbio_portal",e=t),{style:n,frequency:e}}function T(t){var n=t,e="mutation_table_int_value";return null==t&&(n="NA",e=""),{text:n,style:e}}function C(t){var n=t,e="mutation_table_allele_count";return null==t&&(n="NA",e=""),{text:n,style:e}}function P(t,n){var e;return t=t.toLowerCase(),e="low"==t||"l"==t?2:"medium"==t||"m"==t?3:"high"==t||"h"==t?4:"neutral"==t||"n"==t?1:-1,e>0&&!isNaN(n)&&(e+=n/1e3),e}function w(t){var n=parseInt(t);return isNaN(n)&&(n=-(1/0)),n}function S(t){var n=parseFloat(t);return isNaN(n)&&(n=-(1/0)),n}var D=MutationViewsUtil.getVisualStyleMaps(),x=D.mutationType,M=D.validationStatus,A=D.mutationStatus,I=D.omaScore,F=D.cna;return{getCaseId:e,getProteinChange:f,getPdbMatchLink:p,getIgvLink:m,getAlleleCount:C,getAlleleFreq:d,getCNA:t,getMutationType:i,getMutationStatus:o,getValidationStatus:l,getFis:s,getTumorType:b,getCosmic:y,getCbioPortal:_,getIntValue:T,assignValueToPredictedImpact:P,assignIntValue:w,assignFloatValue:S}}(),PileupUtil=function(){function t(t){for(var n=t.mutations,e={},i=0;i<n.length;i++){var a=n[i].mutationType.toLowerCase();void 0==e[a]&&(e[a]=[]),e[a].push(n[i])}return e}function n(n){var e=t(n),i=[];for(var a in e)i.push({type:a,count:e[a].length});return i.sort(function(t,n){return n.count-t.count}),i}function e(n){var e=MutationViewsUtil.getVisualStyleMaps().mutationType,i=t(n),a=[],o={};for(var r in i){var l=void 0;null!=e[r]&&(l=e[r].style),void 0==l&&(l=e.other.style),void 0==o[l]&&(o[l]=0),o[l]++}for(var l in o)a.push({group:l,count:o[l]});return a.sort(function(t,n){return n.count-t.count}),a}function i(){return s++,"pileup_"+s}function a(t){var n={};return _.each(t,function(t){_.each(t.mutations,function(e){n[e.mutationSid]=t.pileupId})}),n}function o(t){t=r(t);for(var n={},e=0;e<t.length;e++){var i=t.at(e),a=i.getProteinStartPos(),o=i.mutationType.trim().toLowerCase();null!=a&&"fusion"!=o&&(null==n[a]&&(n[a]=[]),n[a].push(i))}var u=[];for(var s in n){var c={};c.pileupId=PileupUtil.nextId(),c.mutations=n[s],c.count=n[s].length,c.location=parseInt(s),c.label=l(n[s]),c.stats=_.chain(n[s]).groupBy(function(t){return t.cancerType}).sortBy(function(t){return-t.length}).reduce(function(t,n){return t.push({cancerType:n[0].cancerType,count:n.length}),t},[]).value(),u.push(new Pileup(c))}return u.sort(function(t,n){var e=n.count-t.count;return 0==e&&(e=n.location-t.location),e}),u}function r(t){for(var n={},e=[],i=0;i<t.length;i++){var a=t.at(i),o=n[a.mutationSid];null==o?n[a.mutationSid]=!0:e.push(a)}return t.remove(e),t}function l(t){for(var n={},e=0;e<t.length;e++)null!=t[e].proteinChange&&t[e].proteinChange.length>0&&(n[t[e].proteinChange]=t[e].proteinChange);var i=[];for(var a in n)i.push(a);i.sort();var o="";i.length>1&&(o=cbio.util.lcss(i[0],i[i.length-1]));for(var r=o,e=0;e<i.length;e++)r+=i[e].substring(o.length)+"/";return r.substring(0,r.length-1)}function u(t){var n=0;return _.each(t,function(t){n+=t.count}),n}var s=0;return{nextId:i,mapToMutations:a,convertToPileups:o,countMutations:u,getMutationTypeMap:t,getMutationTypeArray:n,getMutationTypeGroups:e}}(),BackboneTemplateCache=function(){function t(t){return _.template($("#"+t).html())}function n(n){var i=e[n];return null==i&&(i=t(n),e[n]=i),i}var e={};return{getTemplateFn:n}}(),DataProxyUtil=function(){function t(t,e){var i={};return _.each(_.keys(t).sort(),function(a){var o=t[a],r=null;r="pdbProxy"==a?n(o,function(t){var n=i.mutationProxy;return null!=e&&null!=n&&n.hasData()?(t.options.mutationUtil=n.getMutationUtil(),!0):!1}):n(o),i[a]=r}),i}function n(t,n){var e=t.instance;if(null==e){if(null!=n&&_.isFunction(n)&&!n(t))return null;var i=t.instanceClass;e=new i(t.options),e.init()}return e}return{initDataProxies:t,initDataProxy:n}}();JmolScriptGenerator.prototype=new MolScriptGenerator,JmolScriptGenerator.prototype.constructor=JmolScriptGenerator;var MutationDetailsUtil=function(t){var n="germline",e="valid",i={},a={},o={},r={},l={},u={},s=[];this.getMutationGeneMap=function(){return i},this.getMutationCaseMap=function(){return a},this.getMutationIdMap=function(){return o},this.getMutations=function(){return s},this.processMutationData=function(t){i=this._updateGeneMap(t),a=this._updateCaseMap(t),o=this._updateIdMap(t),r=this._updateKeywordMap(t),l=this._updateProteinChangeMap(t),u=this._updateProteinPosStartMap(t),s=s.concat(t.models)},this.getProteinPositions=function(t){var n=i[t],e=[];if(null!=n)for(var a=0;a<n.length;a++){var o={id:n[a].id,start:n[a].getProteinStartPos(),end:n[a].proteinPosEnd};e.push(o)}return e},this.getAllKeywords=function(){return _.keys(r)},this.getAllProteinChanges=function(){return _.keys(l)},this.getAllProteinPosStarts=function(){return _.keys(u)},this.getAllGenes=function(){return _.keys(i)},this._updateGeneMap=function(t){for(var n=i,e=0;e<t.length;e++){var a=t.at(e).geneSymbol.toUpperCase();void 0==n[a]&&(n[a]=[]),n[a].push(t.at(e))}return n},this._updateCaseMap=function(t){for(var n=a,e=0;e<t.length;e++){var i=t.at(e).caseId.toLowerCase();void 0==n[i]&&(n[i]=[]),n[i].push(t.at(e))}return n},this._updateIdMap=function(t){for(var n=o,e=0;e<t.length;e++){var i=t.at(e).mutationId;n[i]=t.at(e)}return n},this._updateKeywordMap=function(t){for(var n=r,e=0;e<t.length;e++){var i=t.at(e).keyword;null!=i&&(void 0==n[i]&&(n[i]=[]),n[i].push(t.at(e)))}return n},this._updateProteinChangeMap=function(t){for(var n=l,e=0;e<t.length;e++){var i=t.at(e).proteinChange;null!=i&&(void 0==n[i]&&(n[i]=[]),n[i].push(t.at(e)))}return n},this._updateProteinPosStartMap=function(t){for(var n=u,e=0;e<t.length;e++){var i=t.at(e).geneSymbol,a=t.at(e).proteinPosStart;if(null!=a&&null!=i){var o=i+"_"+a;void 0==n[o]&&(n[o]=[]),n[o].push(t.at(e))}}return n},this.generateSummary=function(t){var n,e="[";return t.numGermline>0&&(n=t.numGermline/t.numCases*100,e+="Germline Mutation Rate: "+n.toFixed(1)+"%, "),n=t.numSomatic/t.numCases*100,e+="Somatic Mutation Rate: "+n.toFixed(1)+"%]"},this.countMutations=function(t,e){for(var i=e.length,o=0,r=0,l=0,u=0;u<e.length;u++){var s=a[e[u].toLowerCase()];if(null!=s){for(var c=0,d=0,p=0;p<s.length;p++)s[p].geneSymbol.toLowerCase()==t.toLowerCase()&&(s[p].mutationStatus.toLowerCase()===n?d=1:c=1);r+=c,l+=d,o++}}return{numCases:i,numMutated:o,numSomatic:r,numGermline:l}},this.cancerStudyAllTheSame=function(t){t=t.toUpperCase();var n=i[t];if(null!=n)for(var e=null,a=0;a<n.length;a++){var o=n[a].cancerStudy;if(null==e)e=o;else if(e!=o)return!1}return!0},this._contains=function(t,n){var e=!1;t=t.toUpperCase();var a=i[t];if(null!=a)for(var o=0;o<a.length&&!(e=n(a[o]));o++);return e},this.containsGermline=function(t){return this._contains(t,function(t){return t.mutationStatus&&t.mutationStatus.toLowerCase()==n})},this.containsValidStatus=function(t){return this._contains(t,function(t){return t.validationStatus&&t.validationStatus.toLowerCase()==e})},this.containsIgvLink=function(t){return this._contains(t,function(t){return t.igvLink&&"NA"!=t.igvLink})},this.containsAlleleFreqT=function(t){return this._contains(t,function(t){return t.tumorFreq&&"NA"!=t.tumorFreq})},this.containsCnaData=function(t){return this._contains(t,function(t){return t.cna&&"NA"!=t.cna&&"unknown"!=t.cna})},this.containsCaseId=function(t){return this._contains(t,function(t){return t.caseId&&"NA"!=t.caseId})},this.containsChr=function(t){return this._contains(t,function(t){return t.chr&&"NA"!=t.chr})},this.containsStartPos=function(t){return this._contains(t,function(t){return t.startPos&&t.startPos>0})},this.containsRefAllele=function(t){return this._contains(t,function(t){return t.referenceAllele&&"NA"!=t.referenceAllele})},this.containsVarAllele=function(t){return this._contains(t,function(t){return t.variantAllele&&"NA"!=t.variantAllele})},this.containsEndPos=function(t){return this._contains(t,function(t){return t.endPos&&t.endPos>0})},this.containsFis=function(t){return this._contains(t,function(t){return t.functionalImpactScore&&"NA"!=t.functionalImpactScore})},this.containsCosmic=function(t){return this._contains(t,function(t){return t.cosmic&&t.cosmicCount&&t.cosmicCount>0})},this.containsMutationType=function(t){return this._contains(t,function(t){return t.mutationType&&"NA"!=t.mutationType})},this.containsMutationCount=function(t){return this._contains(t,function(t){return t.mutationCount&&t.mutationCount>0})},this.containsKeyword=function(t){return this._contains(t,function(t){return t.keyword&&"NA"!=t.keyword})},this.containsMutationEventId=function(t){return this._contains(t,function(t){return t.mutationEventId&&"NA"!=t.mutationEventId})},this.distinctTumorTypeCount=function(t){t=t.toUpperCase();var n=i[t],e={};if(null!=n)for(var a=0;a<n.length;a++)n[a].tumorType&&(e[n[a].tumorType]=!0);return _.keys(e).length},this.dataFieldCount=function(t,n,e){t=t.toUpperCase();var a=i[t],o={};if(null!=a)for(var r=0;r<a.length;r++){var l=a[r][n];l&&!_.contains(e,l)&&(void 0===o[l]&&(o[l]=0),o[l]++)}var u=_.pairs(o);u.sort(function(t,n){return n[1]-t[1]});var s=[];return _.each(u,function(t,e){var i={count:t[1]};i[n]=t[0],s.push(i)}),s},null!=t&&this.processMutationData(t)},PancanMutationDataUtil=function(){function t(t,n){return d3.nest().key(function(t){return t[n]}).entries(t).reduce(function(t,n){return t[n.key]=n.values,t},{})}function n(n){var e={};return _.each(_.keys(n),function(i,a){e=_.extend(e,t(n[i],i))}),e}function e(t,n){var e=t[n];return _.reduce(e,function(t,n){return t+n.count},0)}return{getMutationFrequencies:n,countByKey:e}}(),PdbDataUtil=function(){function t(t){var n=null,e=[],i={};_.each(t,function(t,e){n=new PdbAlignmentModel(t),void 0==i[n.pdbId]&&(i[n.pdbId]={}),void 0==i[n.pdbId][n.chain]&&(i[n.pdbId][n.chain]=[]),i[n.pdbId][n.chain].push(n)});for(var a in i){var o=[];for(var r in i[a]){var l=new PdbChainModel({chainId:r,alignments:i[a][r]});o.push(l)}var u=new PdbModel({pdbId:a,chains:o});e.push(u)}return new PdbCollection(e)}function n(t,n){var e={};e.title=t.title;for(var i in t.compound){var a=t.compound[i];if(a.molecule&&-1!=_.indexOf(a.chain,n.toLowerCase())){e.molecule=a.molecule;break}}return e}function e(t,n){var e="NA";for(var i in t.compound){var a=t.compound[i];if(-1!=_.indexOf(a.chain,n.toLowerCase())&&null!=t.source[a.mol_id]){e=t.source[a.mol_id].organism_scientific||e;break}}return e}function i(t){return a(t)}function a(t){var n,e={mergedString:"",uniprotFrom:-1,uniprotTo:-1,pdbFrom:-1},i="",a=-1;return t.length>0?(i+=t[0].alignmentString,a=t[0].uniprotTo,n=t[0],_.each(t,function(t,e){var o=t.uniprotFrom-a-1,r=t.alignmentString;if(0==o)i+=r;else if(o>0){for(var l=[],u=0;o>u;u++)l.push(y);l.push(r),i+=l.join("")}else{var s=[],c=Math.min(-1*o,r.length);s.push(i.substr(i.length+o,c)),s.push(r.substr(0,c)),s[0]!=s[1]&&(console.log("[warning] alignment mismatch: "+n.alignmentId+" & "+t.alignmentId),console.log(s[0]),console.log(s[1])),i+=r.substr(-1*o)}a=Math.max(a,t.uniprotTo),a==t.uniprotTo&&(n=t)}),e.uniprotFrom=t[0].uniprotFrom,e.uniprotTo=e.uniprotFrom+i.length,e.pdbFrom=t[0].pdbFrom,e.mergedString=i,e.identityPerc=l(i),e.identity=u(i),e):e}function o(t,n){var e=null,i=t.getProteinStartPos(),a=t.mutationType.trim().toLowerCase();if(null==i||"fusion"==a)return e;for(var o=0;o<n.length&&!e;o++){for(var l=n[o],u=0;u<l.length&&!e;u++){var s=l[u],c=s.chain.mergedAlignment,d=i>=c.uniprotFrom&&i<=c.uniprotTo;if(d&&r(c,i)){e={pdbId:s.pdbId,chainId:s.chain.chainId};break}}if(e)break}return e}function r(t,n){var e=n-t.uniprotFrom,i=t.mergedString[e],a=i==y;return!a}function l(t){for(var n=0,e=0,i=0;i<t.length;i++){var a=t[i];a==y?n++:(a==C||a==T||a==P)&&e++}return 1-e/(i-n)}function u(t){t=t.toLowerCase();for(var n=0,e=0;e<t.length;e++){var i=t[e];i.match(/[a-z]/)&&n++}return n}function s(t){var n=d(t),e=[];return _.each(n,function(t,n){var i=t.chain;if(i.alignments.length>0){for(var a=!1,o=0;o<e.length;o++){for(var r=e[o],l=!1,u=0;u<r.length;u++)if(c(i,r[u].chain)){l=!0;break}if(!l){r.push(t),a=!0;break}}if(!a){var s=[];s.push(t),e.push(s)}}}),e.length>0&&e[0].sort(function(t,n){return n.chain.mergedAlignment.mergedString.length-t.chain.mergedAlignment.mergedString.length}),e}function c(t,n){var e=!0;return(t.mergedAlignment.uniprotFrom>=n.mergedAlignment.uniprotTo||n.mergedAlignment.uniprotFrom>=t.mergedAlignment.uniprotTo)&&(e=!1),e}function d(t){var n=[];return t.each(function(t,e){t.chains.each(function(e,i){var a={pdbId:t.pdbId,chain:e};n.push(a)})}),p(n,[h,g,f,v,b]),n}function p(t,n){t.sort(function(t,e){for(var i=0,a=0;a<n.length&&0==i;a++){var o=n[a];i=o(t,e)}return i})}function m(t,n){return t+":"+n}function h(t,n){return n.chain.mergedAlignment.identity-t.chain.mergedAlignment.identity}function f(t,n){return n.chain.mergedAlignment.identityPerc-t.chain.mergedAlignment.identityPerc}function g(t,n){return n.chain.mergedAlignment.mergedString.length-t.chain.mergedAlignment.mergedString.length}function v(t,n){return n.pdbId>t.pdbId?-1:n.pdbId<t.pdbId?1:0}function b(t,n){return n.chain.chainId>t.chain.chainId?-1:n.chain.chainId<t.chain.chainId?1:0}var y="*",T="+",C="-",P=" ";return{ALIGNMENT_GAP:y,ALIGNMENT_PLUS:T,ALIGNMENT_MINUS:C,ALIGNMENT_SPACE:P,processPdbData:t,mutationToPdb:o,allocateChainRows:s,mergeAlignments:i,generatePdbInfoSummary:n,getOrganism:e,chainKey:m}}();PymolScriptGenerator.prototype=new JmolScriptGenerator,PymolScriptGenerator.prototype.constructor=PymolScriptGenerator;var MutationModel=Backbone.Model.extend({initialize:function(t){this.mutationId=t.mutationId,this.mutationSid=t.mutationSid,this.geneticProfileId=t.geneticProfileId,this.mutationEventId=t.mutationEventId,this.caseId=t.caseId,this.geneSymbol=t.geneSymbol,this.linkToPatientView=t.linkToPatientView,this.cancerType=t.cancerType,this.cancerStudy=t.cancerStudy,this.cancerStudyShort=t.cancerStudyShort,this.cancerStudyLink=t.cancerStudyLink,this.tumorType=t.tumorType,this.proteinChange=t.proteinChange,this.aminoAcidChange=t.aminoAcidChange,this.mutationType=t.mutationType,this.cosmic=t.cosmic,this.cosmicCount=this.calcCosmicCount(t.cosmic),this.functionalImpactScore=t.functionalImpactScore,this.fisValue=t.fisValue,this.msaLink=t.msaLink,this.xVarLink=t.xVarLink,this.pdbLink=t.pdbLink,this.pdbMatch=t.pdbMatch,this.igvLink=t.igvLink,this.mutationStatus=t.mutationStatus,this.validationStatus=t.validationStatus,this.sequencingCenter=t.sequencingCenter,this.ncbiBuildNo=t.ncbiBuildNo,this.chr=t.chr,this.startPos=t.startPos,this.endPos=t.endPos,this.referenceAllele=t.referenceAllele,this.variantAllele=t.variantAllele,this.tumorFreq=t.tumorFreq,this.normalFreq=t.normalFreq,this.tumorRefCount=t.tumorRefCount,this.tumorAltCount=t.tumorAltCount,this.normalRefCount=t.normalRefCount,this.normalAltCount=t.normalAltCount,this.canonicalTranscript=t.canonicalTranscript,this.refseqMrnaId=t.refseqMrnaId,this.codonChange=t.codonChange,this.uniprotId=t.uniprotId,this.uniprotAcc=t.uniprotAcc,this.proteinPosStart=t.proteinPosStart,this.proteinPosEnd=t.proteinPosEnd,
this.mutationCount=t.mutationCount,this.specialGeneData=t.specialGeneData,this.keyword=t.keyword,this.cna=t.cna,this.myCancerGenome=t.myCancerGenome,this.isHotspot=t.isHotspot},url:function(){},getProteinStartPos:function(){var t=this.proteinPosStart;return(null==t||0==t.length||"NA"==t||0>t)&&(t=this.getProteinChangeLocation()),t},getProteinChangeLocation:function(){var t=null,n=this.proteinChange,e=n.match(/[0-9]+/);return e&&e.length>0&&(t=e[0]),t},calcCosmicCount:function(t){var n=0;return t&&t.forEach(function(t){n+=t[2]}),n}}),MutationCollection=Backbone.Collection.extend({model:MutationModel,initialize:function(t){},parse:function(t){},url:function(){}}),PdbAlignmentModel=Backbone.Model.extend({initialize:function(t){this.alignmentId=t.alignmentId,this.pdbId=t.pdbId,this.chain=t.chain,this.uniprotId=t.uniprotId,this.pdbFrom=t.pdbFrom,this.pdbTo=t.pdbTo,this.uniprotFrom=t.uniprotFrom,this.uniprotTo=t.uniprotTo,this.alignmentString=t.alignmentString,this.eValue=t.eValue,this.identityPerc=t.identityPerc}}),PdbAlignmentCollection=Backbone.Collection.extend({model:PdbAlignmentModel,initialize:function(t){}}),PdbChainModel=Backbone.Model.extend({initialize:function(t){this.chainId=t.chainId,this.positionMap=t.positionMap,this.alignments=new PdbAlignmentCollection(t.alignments),this.mergedAlignment=PdbDataUtil.mergeAlignments(t.alignments)}}),PdbChainCollection=Backbone.Collection.extend({model:PdbChainModel,initialize:function(t){}}),PdbModel=Backbone.Model.extend({initialize:function(t){this.pdbId=t.pdbId,this.chains=new PdbChainCollection(t.chains)}}),PdbCollection=Backbone.Collection.extend({model:PdbModel,initialize:function(t){}}),Pileup=Backbone.Model.extend({initialize:function(t){this.pileupId=t.pileupId,this.mutations=t.mutations,this.count=t.count,this.location=t.location,this.label=t.label,this.stats=t.stats}}),CosmicTipView=Backbone.View.extend({render:function(){var t=this.compileTemplate();this.$el.html(t),this.format()},format:function(){this.$el.find(".cosmic-details-table").dataTable({aaSorting:[[2,"desc"]],sDom:"pt",aoColumnDefs:[{mRender:function(t,n,e){return'<a href="http://cancer.sanger.ac.uk/cosmic/mutation/overview?id='+t+'">'+t+"</a>"},aTargets:[0]},{sType:"aa-change-col",sClass:"left-align-td",aTargets:[1]},{sType:"numeric",sClass:"left-align-td",aTargets:[2]}],bDestroy:!1,bPaginate:!0,bJQueryUI:!0,bFilter:!1})},_parseCosmic:function(t){var n=[];return t.forEach(function(t){n.push(t[0]+"</td><td>"+t[1]+"</td><td>"+t[2])}),"<tr><td>"+n.join("</td></tr><tr><td>")+"</td></tr>"},compileTemplate:function(){var t=this._parseCosmic(this.model.cosmic),n={cosmicDataRows:t,cosmicTotal:this.model.total,mutationKeyword:this.model.keyword},e=BackboneTemplateCache.getTemplateFn("mutation_details_cosmic_tip_template");return e(n)}}),LollipopTipStatsView=Backbone.View.extend({initialize:function(){},render:function(){var t=BackboneTemplateCache.getTemplateFn("mutation_details_lollipop_tip_stats_template"),n=this.$el.find("table tbody");return _.each(this.model,function(e){n.append(t(e))}),this}}),LollipopTipView=Backbone.View.extend({render:function(){var t=this.compileTemplate();this.$el.html(t),this.format()},format:function(){},showStats:!1,setShowStats:function(t){this.showStats=t},getShowStats:function(t){return this.showStats},compileTemplate:function(){var t=this.model,n=t.count>1?"mutations":"mutation",e={count:t.count,mutationStr:n,label:t.label},i=BackboneTemplateCache.getTemplateFn("mutation_details_lollipop_tip_template"),a=$(i(e)),o=a.find(".lollipop-stats");return this.showStats?(new LollipopTipStatsView({el:o,model:t.stats}).render(),o.find("table").dataTable({sDom:"t",bJQueryUI:!0,bDestroy:!0,aaSorting:[[1,"desc"]],aoColumns:[{bSortable:!1},{bSortable:!1}]})):o.hide(),a.html()}}),MainMutationView=Backbone.View.extend({initialize:function(t){this.options=t||{},this.dispatcher={},_.extend(this.dispatcher,Backbone.Events)},render:function(){var t=this,n={geneSymbol:t.model.geneSymbol,mutationSummary:t._mutationSummary(),uniprotId:t.model.sequence.metadata.identifier},e=BackboneTemplateCache.getTemplateFn("mutation_view_template"),i=e(n);t.$el.html(i),t.format()},format:function(){var t=this;t.$el.find(".mutation-details-filter-info").hide(),t.$el.find(".mutation-details-no-data-info").hide()},initComponents:function(t){var n=this,e=n.model.geneSymbol,i=n.model.mutationData,a=n.model.dataProxies,o=n.model.sequence,r=n.model.diagramOpts,l=n.model.tableOpts,u=n._initMutationDiagramView(e,i,o,a,r),s=u.mutationDiagram,c=null;s?t&&(c=n._init3dView(e,o,n.model.dataProxies.pdbProxy,t)):console.log("Error initializing mutation diagram: %s",e);var d=n._initMutationTableView(e,i,a,l);return n._mutationDiagram=s,n._tableView=d,n._mut3dView=c,{diagram:s,tableView:d,view3d:c}},initPdbPanelView:function(t){var n=this,e={el:n.$el.find(".mutation-pdb-panel-view"),model:{geneSymbol:n.model.geneSymbol,pdbColl:t,pdbProxy:n.model.dataProxies.pdbProxy},diagram:n._mutationDiagram},i=new PdbPanelView(e);return i.render(),n._pdbPanelView=i,i},_mutationSummary:function(){var t=this,n=t.model.dataProxies.mutationProxy.getMutationUtil(),e=t.model.geneSymbol,i=t.model.sampleArray,a="";if(i.length>0){var o=n.countMutations(e,i);a=n.generateSummary(o)}return a},_init3dView:function(t,n,e,i){var a=this,o=null;return i&&(o=new Mutation3dView({el:a.$el.find(".mutation-3d-initializer"),model:{uniprotId:n.metadata.identifier,geneSymbol:t,pdbProxy:e}}),o.render(),i.isVisible()&&o.resetView()),o},_initMutationDiagramView:function(t,n,e,i,a){var o=this,r={mutations:n,sequence:e,geneSymbol:t,dataProxies:i,diagramOpts:a},l=new MutationDiagramView({el:o.$el.find(".mutation-diagram-view"),model:r});return l.render(),l},_initMutationTableView:function(t,n,e,i){var a=this,o=new MutationDetailsTableView({el:a.$el.find(".mutation-table-container"),model:{geneSymbol:t,mutations:n,dataProxies:e,tableOpts:i}});return o.render(),o},addResetCallback:function(t){var n=this,e=n.$el.find(".mutation-details-filter-reset");e.click(t)},showFilterInfo:function(){this.$el.find(".mutation-details-filter-info").slideDown()},hideFilterInfo:function(){this.$el.find(".mutation-details-filter-info").slideUp()},showNoDataInfo:function(){this.$el.find(".mutation-details-no-data-info").slideDown()},hideNoDataInfo:function(){this.$el.find(".mutation-details-no-data-info").slideUp()}}),Mutation3dView=Backbone.View.extend({initialize:function(t){this.options=t||{},this.dispatcher={},_.extend(this.dispatcher,Backbone.Events)},render:function(){var t=this,n=(t.model.geneSymbol,BackboneTemplateCache.getTemplateFn("mutation_3d_view_template")),e=n({});this.$el.html(e),this.format()},format:function(){var t=this,n=t.$el.find(".mutation-3d-vis");n.attr("disabled","disabled");var e=function(e){if(e)n.removeAttr("disabled");else{var i=t.model.geneSymbol,a="No structure data for "+i,o={content:{text:a},hide:{fixed:!0,delay:100,event:"mouseout"},show:{event:"mouseover"},style:{classes:"qtip-light qtip-rounded qtip-shadow cc-ui-tooltip"},position:{my:"bottom center",at:"top center",viewport:$(window)}};t.$el.qtip(o)}},i=t.model.pdbProxy,a=t.model.uniprotId;i.hasPdbData(a,e)},addInitCallback:function(t){var n=this,e=n.$el.find(".mutation-3d-vis");e.click(t)},resetView:function(){var t=this,n=t.$el.find(".mutation-3d-vis");n.click()},isVisible:function(){var t=this;return t.$el.is(":visible")}}),Mutation3dVisInfoView=Backbone.View.extend({render:function(){var t=this,n=BackboneTemplateCache.getTemplateFn("mutation_3d_vis_info_template"),e=n(t.model);t.$el.html(e),t.format()},format:function(){var t=this,n=t.model.pdbInfo,e=t.model.molInfo;null==n||0==n.length?t.$el.find(".mutation-3d-pdb-info").hide():t._addExpander(".mutation-3d-pdb-info"),null==e||0==e.length?t.$el.find(".mutation-3d-mol-info").hide():t._addExpander(".mutation-3d-mol-info")},_addExpander:function(t){var n=this,e={slicePoint:40,widow:2,expandPrefix:" ",expandText:"[...]",userCollapseText:"[^]",moreClass:"expander-read-more",lessClass:"expander-read-less",detailClass:"expander-details",expandEffect:"fadeIn",collapseEffect:"fadeOut"};n.$el.find(t).expander(e)}}),Mutation3dVisView=Backbone.View.extend({initialize:function(t){this.options=t||{},this.dispatcher={},_.extend(this.dispatcher,Backbone.Events)},render:function(){var t=this,n=BackboneTemplateCache.getTemplateFn("mutation_3d_vis_template"),e=n({loaderImage:"images/ajax-loader.gif",helpImage:"images/help.png"});t.$el.html(e),t.format()},format:function(){var t=this,n=t.options.mut3dVis,e=t.$el;e.hide(),t.hideResidueWarning(),t.hideNoMapWarning(),t.$el.find(".mutation-3d-vis-help-content").hide(),null!=n&&n.updateContainer(e),t.$el.find(".mutation-3d-close").click(function(){t.hideView()}),t.$el.find(".mutation-3d-minimize").click(function(){null!=n&&n.toggleSize()}),t._initMutationControls(),t._initProteinControls(),t._initButtons(),e.draggable({handle:".mutation-3d-info-title",stop:function(t,n){var i=parseInt(e.css("top")),a=parseInt(e.css("left"));0>i&&e.css("top",0),0>a&&e.css("left",0)}}),e.resizable({alsoResize:".mutation-3d-vis-container,.mutation-3d-vis-container div:eq(0)",handles:"sw, s, w",minWidth:400,minHeight:300,start:function(t,n){e.find(".mutation-3d-vis-help-content").css("width","auto"),e.css("position","fixed")},stop:function(t,n){e.css("height","auto"),e.css("position","fixed")}})},_initButtons:function(){var t=this,n=t.options.mut3dVis,e=t.$el.find(".mutation-3d-vis-help-content"),i=t.$el.find(".mutation-3d-vis-help-init"),a=t.$el.find(".mutation-3d-vis-help-open"),o=t.$el.find(".mutation-3d-vis-help-close"),r=t.$el.find(".mutation-3d-pymol-dload");a.click(function(t){t.preventDefault(),e.slideToggle(),i.slideToggle()}),o.click(function(t){t.preventDefault(),e.slideToggle(),i.slideToggle()}),r.click(function(e){e.preventDefault();var i=n.generatePymolScript(),a=t.$el.find(".mutation-3d-pdb-id").text().trim()+"_"+t.$el.find(".mutation-3d-chain-id").text().trim()+".pml",o={filename:a,contentType:"text/plain;charset=utf-8",preProcess:!1};cbio.download.initDownload(i,o)}),r.qtip(t._generateTooltipOpts("Download PyMOL script"))},_initMutationControls:function(){var t=this,n=t.options.mut3dVis,e=t.$el.find(".mutation-3d-side-chain-select");e.change(function(){var t=$(this).val();n&&(n.updateOptions({displaySideChain:t}),n.reapplyStyle())});var i=t.$el.find(".mutation-3d-mutation-color-select");i.change(function(){var t=$(this).val();n&&(n.updateOptions({colorMutations:t}),n.reapplyStyle())}),t._initMutationColorInfo(),t._initSideChainInfo()},_initProteinControls:function(){var t=this,n=t.options.mut3dVis,e=t.$el.find(".mutation-3d-display-non-protein");e.change(function(){var t=e.is(":checked");n&&(n.updateOptions({restrictProtein:!t}),n.reapplyStyle())}),t._initHideNonProteinInfo(),t._initProteinSchemeSelector(),t._initProteinColorSelector()},_initProteinColorSelector:function(){var t=this,n=t.$el.find(".mutation-3d-protein-color-select"),e=t.options.mut3dVis;n.change(function(){var t=$(this).val();e.updateOptions({colorProteins:t}),e.reapplyStyle()})},_initProteinSchemeSelector:function(){var t=this,n=t.options.mut3dVis,e=t.$el.find(".mutation-3d-protein-style-select"),i=t.$el.find(".mutation-3d-protein-color-select");t._initProteinColorInfo(),e.change(function(){var t=$(this).val(),e=!1;i.find("option").removeAttr("disabled");var a=null;if(a="spaceFilling"==t?i.find("option[value='bySecondaryStructure']"):i.find("option[value='byAtomType']"),a.is(":selected")&&(a.removeAttr("selected"),i.find("option[value='uniform']").attr("selected","selected"),e="uniform"),a.attr("disabled","disabled"),n){var o={};o.proteinScheme=t,e&&(o.colorProteins=e),n.updateOptions(o),n.reapplyStyle()}})},_initZoomSlider:function(){var t=this,n=t.$el.find(".mutation-3d-zoom-slider"),e=t.options.mut3dVis,i=function(t){return 0>t?100+t:100+5*t},a=function(t,n){e&&e.zoomTo(i(n.value))};n.slider({value:0,min:-80,max:80,stop:a,slide:a})},updateView:function(t,n,e){var i=this,a=i.options.mut3dVis,o=i.options.pdbProxy,r=function(t){e.positionMap=t,a.show(),i.refreshView(n,e),i.pdbId=n,i.chain=e},l=function(a){var l={pdbId:n,chainId:e.chainId,pdbInfo:"",molInfo:""};if(a&&a[n]){var u=PdbDataUtil.generatePdbInfoSummary(a[n],e.chainId);l.pdbInfo=u.title,l.molInfo=u.molecule}var s=new Mutation3dVisInfoView({el:i.$el.find(".mutation-3d-info"),model:l});s.render(),o.getPositionMap(t,e,r)};o.getPdbInfo(n,l)},refreshView:function(t,n){var e=this,i=e.options.mut3dVis;e.hideResidueWarning(),e.hideNoMapWarning();var a=function(t){0==t.length?e.showNoMapWarning():e.hideNoMapWarning()};if(null==t&&null==n||t==e.pdbId&&n==e.chain){var o=i.refresh();a(o),e.dispatcher.trigger(MutationDetailsEvents.VIEW_3D_STRUCTURE_RELOADED)}else e.showLoader(),setTimeout(function(){var o=i.reload(t,n,function(){e.hideLoader(),e.dispatcher.trigger(MutationDetailsEvents.VIEW_3D_STRUCTURE_RELOADED)});a(o)},50)},_initMutationColorInfo:function(){var t=this,n=t.$el.find(".mutation-type-color-help"),e=BackboneTemplateCache.getTemplateFn("mutation_3d_type_color_tip_template"),i=e({}),a=t._generateTooltipOpts(i);a.style.classes+=" qtip-wide",n.qtip(a)},_initProteinColorInfo:function(){var t=this,n=t.$el.find(".protein-struct-color-help"),e=BackboneTemplateCache.getTemplateFn("mutation_3d_structure_color_tip_template"),i=e({}),a=t._generateTooltipOpts(i);a.style.classes+=" qtip-wide",n.qtip(a)},_initSideChainInfo:function(){var t=this,n=t.$el.find(".display-side-chain-help"),e=BackboneTemplateCache.getTemplateFn("mutation_3d_side_chain_tip_template"),i=e({}),a=t._generateTooltipOpts(i);n.qtip(a)},_initHideNonProteinInfo:function(){var t=this,n=t.$el.find(".display-non-protein-help"),e=BackboneTemplateCache.getTemplateFn("mutation_3d_non_protein_tip_template"),i=e({}),a=t._generateTooltipOpts(i);n.qtip(a)},_generateTooltipOpts:function(t){return{content:{text:t},hide:{fixed:!0,delay:100,event:"mouseout"},show:{event:"mouseover"},style:{classes:"qtip-light qtip-rounded qtip-shadow"},position:{my:"top right",at:"bottom center",viewport:$(window)}}},minimizeView:function(){var t=this,n=t.options.mut3dVis;n&&n.minimize()},maximizeView:function(){var t=this,n=t.options.mut3dVis;n&&n.maximize()},resetPanelPosition:function(){var t=this,n=t.$el;n.css({left:"",position:"",top:0})},hideView:function(){var t=this,n=t.options.mut3dVis;null!=n&&n.hide(),t.dispatcher.trigger(MutationDetailsEvents.VIEW_3D_PANEL_CLOSED)},isVisible:function(){var t=this,n=t.options.mut3dVis;return n.isVisible()},focusView:function(t){var n=this,e=n.options.mut3dVis;return t?e.focusOn(t):(e.resetFocus(),!0)},highlightView:function(t,n){var e=this,i=e.options.mut3dVis;return i.highlight(t,n)},resetHighlight:function(){var t=this,n=t.options.mut3dVis;n.resetHighlight()},showLoader:function(){var t=this,n=t.$el.find(".mutation-3d-vis-loader"),e=t.$el.find(".mutation-3d-vis-container"),i=e.css("height");0!==i&&"0px"!==i&&(t._actualHeight=i,e.css("height",0)),n.show()},hideLoader:function(){var t=this,n=t.$el.find(".mutation-3d-vis-loader"),e=t.$el.find(".mutation-3d-vis-container");n.hide(),e.css("height",t._actualHeight)},showResidueWarning:function(t,n){var e=this,i=e.$el.find(".mutation-3d-residue-warning"),a=e.$el.find(".mutation-3d-unmapped-info");e.$el.find(".mutation-3d-nomap-warning").is(":visible")||(n>1?a.text(t+" of the selections"):a.text("Selected mutation"),i.show())},hideResidueWarning:function(){var t=this,n=t.$el.find(".mutation-3d-residue-warning");n.hide()},showNoMapWarning:function(){var t=this,n=t.$el.find(".mutation-3d-nomap-warning");n.show()},hideNoMapWarning:function(){var t=this,n=t.$el.find(".mutation-3d-nomap-warning");n.hide()}}),MutationCustomizePanelView=Backbone.View.extend({initialize:function(t){this.options=t||{}},render:function(){var t=this,n=t.options.diagram,e={minY:2,maxY:n.getMaxY()},i=BackboneTemplateCache.getTemplateFn("mutation_customize_panel_template"),a=i(e);t.$el.html(a),t.format()},format:function(){var t=this,n=t.options.diagram;t.$el.hide();var e=t.$el.find(".diagram-customize-close"),i=t.$el.find(".diagram-y-axis-slider"),a=t.$el.find(".diagram-y-axis-limit-input");e.click(function(n){n.preventDefault(),t.toggleView()});var o=n.getMaxY();a.val(o),i.slider({value:o,min:2,max:o,change:function(t,e){a.val(e.value),n.updateOptions({maxLengthY:e.value}),n.rescaleYAxis()},slide:function(t,n){a.val(n.value)}}),a.keypress(function(t){var e=13;if(t.keyCode==e){var r=a.val();isNaN(r)||r>o||2>r?a.val(n.getMaxY()):i.slider("option","value",Math.floor(r))}})},toggleView:function(){var t=this;t.$el.slideToggle()}}),MutationDetailsTableView=Backbone.View.extend({initialize:function(t){this.options=t||{},this.dispatcher={},_.extend(this.dispatcher,Backbone.Events)},render:function(){var t=this,n=BackboneTemplateCache.getTemplateFn("mutation_details_table_template"),e=n({loaderImage:"images/ajax-loader.gif"});t.$el.html(e),t._initMutationTable(),t.format()},_initMutationTable:function(t){var n=this,e=jQuery.extend(!0,{},n.model.tableOpts);e.el=e.el||n.$el.find(".mutation_details_table");var i=new MutationCollection(n.model.mutations),a=new MutationDetailsUtil(i),o=new MutationDetailsTable(e,n.model.geneSymbol,a,n.model.dataProxies);return n.tableUtil=o,_.isFunction(t)&&t(n,o),n._generateRowData(o.getColumnOptions(),i,function(t){o.renderTable(t)}),o},_generateRowData:function(t,n,e){var i=[];n.each(function(n){for(var e={mutation:n},a=[e],o=0;o<_.size(t)-1;o++)a.push(null);i.push(a)}),e(i)},format:function(){},hideView:function(){var t=this;t.$el.hide()},showView:function(){var t=this;t.$el.show()},highlight:function(t){for(var n=this,e=n.$el.find(".mutation_details_table"),i=0;i<t.length;i++){var a=e.find("tr."+t[i].mutationSid);a.addClass("mutation-table-highlight")}},clearHighlights:function(){var t=this,n=t.$el.find(".mutation_details_table");n.find("tr").removeClass("mutation-table-highlight")},filter:function(t,n,e){for(var i=this,a=i.tableUtil.getDataTable(),o=[],r=0;r<t.length;r++)o.push(t[r].mutationSid);var l="("+o.join("|")+")",u=!0;0==o.length&&(l="",u=!1),i.tableUtil.setEventActive(!1),i._applyFilter(a,l,u,n,e),i.tableUtil.setEventActive(!0)},resetFilters:function(){var t=this;t.filter([],!0),t.tableUtil.cleanFilters()},rollBack:function(){var t=this,n=t.tableUtil.getDataTable();t.tableUtil.setEventActive(!1);var e=t.tableUtil.getManualSearch();t._applyFilter(n,e,!1),t.tableUtil.setEventActive(!0)},_applyFilter:function(t,n,e,i,a){var o=this;void 0==a&&(a=null),void 0==i&&(i=!1);var r=!0,l=!0,u=o.$el.find(".mutation_datatables_filter input[type=search]").val();t.fnFilter(n,a,e,r,i,l),i||o.$el.find(".mutation_datatables_filter input[type=search]").val(u)}}),MutationDetailsView=Backbone.View.extend({initialize:function(t){this.options=t||{},this.dispatcher={},_.extend(this.dispatcher,Backbone.Events)},render:function(){var t=this;t.geneTabView={};var n=t._generateContent(),e={loaderImage:"images/ajax-loader.gif",listContent:n.listContent,mainContent:n.mainContent},i=BackboneTemplateCache.getTemplateFn("default_mutation_details_template"),a=i(e);t.$el.html(a),t.model.mutationProxy.hasData()&&t._initDefaultView(),t.format()},format:function(){var t=this;if(t.model.mutationProxy.hasData()){var n=t.$el.find(".mutation-details-content");n.tabs(),n.tabs("paging",{tabsPerPage:10,follow:!0,cycle:!1}),n.tabs("option","active",0),t.$el.find(".mutation-details-tabs-ref").tipTip({defaultPosition:"bottom",delay:"100",edgeOffset:10,maxWidth:200})}},refreshGenesTab:function(){$(window).trigger("resize")},_generateContent:function(){var t=this,n="",e="";return _.each(t.model.mutationProxy.getGeneList(),function(t,i){var a=BackboneTemplateCache.getTemplateFn("default_mutation_details_main_content_template");n+=a({loaderImage:"images/ajax-loader.gif",geneSymbol:t,geneId:cbio.util.safeProperty(t)}),a=BackboneTemplateCache.getTemplateFn("default_mutation_details_list_content_template"),e+=a({geneSymbol:t,geneId:cbio.util.safeProperty(t)})}),{mainContent:n,listContent:e}},_initDefaultView:function(){var t=this,n=t.$el.find(".mutation-details-content");n.bind("tabscreate",!1),n.bind("tabsactivate",!1),n.bind("tabscreate",function(n,e){t.$el.find(".mutation-details-loader").hide(),t.dispatcher.trigger(MutationDetailsEvents.GENE_TABS_CREATED)}),n.bind("tabsactivate",function(n,e){var i=e.newTab.text().trim();t.dispatcher.trigger(MutationDetailsEvents.GENE_TAB_SELECTED,i)})}}),MutationDiagramView=Backbone.View.extend({initialize:function(t){this.options=t||{},this.dispatcher={},_.extend(this.dispatcher,Backbone.Events)},render:function(){var t=this,n={geneSymbol:t.model.geneSymbol,uniprotId:t.model.sequence.metadata.identifier},e=BackboneTemplateCache.getTemplateFn("mutation_diagram_view_template"),i=e(n);t.$el.html(i),t.mutationDiagram=t._initMutationDiagram(t.model.geneSymbol,t.model.mutations,t.model.sequence,t.model.dataProxies,t.model.diagramOpts),t.format()},format:function(){var t=this;t.$el.find(".mutation-diagram-toolbar").hide(),t.$el.find(".mutation-diagram-customize").hide(),t.$el.find(".mutation-diagram-help").hide(),t.$el.find(".mutation-diagram-toolbar-buttons").css("visibility","hidden"),t.mutationDiagram&&t._initToolbar(t.mutationDiagram,t.model.geneSymbol)},_initMutationDiagram:function(t,n,e,i,a){var o=this;if(a||(a={}),""==e.length||parseInt(e.length)<=0)return null;a.el=o.$el.find(".mutation-diagram-container");var r=new MutationCollection(n),l={pileups:PileupUtil.convertToPileups(r),sequence:e},u=new MutationDiagram(t,a,l,i);return null==e?$.getJSON("getPfamSequence.json",{geneSymbol:o.geneSymbol},function(t){t&&u.updateSequenceData(t[0]),u.initDiagram()}):u.initDiagram(),u},_initToolbar:function(t,n){var e=this,i=e.$el.find(".mutation-diagram-toolbar"),a=e.$el.find(".diagram-to-pdf"),o=e.$el.find(".diagram-to-svg"),r=e.$el.find(".diagram-customize"),l=e.$el.find(".diagram-help"),u=function(t,e,i){var a="mutation_diagram_"+n+"."+i;if(t(e,!1),"svg"==i)cbio.download.initDownload(e.svg[0][0],{filename:a});else if("pdf"==i){var o={filename:a,contentType:"application/pdf",servletName:"svgtopdf.do"};cbio.download.initDownload(e.svg[0][0],o)}t(e,!0)},s=function(t,e){var i=n;e&&(i=""),t.updateTopLabel(i)},c=function(t,n){s(t,n)};o.click(function(n){u(s,t,"svg")}),a.click(function(n){u(c,t,"pdf")}),r.click(function(n){var i=e.customizePanelView;i||(i=new MutationCustomizePanelView({el:e.$el.find(".mutation-diagram-customize"),diagram:t}),i.render(),e.customizePanelView=i),i.toggleView()}),l.click(function(t){var n=e.helpPanelView;n||(n=new MutationHelpPanelView({el:e.$el.find(".mutation-diagram-help")}),n.render(),e.helpPanelView=n),n.toggleView()}),e._autoHideToolbarButtons(),i.show()},_autoHideToolbarButtons:function(){var t=this,n=t.$el.find(".mutation-diagram-toolbar-buttons");cbio.util.autoHideOnMouseLeave(t.$el,n)}}),MutationHelpPanelView=Backbone.View.extend({initialize:function(t){this.options=t||{}},render:function(){var t=this,n=BackboneTemplateCache.getTemplateFn("mutation_help_panel_template"),e=n({});t.$el.html(e),t.format()},format:function(){var t=this,n=t.$el.find(".diagram-help-close");n.click(function(n){n.preventDefault(),t.toggleView()})},toggleView:function(){var t=this;t.$el.slideToggle()}}),PancanMutationHistTipView=Backbone.View.extend({render:function(){var t=this,n={gene:t.model.geneSymbol},e=BackboneTemplateCache.getTemplateFn("pancan_mutation_hist_tip_template"),i=e(n);t.model.qtipApi.set("content.text",i),this.format()},format:function(){var t=this,n=t.model.geneSymbol,e=t.model.proteinPosStart,i=t.model.cancerStudyMetaData,a=t.model.cancerStudyName,o=t.model.pancanMutationFreq[e],r=t.model.pancanMutationFreq[n],l=t.$el.find(".pancan-histogram-container"),u=PancanMutationHistogram(o,r,i,l[0],{this_cancer_study:a});t.$el.find(".overall-count").html(u.overallCountText());var s=$(l).find("svg").attr("width");t.$el.css("max-width",parseInt(s));var c=t.$el.find("svg")[0];u.qtip(c),$(".cross-cancer-download").click(function(){var t=$(this).attr("file-type"),e=n+"_mutations."+t;"pdf"==t?cbio.download.initDownload(c,{filename:e,contentType:"application/pdf",servletName:"svgtopdf.do"}):cbio.download.initDownload(c,{filename:e})})}}),PdbChainTipView=Backbone.View.extend({render:function(){var t=this.compileTemplate();this.$el.html(t),this.format()},format:function(){},compileTemplate:function(){var t=this,n=t.model.pdbInfo,e=t.model.molInfo,i={pdbId:t.model.pdbId,chainId:t.model.chain.chainId,pdbInfo:"",molInfo:""};(null!=n||n.length>0)&&(i.pdbInfo=": "+n),(null!=e||e.length>0)&&(i.molInfo=": "+e);var a=BackboneTemplateCache.getTemplateFn("mutation_details_pdb_chain_tip_template");return a(i)}}),PdbPanelView=Backbone.View.extend({initialize:function(t){this.options=t||{},this.collapseTimer=null,this.expandTimer=null},render:function(){var t=this,n=BackboneTemplateCache.getTemplateFn("pdb_panel_view_template"),e=n({});t.$el.html(e),t.pdbPanel=t._initPdbPanel(),t.format()},format:function(){var t=this;t.$el.hide();var n=t.$el.find(".expand-collapse-pdb-panel"),e=t.$el.find(".init-pdb-table"),i=t.$el.find(".pdb-table-controls"),a=t.$el.find(".triangle-down"),o=t.$el.find(".triangle");t.pdbPanel.hasMoreChains()&&(n.button({icons:{primary:"ui-icon-triangle-2-n-s"},text:!1}),n.css({width:"300px",height:"12px"}),n.click(function(){t.pdbPanel.toggleHeight()})),n.hide(),i.hide(),a.hide(),o.click(function(t){e.click()}),t.$el.find(".mutation-pdb-main-container").mouseenter(function(n){t.autoExpand()}),t.$el.find(".mutation-pdb-main-container").mouseleave(function(n){t.autoCollapse()})},hideView:function(){var t=this;t.$el.slideUp()},showView:function(){var t=this;t.$el.slideDown()},initPdbTableView:function(t,n){var e=this,i={el:e.$el.find(".mutation-pdb-table-view"),model:{geneSymbol:e.model.geneSymbol,pdbColl:t,pdbProxy:e.model.pdbProxy}},a=new PdbTableView(i);return e.pdbTableView=a,a.render(n),a},addInitCallback:function(t){var n=this,e=n.$el.find(".init-pdb-table");e.click(function(n){n.preventDefault(),t(n)})},toggleTableControls:function(){var t=this;t.$el.find(".triangle").toggle()},selectDefaultChain:function(){var t=this,n=t.pdbPanel,e=n.getDefaultChainGroup();t.clearTimers(),n.restoreChainPositions(function(){n.highlight(e)})},selectChain:function(t,n){var e=this,i=e.pdbPanel;e.clearTimers(),i.restoreChainPositions(function(){i.expandToChainLevel(t,n);var e=i.getChainGroup(t,n);e&&i.highlight(e)})},getSelectedChain:function(){var t=this,n=t.pdbPanel;return n.getHighlighted()},autoCollapse:function(t){null==t&&(t=2e3);var n=this,e=n.$el.find(".expand-collapse-pdb-panel"),i=n.$el.find(".pdb-table-controls"),a=n.$el.find(".pdb-table-wrapper");n.clearTimers(),n.collapseTimer=setTimeout(function(){n.pdbPanel.minimizeToHighlighted(),e.slideUp(),i.slideUp(),a.slideUp()},t)},autoExpand:function(t){null==t&&(t=400);var n=this,e=n.$el.find(".expand-collapse-pdb-panel"),i=n.$el.find(".pdb-table-controls"),a=n.$el.find(".pdb-table-wrapper");n.clearTimers(),n.expandTimer=setTimeout(function(){n.pdbPanel.restoreToFull(),n.pdbPanel.hasMoreChains()&&e.slideDown(),i.slideDown(),a.slideDown(),null!=n.pdbTableView&&n.pdbTableView.refreshView()},t)},toggleScrollBar:function(t){var n=this,e=n.$el.find(".mutation-pdb-panel-container");t>0?(e.css("max-height",t),e.css("overflow",""),e.css("overflow-y","scroll")):(e.css("max-height",""),e.css("overflow-y",""),e.css("overflow","hidden"))},scrollToSelected:function(){var t=this,n=t.$el.find(".mutation-pdb-panel-container");n.scrollTo($(".pdb-selection-rectangle-group"),{axis:"y",duration:800,offset:-150})},clearTimers:function(){var t=this;null!=t.collapseTimer&&clearTimeout(t.collapseTimer),null!=t.expandTimer&&clearTimeout(t.expandTimer)},_initPdbPanel:function(){var t=this,n=null,e=t.model.pdbColl,i=t.model.pdbProxy,a=t.options.diagram;if(null!=a){var o=a.xScale,r={el:t.$el.find(".mutation-pdb-panel-container"),marginLeft:a.options.marginLeft,marginRight:a.options.marginRight,maxHeight:200};n=new MutationPdbPanel(r,e,i,o),n.init()}return n}}),PdbTableView=Backbone.View.extend({initialize:function(t){this.options=t||{}},render:function(t){var n=this,e=BackboneTemplateCache.getTemplateFn("pdb_table_view_template"),i=e({loaderImage:"images/ajax-loader.gif"});n.$el.html(i),n._initPdbTable(t),n.format()},format:function(){var t=this;t.$el.hide()},hideView:function(){var t=this;t.$el.slideUp()},showView:function(){var t=this;t.$el.slideDown()},toggleView:function(){var t=this;t.$el.slideToggle()},refreshView:function(){var t=this;t.pdbTable.getDataTable().fnAdjustColumnSizing()},resetFilters:function(){var t=this;t.pdbTable.cleanFilters()},selectChain:function(t,n){var e=this;null!=e.pdbTable&&e.pdbTable.selectRow(t,n)},scrollToSelected:function(){var t=this,n=t.pdbTable.getSelectedRow(),e=t.$el.find(".dataTables_scrollBody");e.scrollTo($(n),{axis:"y",duration:800})},_initPdbTable:function(t){var n=this,e=n.model.pdbColl,i=n.model.pdbProxy,a=jQuery.extend(!0,{},n.model.tableOpts);a.el=a.el||n.$el.find(".pdb-chain-table");var o=new MutationPdbTable(a);return n.pdbTable=o,_.isFunction(t)&&t(n,o),n._generateRowData(o.getColumnOptions(),e,i,function(t){o.renderTable(t),n.$el.find(".pdb-chain-table-loader").hide()}),o},_generateRowData:function(t,n,e,i){var a=[],o=[];n.each(function(t){o.push(t.pdbId)}),e.getPdbInfo(o.join(" "),function(e){n.each(function(n){n.chains.each(function(i){for(var o={pdbId:n.pdbId,chain:i,organism:PdbDataUtil.getOrganism(e[n.pdbId],i.chainId),summary:PdbDataUtil.generatePdbInfoSummary(e[n.pdbId],i.chainId)},r=[o],l=0;l<_.size(t)-1;l++)r.push(null);a.push(r)})}),i(a)})}}),PredictedImpactTipView=Backbone.View.extend({render:function(){var t=this.compileTemplate();this.$el.html(t),this.format()},format:function(){var t=function(t){var n=!0;return(null==t||"NA"==t||0==t.length)&&(n=!1),n},n=this.model.xvia;t(n)||this.$el.find(".mutation-assessor-main-link").hide();var e=this.model.pdbLink;t(e)||this.$el.find(".mutation-assessor-3d-link").hide();var i=this.model.msaLink;t(i)||this.$el.find(".mutation-assessor-msa-link").hide()},compileTemplate:function(){var t={linkOut:this.model.xvia,msaLink:this.model.msaLink,pdbLink:this.model.pdbLink,impact:this.model.impact},n=BackboneTemplateCache.getTemplateFn("mutation_details_fis_tip_template");return n(t)}}),RegionTipView=Backbone.View.extend({render:function(){var t=this.compileTemplate();this.$el.html(t),this.format()},format:function(){},compileTemplate:function(){var t={identifier:this.model.identifier,type:this.model.type.toLowerCase(),description:this.model.description,start:this.model.start,end:this.model.end,pfamAccession:this.model.pfamAccession,mutationAlignerInfo:this.model.mutationAlignerInfo},n=BackboneTemplateCache.getTemplateFn("mutation_details_region_tip_template");return n(t)}});MutationAlignerDataProxy.prototype=new AbstractDataProxy,MutationAlignerDataProxy.prototype.constructor=MutationAlignerDataProxy,MutationDataProxy.prototype=new AbstractDataProxy,MutationDataProxy.prototype.constructor=MutationDataProxy,PancanMutationDataProxy.prototype=new AbstractDataProxy,PancanMutationDataProxy.prototype.constructor=PancanMutationDataProxy,PdbDataProxy.prototype=new AbstractDataProxy,PdbDataProxy.prototype.constructor=PdbDataProxy,PfamDataProxy.prototype=new AbstractDataProxy,PfamDataProxy.prototype.constructor=PfamDataProxy,PortalDataProxy.prototype=new AbstractDataProxy,PortalDataProxy.prototype.constructor=PortalDataProxy,MutationDetailsTable.prototype=new AdvancedDataTable,MutationDetailsTable.prototype.constructor=MutationDetailsTable,MutationDiagram.prototype.defaultOpts={el:"#mutation_diagram_d3",elWidth:740,elHeight:180,marginLeft:45,marginRight:30,marginTop:30,marginBottom:60,labelTop:"",labelTopFont:"sans-serif",labelTopFontColor:"#2E3436",labelTopFontSize:"12px",labelTopFontWeight:"bold",labelTopMargin:2,labelX:!1,labelXFont:"sans-serif",labelXFontColor:"#2E3436",labelXFontSize:"12px",labelXFontWeight:"normal",labelY:"# Mutations",labelYFont:"sans-serif",labelYFontColor:"#2E3436",labelYFontSize:"12px",labelYFontWeight:"normal",minLengthX:0,minLengthY:5,
maxLengthX:1/0,maxLengthY:1/0,seqFillColor:"#BABDB6",seqHeight:14,seqPadding:5,regionHeight:24,regionFont:"sans-serif",regionFontColor:"#FFFFFF",regionFontSize:"12px",regionTextAnchor:"middle",showRegionText:!0,showStats:!1,multiSelectKeycode:16,lollipopLabelCount:1,lollipopLabelThreshold:2,lollipopFont:"sans-serif",lollipopFontColor:"#2E3436",lollipopFontSize:"10px",lollipopTextAnchor:"auto",lollipopTextPadding:8,lollipopTextAngle:0,lollipopFillColor:{missense_mutation:"#008000",nonsense_mutation:"#FF0000",nonstop_mutation:"#FF0000",frame_shift_del:"#FF0000",frame_shift_ins:"#FF0000",in_frame_ins:"#000000",in_frame_del:"#000000",splice_site:"#FF0000",other:"#808080","default":"#800080"},lollipopBorderColor:"#BABDB6",lollipopBorderWidth:.5,lollipopSize:30,lollipopHighlightSize:100,lollipopStrokeWidth:1,lollipopStrokeColor:"#BABDB6",lollipopShapeRegular:"circle",lollipopShapeSpecial:"circle",xAxisPadding:10,xAxisTickIntervals:[100,200,400,500,1e3,2e3,5e3,1e4,2e4,5e4],xAxisTicks:8,xAxisTickSize:6,xAxisStroke:"#AAAAAA",xAxisFont:"sans-serif",xAxisFontSize:"10px",xAxisFontColor:"#2E3436",yAxisPadding:5,yAxisLabelPadding:15,yAxisTicks:10,yAxisTickIntervals:[1,2,5,10,20,50,100,200,500],yAxisTickSize:6,yAxisStroke:"#AAAAAA",yAxisFont:"sans-serif",yAxisFontSize:"10px",yAxisFontColor:"#2E3436",animationDuration:1e3,fadeDuration:1500,lollipopTipFn:function(t,n,e){var i=new LollipopTipView({model:n});i.setShowStats(e);var a=i.compileTemplate(),o={content:{text:a},hide:{fixed:!0,delay:100,event:"mouseout"},show:{event:"mouseover"},style:{classes:"qtip-light qtip-rounded qtip-shadow cc-ui-tooltip"},position:{my:"bottom left",at:"top center",viewport:$(window)}};$(t).qtip(o)},regionTipFn:function(t,n,e){var i={identifier:n.metadata.identifier,type:n.type,description:n.metadata.description,start:n.metadata.start,end:n.metadata.end,pfamAccession:n.metadata.accession,mutationAlignerInfo:""};e.getMutationAlignerData({pfamAccession:n.metadata.accession},function(n){if(null!=n&&null!=n.linkToMutationAligner&&n.linkToMutationAligner.length>0){var e=BackboneTemplateCache.getTemplateFn("mutation_aligner_info_template");i.mutationAlignerInfo=e({linkToMutationAligner:n.linkToMutationAligner})}var a=new RegionTipView({model:i}),o=a.compileTemplate(),r={content:{text:o},hide:{fixed:!0,delay:100,event:"mouseout"},show:{event:"mouseover"},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-lightyellow"},position:{my:"bottom left",at:"top center",viewport:$(window)}};$(t).qtip(r)})}},MutationDiagram.prototype.updateOptions=function(t){var n=this;n.options=jQuery.extend(!0,{},n.options,t);var e=n.xMax=n.calcXMax(n.options,n.data),i=n.maxCount=n.calcMaxCount(n.data.pileups),a=n.yMax=n.calcYMax(n.options,i);n.bounds=this.calcBounds(n.options),n.xScale=this.xScaleFn(n.bounds,e),n.yScale=this.yScaleFn(n.bounds,a)},MutationDiagram.prototype.rescaleYAxis=function(){var t=this,n=t.maxCount=t.calcMaxCount(t.data.pileups),e=t.calcYMax(t.options,n);t.svg.select(".mut-dia-y-axis").remove(),t.drawYAxis(t.svg,t.yScale,e,t.options,t.bounds),t.updatePlot()},MutationDiagram.prototype.updateSequenceData=function(t){var n=this;n.data.sequence=t},MutationDiagram.prototype.initDiagram=function(){var t=this,n=$(t.options.el)[0],e=d3.select(n),i=t.bounds=t.calcBounds(t.options);t.mutationPileupMap=PileupUtil.mapToMutations(t.data.pileups);var a=t.createSvg(e,t.options.elWidth,t.options.elHeight);t.svg=a,t.drawDiagram(a,i,t.options,t.data),t.addDefaultListeners()},MutationDiagram.prototype.calcBounds=function(t){var n={};return n.width=t.elWidth-(t.marginLeft+t.marginRight),n.height=t.elHeight-(t.marginBottom+t.marginTop),n.x=t.marginLeft,n.y=t.elHeight-t.marginBottom,n},MutationDiagram.prototype.drawDiagram=function(t,n,e,i){var a=this,o=(parseInt(i.sequence.length),a.maxCount=a.calcMaxCount(i.pileups)),r=a.xMax=a.calcXMax(e,i),l=a.yMax=a.calcYMax(e,o),u=i.sequence.regions,s=i.pileups,c=a.generateSequenceTooltip(i),d=a.xScale=a.xScaleFn(n,r),p=a.yScale=a.yScaleFn(n,l);a.drawXAxis(t,d,r,e,n),0!=e.labelX,a.drawYAxis(t,p,l,e,n),0!=e.labelY&&(a.yAxisLabel=a.drawYAxisLabel(t,e,n)),0!=e.topLabel&&(a.topLabel=a.drawTopLabel(t,e,n));t.append("rect").attr("fill","#FFFFFF").attr("opacity",0).attr("x",n.x).attr("y",n.y-n.height).attr("width",n.width).attr("height",n.height).attr("class","mut-dia-background");a.drawPlot(t,s,e,n,d,p);var m=a.drawSequence(t,e,n);m.attr("title",c);for(var h=0,f=u.length;f>h;h++)a.drawRegion(t,u[h],e,n,d)},MutationDiagram.prototype.xScaleFn=function(t,n){return d3.scale.linear().domain([0,n]).range([t.x,t.x+t.width])},MutationDiagram.prototype.yScaleFn=function(t,n){return d3.scale.linear().domain([0,n]).range([t.y,t.y-t.height])},MutationDiagram.prototype.calcXMax=function(t,n){var e=parseInt(n.sequence.length);return Math.min(t.maxLengthX,Math.max(e,t.minLengthX))},MutationDiagram.prototype.calcYMax=function(t,n){return Math.min(t.maxLengthY,Math.max(n,t.minLengthY))},MutationDiagram.prototype.generateSequenceTooltip=function(t){var n="",e=parseInt(t.sequence.length);return t.sequence.metadata.identifier&&(n+=t.sequence.metadata.identifier,t.sequence.metadata.description&&(n+=", "+t.sequence.metadata.description)),n+=" ("+e+"aa)"},MutationDiagram.prototype.drawPlot=function(t,n,e,i,a,o){var r=this,l=r.gLabel;null===l&&(l=t.append("g").attr("class","mut-dia-lollipop-labels"),r.gLabel=l);var u=r.gLine;null===u&&(u=t.append("g").attr("class","mut-dia-lollipop-lines"),r.gLine=u);var s=r.gData;null===s&&(s=t.append("g").attr("class","mut-dia-lollipop-points"),r.gData=s);for(var c=0;c<n.length;c++)r.drawLollipop(s,u,n[c],e,i,a,o);r.drawLollipopLabels(l,n,e,a,o)},MutationDiagram.prototype.createSvg=function(t,n,e){var i=t.append("svg");return i.attr("width",n),i.attr("height",e),i},MutationDiagram.prototype.calcTickInterval=function(t,n,e){for(var i=-1,a=0;a<t.length;a++){i=t[a];var o=n/i;if(e-1>o)break}return i},MutationDiagram.prototype.getTickValues=function(t,n){for(var e=[],i=0;t>i;)e.push(i),i+=n/2;return e.push(t),e},MutationDiagram.prototype.drawXAxis=function(t,n,e,i,a){var o=this,r=o.calcTickInterval(i.xAxisTickIntervals,e,i.xAxisTicks),l=o.getTickValues(e,r),u=function(t){return t==e?t+" aa":t%r!=0?"":e-t>r/3?t:""},s=i.xAxisTickSize,c=d3.svg.axis().scale(n).orient("bottom").tickValues(l).tickFormat(u).tickSize(s,s/2,0),d=a.y+i.regionHeight+i.xAxisPadding,p=t.append("g").attr("class","mut-dia-x-axis").attr("transform","translate(0,"+d+")").call(c);return o.formatAxis(".mut-dia-x-axis",i.xAxisStroke,i.xAxisFont,i.xAxisFontSize,i.xAxisFontColor),p},MutationDiagram.prototype.drawYAxis=function(t,n,e,i,a){var o=this,r=o.calcTickInterval(i.yAxisTickIntervals,e,i.yAxisTicks),l=o.getTickValues(e,2*r),u=function(t){var n="";return t==e?(n=t,o.maxCount>e&&(n=">"+t)):0==t&&(n=t),n},s=i.yAxisTickSize,c=d3.svg.axis().scale(n).orient("left").tickValues(l).tickFormat(u).tickSize(s,s/2,0),d=a.x-i.yAxisPadding,p=t.append("g").attr("class","mut-dia-y-axis").attr("transform","translate("+d+",0)").call(c);return o.formatAxis(".mut-dia-y-axis",i.yAxisStroke,i.yAxisFont,i.yAxisFontSize,i.yAxisFontColor),p},MutationDiagram.prototype.drawTopLabel=function(t,n,e){var i=n.labelTopMargin,a=n.marginTop/2,o=t.append("text").attr("fill",n.labelTopFontColor).attr("text-anchor","start").attr("x",i).attr("y",a).attr("class","mut-dia-top-label").style("font-family",n.labelTopFont).style("font-size",n.labelTopFontSize).style("font-weight",n.labelTopFontWeight).text(n.labelTop);return o},MutationDiagram.prototype.drawYAxisLabel=function(t,n,e){var i=e.x-n.yAxisPadding-n.yAxisTickSize-n.yAxisLabelPadding,a=e.y-e.height/2,o=t.append("text").attr("fill",n.labelYFontColor).attr("text-anchor","middle").attr("x",i).attr("y",a).attr("class","mut-dia-y-axis-label").attr("transform","rotate(270, "+i+","+a+")").style("font-family",n.labelYFont).style("font-size",n.labelYFontSize).style("font-weight",n.labelYFontWeight).text(n.labelY);return o},MutationDiagram.prototype.formatAxis=function(t,n,e,i,a){var o=d3.selectAll(t+" line");o.style("fill","none").style("stroke",n).style("shape-rendering","crispEdges"),o=d3.selectAll(t+" path"),o.style("fill","none").style("stroke",n).style("shape-rendering","crispEdges"),o=d3.selectAll(t+" text"),o.attr("fill",a).style("font-family",e).style("font-size",i)},MutationDiagram.prototype.drawLollipop=function(t,n,e,i,a,o,r){var l=this,u=i.lollipopShapeRegular,s=e.count,c=e.location,d=o(c),p=r(s);s>i.maxLengthY&&(u=i.lollipopShapeSpecial,p=r(i.maxLengthY));var m=l.getLollipopFillColor(i,e);l.updateColorMap(e,m);var h=t.append("path").attr("d",d3.svg.symbol().size(i.lollipopSize).type(u)).attr("transform","translate("+d+","+p+")").attr("fill",m).attr("stroke",i.lollipopBorderColor).attr("stroke-width",i.lollipopBorderWidth).attr("id",e.pileupId).attr("class","mut-dia-data-point").attr("opacity",0);l.fadeIn(h),h.datum(e);var f=i.lollipopTipFn;f(h,e,i.showStats);var g=n.append("line").attr("x1",d).attr("y1",p).attr("x2",d).attr("y2",l.calcSequenceBounds(a,i).y).attr("stroke",i.lollipopStrokeColor).attr("stroke-width",i.lollipopStrokeWidth).attr("class","mut-dia-data-line").attr("opacity",0);return l.fadeIn(g),{dataPoint:h,line:g}},MutationDiagram.prototype.updateColorMap=function(t,n){for(var e=this,i=0;i<t.mutations.length;i++)e.mutationColorMap[t.mutations[i].mutationId]=n},MutationDiagram.prototype.getLollipopShapeFn=function(){var t=this,n=function(n){var e=t.options.lollipopShapeRegular;return n.count>t.options.maxLengthY&&(e=t.options.lollipopShapeSpecial),e};return n},MutationDiagram.prototype.getLollipopFillColor=function(t,n){var e,i=t.lollipopFillColor;if(_.isFunction(i))e=i();else if("string"==typeof i)e=i;else{var a=PileupUtil.getMutationTypeArray(n);if(a.length>1&&a[0].count==a[1].count){var o=PileupUtil.getMutationTypeGroups(n);e=1==o.length?i[a[0].type]:i["default"]}else e=void 0==i[a[0].type]?i.other:i[a[0].type]}return e},MutationDiagram.prototype.drawLollipopLabels=function(t,n,e,i,a){var o=this,r=function(t,n){var i=n;if("auto"==i.toLowerCase()){var a=t.attr("x")-t.node().getComputedTextLength()/2;i=a<e.marginLeft?"start":"middle"}return i},l=e.lollipopLabelCount,u=2;if(n.length>1){for(var s=n[0].count,c=0;c<n.length&&!(n[c].count<s);c++);c>l&&c>u&&(l=0)}for(var d=0;l>d&&d<n.length&&!(n.length>1&&n[d].count<e.lollipopLabelThreshold);d++){var p=i(n[d].location),m=a(Math.min(n[d].count,e.maxLengthY))-e.lollipopTextPadding,h=t.append("text").attr("fill",e.lollipopFontColor).attr("x",p).attr("y",m).attr("class","mut-dia-lollipop-text").attr("transform","rotate("+e.lollipopTextAngle+", "+p+","+m+")").style("font-size",e.lollipopFontSize).style("font-family",e.lollipopFont).text(n[d].label).attr("opacity",0);o.fadeIn(h);var f=r(h,e.lollipopTextAnchor);h.attr("text-anchor",f)}},MutationDiagram.prototype.drawRegion=function(t,n,e,i,a){var o=this,r=n.metadata.start,l=n.metadata.end,u=n.text,s=n.colour,c=Math.abs(a(r)-a(l)),d=e.regionHeight,p=i.y+e.seqPadding,m=a(r),h=t.append("g").attr("class","mut-dia-region").attr("transform","translate("+m+","+p+")"),f=h.append("rect").attr("fill",s).attr("x",0).attr("y",0).attr("width",c).attr("height",d),g=e.regionTipFn;if(g(f,n,o.dataProxies.mutationAlignerProxy),e.showRegionText){var v=o.drawRegionText(u,h,e,c);v&&g(v,n,o.dataProxies.mutationAlignerProxy)}return h},MutationDiagram.prototype.drawRegionText=function(t,n,e,i){var a=i/2,o=e.regionHeight;"start"===e.regionTextAnchor?a=0:"end"===e.regionTextAnchor&&(a=i);var r=n.append("text").style("font-size",e.regionFontSize).style("font-family",e.regionFont).text(t).attr("text-anchor",e.regionTextAnchor).attr("fill",e.regionFontColor).attr("x",a).attr("y",2*o/3).attr("class","mut-dia-region-text");return r.node().getComputedTextLength()>i&&(t=t.substring(0,3)+"..",r.text(t),r.node().getComputedTextLength()>i&&(r.remove(),r=null)),r},MutationDiagram.prototype.drawSequence=function(t,n,e){var i=this.calcSequenceBounds(e,n);return t.append("rect").attr("fill",n.seqFillColor).attr("x",i.x).attr("y",i.y).attr("width",i.width).attr("height",i.height).attr("class","mut-dia-sequence")},MutationDiagram.prototype.calcMaxCount=function(t){var n=-1;return t.length>0&&(n=t[0].count),n},MutationDiagram.prototype.calcSequenceBounds=function(t,n){var e=t.x,i=t.y+Math.abs(n.regionHeight-n.seqHeight)/2+n.seqPadding,a=t.width,o=n.seqHeight;return{x:e,y:i,width:a,height:o}},MutationDiagram.prototype.updatePlot=function(t){var n=this,e=n.pileups;t&&(n.pileups=e=t,n.mutationPileupMap=PileupUtil.mapToMutations(e)),n.cleanPlotArea(),n.mutationColorMap={},n.drawPlot(n.svg,e,n.options,n.bounds,n.xScale,n.yScale);for(var i in n.listeners){var a=n.svg.selectAll(i);for(var o in n.listeners[i])a.on(o,n.listeners[i][o])}return n.highlighted={},n.dispatcher.trigger(MutationDetailsEvents.DIAGRAM_PLOT_UPDATED),n.isFiltered()},MutationDiagram.prototype.cleanPlotArea=function(){var t=this,n=t.gLabel.selectAll("text"),e=t.gLine.selectAll("line"),i=t.gData.selectAll(".mut-dia-data-point");t.fadeOut(n,function(t){$(t).remove()}),t.fadeOut(e,function(t){$(t).remove()}),t.fadeOut(i,function(t){$(t).remove()})},MutationDiagram.prototype.resetPlot=function(){var t=this;t.updatePlot(t.data.pileups),t.dispatcher.trigger(MutationDetailsEvents.DIAGRAM_PLOT_RESET)},MutationDiagram.prototype.updateTopLabel=function(t){var n=this;(void 0==t||null==t)&&(t=""),n.topLabel.text(t)},MutationDiagram.prototype.addListener=function(t,n,e){var i=this;i.svg.selectAll(t).on(n,e),null==i.listeners[t]&&(i.listeners[t]={}),i.listeners[t][n]=e},MutationDiagram.prototype.removeListener=function(t,n){var e=this;e.svg.selectAll(t).on(n,null),e.listeners[t]&&e.listeners[t][n]&&delete e.listeners[t][n]},MutationDiagram.prototype.addDefaultListeners=function(){var t=this;t.addListener(".mut-dia-background","click",function(n,e){var i=!t.isHighlighted()||t.multiSelect;i||(t.clearHighlights(),t.dispatcher.trigger(MutationDetailsEvents.ALL_LOLLIPOPS_DESELECTED))}),t.addListener(".mut-dia-data-point","click",function(n,e){t.isHighlighted(this)?(t.removeHighlight(this),t.multiSelect||t.clearHighlights(),t.dispatcher.trigger(MutationDetailsEvents.LOLLIPOP_DESELECTED,n,e)):(t.multiSelect||t.clearHighlights(),t.highlight(this),t.dispatcher.trigger(MutationDetailsEvents.LOLLIPOP_SELECTED,n,e))}),t.addListener(".mut-dia-data-point","mouseout",function(n,e){t.dispatcher.trigger(MutationDetailsEvents.LOLLIPOP_MOUSEOUT,n,e)}),t.addListener(".mut-dia-data-point","mouseover",function(n,e){t.dispatcher.trigger(MutationDetailsEvents.LOLLIPOP_MOUSEOVER,n,e)});var n=function(n,e){t.multiSelect&&d3.event.preventDefault()};t.addListener(".mut-dia-data-point","mousedown",n),t.addListener(".mut-dia-background","mousedown",n),$(window).on("keydown",function(n){n.keyCode==t.options.multiSelectKeycode&&(t.multiSelect=!0)}),$(window).on("keyup",function(n){n.keyCode==t.options.multiSelectKeycode&&(t.multiSelect=!1)})},MutationDiagram.prototype.isHighlighted=function(t){var n=this,e=!1;if(void 0==t)e=!_.isEmpty(n.highlighted);else{var i=d3.select(t),a=i.datum().location;void 0!=n.highlighted[a]&&(e=!0)}return e},MutationDiagram.prototype.clearHighlights=function(){var t=this,n=t.gData.selectAll(".mut-dia-data-point");n.transition().ease("elastic").duration(t.options.animationDuration).attr("d",d3.svg.symbol().size(t.options.lollipopSize).type(t.getLollipopShapeFn())),t.highlighted={}},MutationDiagram.prototype.highlightMutation=function(t){var n=this,e=n.mutationPileupMap[t],i=n.svg.select("#"+e);i.length>0&&n.highlight(i[0][0])},MutationDiagram.prototype.highlight=function(t){var n=this,e=d3.select(t);e.transition().ease("elastic").duration(n.options.animationDuration).attr("d",d3.svg.symbol().size(n.options.lollipopHighlightSize).type(n.getLollipopShapeFn()));var i=e.datum().location;n.highlighted[i]=e},MutationDiagram.prototype.removeHighlight=function(t){var n=this,e=d3.select(t);e.transition().ease("elastic").duration(n.options.animationDuration).attr("d",d3.svg.symbol().size(n.options.lollipopSize).type(n.getLollipopShapeFn()));var i=e.datum().location;delete n.highlighted[i]},MutationDiagram.prototype.fadeIn=function(t,n){var e=this;t.transition().style("opacity",1).duration(e.options.fadeDuration).each("end",function(){_.isFunction(n)&&n(this)})},MutationDiagram.prototype.fadeOut=function(t,n){var e=this;t.transition().style("opacity",0).duration(e.options.fadeDuration).each("end",function(){_.isFunction(n)&&n(this)})},MutationDiagram.prototype.getSelectedElements=function(){var t=this,n=[];for(var e in t.highlighted)n.push(t.highlighted[e]);return n},MutationDiagram.prototype.isFiltered=function(){var t=this,n=!1;return PileupUtil.countMutations(t.pileups)<PileupUtil.countMutations(t.data.pileups)&&(n=!0),n},MutationDiagram.prototype.getMaxY=function(){return this.yMax},MutationDiagram.prototype.getMinY=function(){return this.options.minLengthY},MutationHistogram.prototype=new MutationDiagram,MutationHistogram.prototype.constructor=MutationHistogram,MutationHistogram.prototype.drawPlot=function(t,n,e,i,a,o){},MutationPdbTable.prototype=new AdvancedDataTable,MutationPdbTable.prototype.constructor=MutationPdbTable;var MutationDetailsEvents=function(){var t="mutationDiagramLollipopSelected",n="mutationDiagramLollipopDeselected",e="mutationDiagramAllDeselected",i="mutationDiagramLollipopMouseover",a="mutationDiagramLollipopMouseout",o="mutationDiagramPlotUpdated",r="mutationDiagramPlotReset",l="mutationTableFiltered",u="mutationTableProteinChangeLinkClicked",s="mutationTablePdbLinkClicked",c="mutationPdbPanelResizeStarted",d="mutationPdbPanelResizeEnded",p="mutationPdbPanelChainSelected",m="mutationPdbTableChainSelected",h="mutationPdbTableChainMouseout",f="mutationPdbTableChainMouseover",g="mutationPdbTableReady",v="mutationDetailsGeneTabSelected",b="mutationDetailsGeneTabsCreated",y="mutation3dPanelClosed",_="mutation3dStructureReloaded";return{LOLLIPOP_SELECTED:t,LOLLIPOP_DESELECTED:n,LOLLIPOP_MOUSEOVER:i,LOLLIPOP_MOUSEOUT:a,ALL_LOLLIPOPS_DESELECTED:e,DIAGRAM_PLOT_UPDATED:o,DIAGRAM_PLOT_RESET:r,MUTATION_TABLE_FILTERED:l,PROTEIN_CHANGE_LINK_CLICKED:u,PDB_LINK_CLICKED:s,PDB_PANEL_RESIZE_STARTED:c,PDB_PANEL_RESIZE_ENDED:d,PANEL_CHAIN_SELECTED:p,TABLE_CHAIN_SELECTED:m,TABLE_CHAIN_MOUSEOUT:h,TABLE_CHAIN_MOUSEOVER:f,PDB_TABLE_READY:g,GENE_TAB_SELECTED:v,GENE_TABS_CREATED:b,VIEW_3D_STRUCTURE_RELOADED:_,VIEW_3D_PANEL_CLOSED:y}}();